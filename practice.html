<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Best practices for targets-powered projects | The targets R Package User Manual</title>
  <meta name="description" content="In-depth discussion of the major functionality of targets." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Best practices for targets-powered projects | The targets R Package User Manual" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://wlandau.github.io/targets-manual" />
  <meta property="og:image" content="https://wlandau.github.io/targets-manual/man/figures/logo.png" />
  <meta property="og:description" content="In-depth discussion of the major functionality of targets." />
  <meta name="github-repo" content="wlandau/targets-manual" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Best practices for targets-powered projects | The targets R Package User Manual" />
  
  <meta name="twitter:description" content="In-depth discussion of the major functionality of targets." />
  <meta name="twitter:image" content="https://wlandau.github.io/targets-manual/man/figures/logo.png" />

<meta name="author" content="Will Landau" />
<meta name="author" content="Copyright Eli Lilly and Company" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="man/figures/apple-touch-icon.png" />
  <link rel="shortcut icon" href="man/figures/favicon.ico" type="image/x-icon" />
<link rel="prev" href="walkthrough.html"/>
<link rel="next" href="files.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-150843595-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-150843595-1');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#motivation"><i class="fa fa-check"></i><b>1.1</b> Motivation</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#pipeline-toolkits"><i class="fa fa-check"></i><b>1.2</b> Pipeline toolkits</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#the-targets-package"><i class="fa fa-check"></i><b>1.3</b> The <code>targets</code> package</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#about-this-manual"><i class="fa fa-check"></i><b>1.4</b> About this manual</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#what-about-drake"><i class="fa fa-check"></i><b>1.5</b> What about <code>drake</code>?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="walkthrough.html"><a href="walkthrough.html"><i class="fa fa-check"></i><b>2</b> Walkthrough</a>
<ul>
<li class="chapter" data-level="2.1" data-path="walkthrough.html"><a href="walkthrough.html#goal-of-the-analysis"><i class="fa fa-check"></i><b>2.1</b> Goal of the analysis</a></li>
<li class="chapter" data-level="2.2" data-path="walkthrough.html"><a href="walkthrough.html#file-structure"><i class="fa fa-check"></i><b>2.2</b> File structure</a></li>
<li class="chapter" data-level="2.3" data-path="walkthrough.html"><a href="walkthrough.html#inspect-the-pipeline"><i class="fa fa-check"></i><b>2.3</b> Inspect the pipeline</a></li>
<li class="chapter" data-level="2.4" data-path="walkthrough.html"><a href="walkthrough.html#run-the-pipeline"><i class="fa fa-check"></i><b>2.4</b> Run the pipeline</a></li>
<li class="chapter" data-level="2.5" data-path="walkthrough.html"><a href="walkthrough.html#changes"><i class="fa fa-check"></i><b>2.5</b> Changes</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="walkthrough.html"><a href="walkthrough.html#change-code"><i class="fa fa-check"></i><b>2.5.1</b> Change code</a></li>
<li class="chapter" data-level="2.5.2" data-path="walkthrough.html"><a href="walkthrough.html#change-data"><i class="fa fa-check"></i><b>2.5.2</b> Change data</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="walkthrough.html"><a href="walkthrough.html#read-your-data"><i class="fa fa-check"></i><b>2.6</b> Read your data</a></li>
<li class="chapter" data-level="2.7" data-path="walkthrough.html"><a href="walkthrough.html#read-metadata"><i class="fa fa-check"></i><b>2.7</b> Read metadata</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="practice.html"><a href="practice.html"><i class="fa fa-check"></i><b>3</b> Best practices for <code>targets</code>-powered projects</a>
<ul>
<li class="chapter" data-level="3.1" data-path="practice.html"><a href="practice.html#a-move-away-from-imperative-scripts"><i class="fa fa-check"></i><b>3.1</b> A move away from imperative scripts</a></li>
<li class="chapter" data-level="3.2" data-path="practice.html"><a href="practice.html#functions"><i class="fa fa-check"></i><b>3.2</b> Functions</a></li>
<li class="chapter" data-level="3.3" data-path="practice.html"><a href="practice.html#packages"><i class="fa fa-check"></i><b>3.3</b> Packages</a></li>
<li class="chapter" data-level="3.4" data-path="practice.html"><a href="practice.html#targets"><i class="fa fa-check"></i><b>3.4</b> Targets</a></li>
<li class="chapter" data-level="3.5" data-path="practice.html"><a href="practice.html#dependencies"><i class="fa fa-check"></i><b>3.5</b> Dependencies</a></li>
<li class="chapter" data-level="3.6" data-path="practice.html"><a href="practice.html#monitoring"><i class="fa fa-check"></i><b>3.6</b> Monitoring</a></li>
<li class="chapter" data-level="3.7" data-path="practice.html"><a href="practice.html#debugging"><i class="fa fa-check"></i><b>3.7</b> Debugging</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="practice.html"><a href="practice.html#workspaces"><i class="fa fa-check"></i><b>3.7.1</b> Workspaces</a></li>
<li class="chapter" data-level="3.7.2" data-path="practice.html"><a href="practice.html#interactive-debugging"><i class="fa fa-check"></i><b>3.7.2</b> Interactive debugging</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="practice.html"><a href="practice.html#performance"><i class="fa fa-check"></i><b>3.8</b> Performance</a></li>
<li class="chapter" data-level="3.9" data-path="practice.html"><a href="practice.html#cleaning-up"><i class="fa fa-check"></i><b>3.9</b> Cleaning up</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="files.html"><a href="files.html"><i class="fa fa-check"></i><b>4</b> External files and literate programming</a>
<ul>
<li class="chapter" data-level="4.1" data-path="files.html"><a href="files.html#internal-files"><i class="fa fa-check"></i><b>4.1</b> Internal files</a></li>
<li class="chapter" data-level="4.2" data-path="files.html"><a href="files.html#external-input-files"><i class="fa fa-check"></i><b>4.2</b> External input files</a></li>
<li class="chapter" data-level="4.3" data-path="files.html"><a href="files.html#external-output-files"><i class="fa fa-check"></i><b>4.3</b> External output files</a></li>
<li class="chapter" data-level="4.4" data-path="files.html"><a href="files.html#literate-programming"><i class="fa fa-check"></i><b>4.4</b> Literate programming</a></li>
<li class="chapter" data-level="4.5" data-path="files.html"><a href="files.html#parameterized-r-markdown"><i class="fa fa-check"></i><b>4.5</b> Parameterized R Markdown</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="files.html"><a href="files.html#single-parameter-set"><i class="fa fa-check"></i><b>4.5.1</b> Single parameter set</a></li>
<li class="chapter" data-level="4.5.2" data-path="files.html"><a href="files.html#multiple-parameter-sets"><i class="fa fa-check"></i><b>4.5.2</b> Multiple parameter sets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dynamic.html"><a href="dynamic.html"><i class="fa fa-check"></i><b>5</b> Dynamic branching</a>
<ul>
<li class="chapter" data-level="5.1" data-path="dynamic.html"><a href="dynamic.html#patterns"><i class="fa fa-check"></i><b>5.1</b> Patterns</a></li>
<li class="chapter" data-level="5.2" data-path="dynamic.html"><a href="dynamic.html#pattern-construction"><i class="fa fa-check"></i><b>5.2</b> Pattern construction</a></li>
<li class="chapter" data-level="5.3" data-path="dynamic.html"><a href="dynamic.html#dynamic-branching-over-files"><i class="fa fa-check"></i><b>5.3</b> Dynamic branching over files</a></li>
<li class="chapter" data-level="5.4" data-path="dynamic.html"><a href="dynamic.html#iteration"><i class="fa fa-check"></i><b>5.4</b> Iteration</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="dynamic.html"><a href="dynamic.html#vector"><i class="fa fa-check"></i><b>5.4.1</b> Vector</a></li>
<li class="chapter" data-level="5.4.2" data-path="dynamic.html"><a href="dynamic.html#list"><i class="fa fa-check"></i><b>5.4.2</b> List</a></li>
<li class="chapter" data-level="5.4.3" data-path="dynamic.html"><a href="dynamic.html#group"><i class="fa fa-check"></i><b>5.4.3</b> Group</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="dynamic.html"><a href="dynamic.html#batching"><i class="fa fa-check"></i><b>5.5</b> Batching</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="static.html"><a href="static.html"><i class="fa fa-check"></i><b>6</b> Static branching</a>
<ul>
<li class="chapter" data-level="6.1" data-path="static.html"><a href="static.html#map"><i class="fa fa-check"></i><b>6.1</b> Map</a></li>
<li class="chapter" data-level="6.2" data-path="static.html"><a href="static.html#combine"><i class="fa fa-check"></i><b>6.2</b> Combine</a></li>
<li class="chapter" data-level="6.3" data-path="static.html"><a href="static.html#metaprogram"><i class="fa fa-check"></i><b>6.3</b> Metaprogram</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="hpc.html"><a href="hpc.html"><i class="fa fa-check"></i><b>7</b> High-performance computing</a>
<ul>
<li class="chapter" data-level="7.1" data-path="hpc.html"><a href="hpc.html#clustermq"><i class="fa fa-check"></i><b>7.1</b> Clustermq</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="hpc.html"><a href="hpc.html#clustermq-installation"><i class="fa fa-check"></i><b>7.1.1</b> Clustermq installation</a></li>
<li class="chapter" data-level="7.1.2" data-path="hpc.html"><a href="hpc.html#clustermq-locally"><i class="fa fa-check"></i><b>7.1.2</b> Clustermq locally</a></li>
<li class="chapter" data-level="7.1.3" data-path="hpc.html"><a href="hpc.html#clustermq-remotely"><i class="fa fa-check"></i><b>7.1.3</b> Clustermq remotely</a></li>
<li class="chapter" data-level="7.1.4" data-path="hpc.html"><a href="hpc.html#clustermq-configuration"><i class="fa fa-check"></i><b>7.1.4</b> Clustermq configuration</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="hpc.html"><a href="hpc.html#future"><i class="fa fa-check"></i><b>7.2</b> Future</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="hpc.html"><a href="hpc.html#future-installation"><i class="fa fa-check"></i><b>7.2.1</b> Future installation</a></li>
<li class="chapter" data-level="7.2.2" data-path="hpc.html"><a href="hpc.html#future-locally"><i class="fa fa-check"></i><b>7.2.2</b> Future locally</a></li>
<li class="chapter" data-level="7.2.3" data-path="hpc.html"><a href="hpc.html#future-remotely"><i class="fa fa-check"></i><b>7.2.3</b> Future remotely</a></li>
<li class="chapter" data-level="7.2.4" data-path="hpc.html"><a href="hpc.html#future-configuration"><i class="fa fa-check"></i><b>7.2.4</b> Future configuration</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="hpc.html"><a href="hpc.html#advanced"><i class="fa fa-check"></i><b>7.3</b> Advanced</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="cloud.html"><a href="cloud.html"><i class="fa fa-check"></i><b>8</b> Cloud integration</a>
<ul>
<li class="chapter" data-level="8.1" data-path="cloud.html"><a href="cloud.html#compute"><i class="fa fa-check"></i><b>8.1</b> Compute</a></li>
<li class="chapter" data-level="8.2" data-path="cloud.html"><a href="cloud.html#storage"><i class="fa fa-check"></i><b>8.2</b> Storage</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="cloud.html"><a href="cloud.html#get-started-with-the-amazon-s3-web-console"><i class="fa fa-check"></i><b>8.2.1</b> Get started with the Amazon S3 web console</a></li>
<li class="chapter" data-level="8.2.2" data-path="cloud.html"><a href="cloud.html#configure-your-local-machine"><i class="fa fa-check"></i><b>8.2.2</b> Configure your local machine</a></li>
<li class="chapter" data-level="8.2.3" data-path="cloud.html"><a href="cloud.html#create-s3-buckets"><i class="fa fa-check"></i><b>8.2.3</b> Create S3 buckets</a></li>
<li class="chapter" data-level="8.2.4" data-path="cloud.html"><a href="cloud.html#configure-the-pipeline"><i class="fa fa-check"></i><b>8.2.4</b> Configure the pipeline</a></li>
<li class="chapter" data-level="8.2.5" data-path="cloud.html"><a href="cloud.html#run-the-pipeline-1"><i class="fa fa-check"></i><b>8.2.5</b> Run the pipeline</a></li>
<li class="chapter" data-level="8.2.6" data-path="cloud.html"><a href="cloud.html#manage-the-data"><i class="fa fa-check"></i><b>8.2.6</b> Manage the data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="drake.html"><a href="drake.html"><i class="fa fa-check"></i><b>9</b> What about <code>drake</code>?</a>
<ul>
<li class="chapter" data-level="9.1" data-path="drake.html"><a href="drake.html#transitioning-to-targets"><i class="fa fa-check"></i><b>9.1</b> Transitioning to <code>targets</code></a></li>
<li class="chapter" data-level="9.2" data-path="drake.html"><a href="drake.html#advantages-of-targets-over-drake"><i class="fa fa-check"></i><b>9.2</b> Advantages of <code>targets</code> over <code>drake</code></a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="drake.html"><a href="drake.html#better-guardrails-by-design"><i class="fa fa-check"></i><b>9.2.1</b> Better guardrails by design</a></li>
<li class="chapter" data-level="9.2.2" data-path="drake.html"><a href="drake.html#enhanced-debugging-support"><i class="fa fa-check"></i><b>9.2.2</b> Enhanced debugging support</a></li>
<li class="chapter" data-level="9.2.3" data-path="drake.html"><a href="drake.html#improved-tracking-of-package-functions"><i class="fa fa-check"></i><b>9.2.3</b> Improved tracking of package functions</a></li>
<li class="chapter" data-level="9.2.4" data-path="drake.html"><a href="drake.html#lighter-friendlier-data-management"><i class="fa fa-check"></i><b>9.2.4</b> Lighter, friendlier data management</a></li>
<li class="chapter" data-level="9.2.5" data-path="drake.html"><a href="drake.html#cloud-storage"><i class="fa fa-check"></i><b>9.2.5</b> Cloud storage</a></li>
<li class="chapter" data-level="9.2.6" data-path="drake.html"><a href="drake.html#show-status-of-functions-and-global-objects"><i class="fa fa-check"></i><b>9.2.6</b> Show status of functions and global objects</a></li>
<li class="chapter" data-level="9.2.7" data-path="drake.html"><a href="drake.html#dynamic-branching-with-dplyrgroup_by"><i class="fa fa-check"></i><b>9.2.7</b> Dynamic branching with <code>dplyr::group_by()</code></a></li>
<li class="chapter" data-level="9.2.8" data-path="drake.html"><a href="drake.html#composable-dynamic-branching"><i class="fa fa-check"></i><b>9.2.8</b> Composable dynamic branching</a></li>
<li class="chapter" data-level="9.2.9" data-path="drake.html"><a href="drake.html#improved-parallel-efficiency"><i class="fa fa-check"></i><b>9.2.9</b> Improved parallel efficiency</a></li>
<li class="chapter" data-level="9.2.10" data-path="drake.html"><a href="drake.html#metaprogramming"><i class="fa fa-check"></i><b>9.2.10</b> Metaprogramming</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The targets R Package User Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="practice" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Best practices for <code>targets</code>-powered projects</h1>
<p>The <a href="https://github.com/wlandau/targets"><code>targets</code></a> package espouses a clean, organized, modular, function-oriented style of programming. Many data scientists and researchers initially find this style uncomfortable, not only because it can be unfamiliar, but also because may requires us to postpone our thinking about actual results and conclusions while we focus on the process of creating a new workflow. However, this up-front cost pays off. Data science projects become easier to extend, maintain, and share with collaborators, and they have longer shelf lives than otherwise. In other words, we increase reproducibility while decreasing technical debt. Once these patterns become habits, the pace of development quickens while still lending more trust and credibility to the results.</p>
<div id="a-move-away-from-imperative-scripts" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> A move away from imperative scripts</h2>
<p>Traditional data analysis projects are usually coded as collections of imperative scripts, often with numeric prefixes.</p>
<pre><code>01-data.R
02-preprocess.R
03-analysis.R
04-summaries.R</code></pre>
<p>This approach does not scale well in large, cumbersome projects. Code gets tangled, messy, and difficult to test. Results fail to keep pace with rapid development, and reproducibility suffers.</p>
</div>
<div id="functions" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Functions</h2>
<p>Functions are the most idiomatic way to express the modularity we need. They are custom shorthand that makes code easier to read and easier to test. A good pure function has</p>
<ol style="list-style-type: decimal">
<li>An informative name that describes what the function does.</li>
<li>Input arguments that are easy to generate.</li>
<li>A return value that is convenient to introspect and meaningful to the project.</li>
</ol>
<ol style="list-style-type: decimal">
<li>is the shorthand, and (2) and (3) make testing easier. In data science workflows, we typically write individual functions to</li>
</ol>
<ol style="list-style-type: decimal">
<li>Retrieve or generate a dataset.</li>
<li>Preprocess a dataset.</li>
<li>Fit a model to a preprocessed dataset.</li>
<li>Generate machine-readable summaries of the model fit (tables of summary statistics).</li>
<li>Generate <em>human</em>-readable summaries of the model fit (plots and reports).</li>
</ol>
<p>Each of the functions in (1)-(5) typically calls custom inner functions to increase modularity even further. For examples, see the <code>functions.R</code> files in the example projects <a href="https://wlandau.github.io/targets/index.html#examples">listed here</a>.</p>
</div>
<div id="packages" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Packages</h2>
<p>When it comes time to decide which targets to rerun or skip, the default behavior is to ignore changes to external R packages. Usually, local package libraries do not need to change very often, and it is best to maintain a reproducible project library using <a href="https://rstudio.github.io/renv/articles/renv.html"><code>renv</code></a>.</p>
<p>However, there are some situations where it makes sense to watch a package for changes. For example, you could be in the middle of developing a methodology package that serves as the focus of the pipeline, or you could implement the workflow itself as a package. In either case, you can tell <code>targets</code> to track changes using the <code>imports</code> argument to <code>tar_option_set()</code>. If you write <code>tar_option_set(imports = "package1")</code> in <code>_targets.R</code>, then <code>targets</code> will analyze the R objects in <code>package1</code> and automatically rerun the dependent targets when these objects change. These tracked objects include unexported functions internal to the package. You can track multiple packages this way, e.g. <code>tar_option_set(imports = c("package1", "package2"))</code>. In this case, the contents of <code>package1</code> override those of <code>package2</code> when there are name conflicts. Likewise, <code>tar_option_get("envir")</code> (usually the global environment) overrides both.</p>
</div>
<div id="targets" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Targets</h2>
<p>Targets are imperative high-level steps of the workflow that run the work you define in your functions. Like functions, targets generally focus on datasets, analyses, and summaries. The <code>targets</code> package automatically skips targets that are already up to date, so you should strive to define targets that maximize time savings. Good targets usually</p>
<ol style="list-style-type: decimal">
<li>Are large enough to subtract a decent amount of runtime when skipped.</li>
<li>Are small enough that some targets can be skipped even if others need to run.</li>
<li>Invoke no side effects such as modifications to the global environment. (But targets with <code>tar_target(format = "file")</code> can save files.)</li>
<li>Return a single value that is
<ol style="list-style-type: lower-roman">
<li>Easy to understand and introspect.</li>
<li>Meaningful to the project.</li>
<li>Easy to save as a file, e.g. with <code>readRDS()</code>.</li>
</ol></li>
</ol>
<p>Regarding the last point above, it is possible to customize the storage format of the target. For details, enter <code>?tar_target</code> in the console and scroll down to the description of the <code>format</code> argument.</p>
</div>
<div id="dependencies" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Dependencies</h2>
<p>Adept pipeline construction requires an understanding of dependency detection. To identify the targets and global objects that each target depends on, the <code>targets</code> package uses static code analysis with <a href="https://CRAN.R-project.org/package=codetools"><code>codetools</code></a>, and you can emulate this process with <code>tar_deps()</code>. Let us look at the dependencies of the <code>raw_data</code> target.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="practice.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_deps</span>(<span class="cf">function</span>() {</span>
<span id="cb25-2"><a href="practice.html#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(raw_data_file, <span class="at">col_types =</span> <span class="fu">cols</span>())</span>
<span id="cb25-3"><a href="practice.html#cb25-3" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-4"><a href="practice.html#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;{&quot;             &quot;cols&quot;          &quot;raw_data_file&quot; &quot;read_csv&quot;</span></span></code></pre></div>
<p>The <code>raw_data</code> target depends on target <code>raw_data_file</code> because the command for <code>raw_data</code> mentions the symbol <code>raw_data_file</code>. Similarly, if we were to create a user-defined <code>read_csv()</code> function, the <code>raw_data</code> target would also depend on <code>read_csv()</code> and any other user-defined global functions and objects nested inside <code>read_csv()</code>. Changes to any of these objects would cause the <code>raw_data</code> target to rerun on the next <code>tar_make()</code>.</p>
<p>Not all of the objects from <code>tar_deps()</code> actually register as dependencies. When it comes to detecting dependencies, <code>targets</code> only recognizes</p>
<ol style="list-style-type: decimal">
<li>Other targets (such as <code>raw_data_file</code>).</li>
<li>Functions and objects in the main environment. This environment is almost always the global environment of the R process that runs <code>_targets.R</code>, so these dependencies are usually going to be the custom functions and objects you write yourself.</li>
</ol>
<p>This process excludes many objects from dependency detection. For example, both <code>{</code> and <code>cols()</code> are excluded because they are defined in the environments of packages (<code>base</code> and <code>readr</code>, respectively). Functions and objects from packages are ignored unless you supply a package environment to the <code>envir</code> argument of <code>tar_option_set()</code> when you call it in <code>_targets.R</code>, e.g. <code>tar_option_set(envir = getNamespace("packageName"))</code>. You should only set <code>envir</code> if you write your own package to contain your whole data analysis project.</p>
</div>
<div id="monitoring" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> Monitoring</h2>
<p>If you are using <code>targets</code>, then you probably have an intense computation like Bayesian data analysis or machine learning. These tasks take a long time to run, and it is a good idea to monitor them. If you are running the work on your local machine, you can monitor parallel workers with a utility like <code>top</code> or <code>htop</code>. If you are using a traditional HPC scheduler like SLURM or SGE, you can check the status of the workers with <code>squeue</code>, <code>qstat</code>, or similar. But those tools do not always give you a high-level view of what the pipeline has done and which targets are going to run next. For that information, <code>targets</code> has options:</p>
<ol style="list-style-type: decimal">
<li><code>tar_progress()</code> returns a data frame describing the targets that started, finished running successfully, got canceled, or errored out.</li>
<li><code>tar_visnetwork()</code> shows this progress information in an interactive <code>visNetwork</code> widget. Set <code>outdated</code> to <code>FALSE</code> to get slightly more detailed progress information.</li>
<li><code>tar_watch()</code> launches an Shiny app that automatically refreshes the graph every few seconds. Try it out in the example below.</li>
</ol>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="practice.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define an example _targets.R file with a slow pipeline.</span></span>
<span id="cb26-2"><a href="practice.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb26-3"><a href="practice.html#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_script</span>({</span>
<span id="cb26-4"><a href="practice.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  sleep_run <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb26-5"><a href="practice.html#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">10</span>)</span>
<span id="cb26-6"><a href="practice.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-7"><a href="practice.html#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb26-8"><a href="practice.html#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(settings, <span class="fu">sleep_run</span>()),</span>
<span id="cb26-9"><a href="practice.html#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(data1, <span class="fu">sleep_run</span>(settings)),</span>
<span id="cb26-10"><a href="practice.html#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(data2, <span class="fu">sleep_run</span>(settings)),</span>
<span id="cb26-11"><a href="practice.html#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(data3, <span class="fu">sleep_run</span>(settings)),</span>
<span id="cb26-12"><a href="practice.html#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(model1, <span class="fu">sleep_run</span>(data1)),</span>
<span id="cb26-13"><a href="practice.html#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(model2, <span class="fu">sleep_run</span>(data2)),</span>
<span id="cb26-14"><a href="practice.html#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(model3, <span class="fu">sleep_run</span>(data3)),</span>
<span id="cb26-15"><a href="practice.html#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(figure1, <span class="fu">sleep_run</span>(model1)),</span>
<span id="cb26-16"><a href="practice.html#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(figure2, <span class="fu">sleep_run</span>(model2)),</span>
<span id="cb26-17"><a href="practice.html#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(figure3, <span class="fu">sleep_run</span>(model3)),</span>
<span id="cb26-18"><a href="practice.html#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(conclusions, <span class="fu">sleep_run</span>(<span class="fu">c</span>(figure1, figure2, figure3)))</span>
<span id="cb26-19"><a href="practice.html#cb26-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-20"><a href="practice.html#cb26-20" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb26-21"><a href="practice.html#cb26-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-22"><a href="practice.html#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Launch the app in a background process.</span></span>
<span id="cb26-23"><a href="practice.html#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="co"># You may need to refresh the browser if the app is slow to start.</span></span>
<span id="cb26-24"><a href="practice.html#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="co"># The graph automatically refreshes every 10 seconds</span></span>
<span id="cb26-25"><a href="practice.html#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_watch</span>(<span class="at">seconds =</span> <span class="dv">10</span>, <span class="at">outdated =</span> <span class="cn">FALSE</span>, <span class="at">targets_only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-26"><a href="practice.html#cb26-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-27"><a href="practice.html#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Now run the pipeline and watch the graph change.</span></span>
<span id="cb26-28"><a href="practice.html#cb26-28" aria-hidden="true" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="fu">tar_make</span>()</span></code></pre></div>
<p><img src="man/figures/tar_watch.png" />
<code>tar_watch_ui()</code> and <code>tar_watch_server()</code> make this functionality available to other apps through a Shiny module.</p>
</div>
<div id="debugging" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> Debugging</h2>
<p>If one of your targets fails, first look up the error message in <code>tar_meta()</code>. If that does not help, try one of the following techniques.</p>
<div id="workspaces" class="section level3" number="3.7.1">
<h3><span class="header-section-number">3.7.1</span> Workspaces</h3>
<p>Workspaces are special lightweight reference files that allow <code>tar_workspace()</code> to recreate the runtime environment of a target. This lets you troubleshoot issues outside the pipeline in an interactive session. There are two ways to save a workspace file:</p>
<ol style="list-style-type: decimal">
<li>Set <code>error = "workspace"</code> in <code>tar_option_set()</code> or <code>tar_target()</code>. Then, <code>tar_make()</code> and friends will save a workspace file for every target that errors out.</li>
<li>In the <code>workspaces</code> argument of <code>tar_option_set()</code>, specify the targets for which you want to save workspaces. Then, run <code>tar_make()</code> or similar. A workspace file will be saved for each existing target, regardless of whether the target runs or gets skipped in the pipeline.</li>
</ol>
<p>Here is an example of (1).</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="practice.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R file:</span></span>
<span id="cb27-2"><a href="practice.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tidyverse.quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-3"><a href="practice.html#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb27-4"><a href="practice.html#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb27-5"><a href="practice.html#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">crayon.enabled =</span> <span class="cn">FALSE</span>)</span>
<span id="cb27-6"><a href="practice.html#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_option_set</span>(<span class="at">error =</span> <span class="st">&quot;workspace&quot;</span>)</span>
<span id="cb27-7"><a href="practice.html#cb27-7" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(arg, value) {</span>
<span id="cb27-8"><a href="practice.html#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(arg <span class="sc">&lt;</span> <span class="dv">4</span>)</span>
<span id="cb27-9"><a href="practice.html#cb27-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-10"><a href="practice.html#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb27-11"><a href="practice.html#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(x, <span class="fu">seq_len</span>(<span class="dv">4</span>)),</span>
<span id="cb27-12"><a href="practice.html#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb27-13"><a href="practice.html#cb27-13" aria-hidden="true" tabindex="-1"></a>    y,</span>
<span id="cb27-14"><a href="practice.html#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">f</span>(<span class="at">arg =</span> x, <span class="at">value =</span> <span class="st">&quot;succeeded&quot;</span>, <span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">key =</span> <span class="st">&quot;my_api_key&quot;</span>),</span>
<span id="cb27-15"><a href="practice.html#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="fu">map</span>(x) <span class="co"># The branching chapter describes patterns.</span></span>
<span id="cb27-16"><a href="practice.html#cb27-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-17"><a href="practice.html#cb27-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="practice.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R console:</span></span>
<span id="cb28-2"><a href="practice.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>()</span>
<span id="cb28-3"><a href="practice.html#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● run target x</span></span>
<span id="cb28-4"><a href="practice.html#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● run branch y_29239c8a</span></span>
<span id="cb28-5"><a href="practice.html#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● run branch y_7cc32924</span></span>
<span id="cb28-6"><a href="practice.html#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● run branch y_bd602d50</span></span>
<span id="cb28-7"><a href="practice.html#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● run branch y_05f206d7</span></span>
<span id="cb28-8"><a href="practice.html#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x error branch y_05f206d7</span></span>
<span id="cb28-9"><a href="practice.html#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● save workspace y_05f206d7</span></span>
<span id="cb28-10"><a href="practice.html#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error : x &lt; 4 is not TRUE .</span></span>
<span id="cb28-11"><a href="practice.html#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error: callr subprocess failed: x &lt; 4 is not TRUE .</span></span></code></pre></div>
<p>One of the <code>y_*******</code> targets errored out.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="practice.html#cb29-1" aria-hidden="true" tabindex="-1"></a>failed <span class="ot">&lt;-</span> <span class="fu">tar_meta</span>(<span class="at">fields =</span> error) <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="practice.html#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="practice.html#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(name)</span>
<span id="cb29-4"><a href="practice.html#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="practice.html#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(failed)</span>
<span id="cb29-6"><a href="practice.html#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y_05f206d7&quot;</span></span></code></pre></div>
<p><code>tar_workspace()</code> reads the special metadata in the workspace file and then loads the target’s dependencies from various locations in <code>_targets/objects</code> and/or the <a href="cloud.html#cloud">cloud</a>. It also sets the random number generator seed to the seed of the target, loads the required packages, and runs <code>_targets.R</code> to load other global object dependencies such as functions.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="practice.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_workspace</span>(y_05f206d7)</span></code></pre></div>
<p>We now have the dependencies of <code>y_05f206d7</code> in memory, which allows you to try out any failed function calls in your local R session. <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="practice.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x)</span>
<span id="cb31-2"><a href="practice.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb31-3"><a href="practice.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="at">arg =</span> <span class="dv">0</span>, <span class="at">value =</span> <span class="st">&quot;my_value&quot;</span>, <span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">key =</span> <span class="st">&quot;my_api_key&quot;</span>)</span>
<span id="cb31-4"><a href="practice.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;my_value&quot;</span></span>
<span id="cb31-5"><a href="practice.html#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="at">arg =</span> x, <span class="at">value =</span> <span class="st">&quot;my_value&quot;</span>, <span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">key =</span> <span class="st">&quot;my_api_key&quot;</span>)</span>
<span id="cb31-6"><a href="practice.html#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in f(x) : x &lt; 4 is not TRUE</span></span></code></pre></div>
<p>Keep in mind that that although the dependencies of <code>y_05f206d7</code> are in memory, the arguments of <code>f()</code> are not.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="practice.html#cb32-1" aria-hidden="true" tabindex="-1"></a>arg</span>
<span id="cb32-2"><a href="practice.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error: object &#39;arg&#39; not found</span></span>
<span id="cb32-3"><a href="practice.html#cb32-3" aria-hidden="true" tabindex="-1"></a>value</span>
<span id="cb32-4"><a href="practice.html#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error: object &#39;value&#39; not found</span></span></code></pre></div>
</div>
<div id="interactive-debugging" class="section level3" number="3.7.2">
<h3><span class="header-section-number">3.7.2</span> Interactive debugging</h3>
<p>Interactive debugging offers a <a href="https://adv-r.hadley.nz/debugging.html#browser"><code>browser()</code></a>-like debugging experience. Unlike workspaces, which most users access after the pipline finishes, interactive debugging lets you step through a target’s command while the target is running. This approach is not feasible if the pipeline is running in a non-interactive process or requires resources that are only available on a remote compute node of a cluster. However, when possible, it may be more convenient than workspaces. In our example above, <code>tar_workspace()</code> automatically loaded a branch of the dependency <code>x</code>, but the user still needed to manually supply the rest of the arguments of <code>f()</code>. During interactive debugging, you will instead be able to call <code>debug(f)</code> and then press <code>c</code> to immediately drop into the function environment where the remaining variables are already defined.</p>
<p>Follow these steps to use interactive debugging.</p>
<ol style="list-style-type: decimal">
<li>In <code>_targets.R</code>, write a call to <code>tar_option_set()</code> with <code>debug</code> equal to the target name. Consider also setting <code>cue</code> equal to <code>tar_cue(mode = "never")</code> so <code>tar_make()</code> reaches the target you want to debug more quickly.</li>
<li>Launch a fresh clean new interactive R session with the <code>_targets.R</code> script in your working directory.</li>
<li>Run <code>targets::tar_make()</code> (or <code>targets::tar_make_clustermq()</code>, or <code>targets::tar_make_future()</code>) with <code>callr_function = NULL</code>.</li>
<li>When <code>targets</code> reaches the target you selected to debug, your R session will start an interactive debugger, and you should see <code>Browse[1]&gt;</code> in your console. Run <code>targets::tar_name()</code> to verify that you are debugging the correct target.</li>
<li>Interactively run any R code that helps you troubleshoot the problem. For example, if the target invokes a function <code>f()</code>, enter <code>debug(f)</code> and then <code>c</code> to immediately enter the function’s calling environment where all its arguments are defined.</li>
</ol>
<p>To try it out yourself, write the following <code>_targets.R</code> file.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="practice.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R</span></span>
<span id="cb33-2"><a href="practice.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb33-3"><a href="practice.html#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_option_set</span>(<span class="at">debug =</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb33-4"><a href="practice.html#cb33-4" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">another_arg =</span> <span class="dv">123</span>) x <span class="sc">+</span> another_arg</span>
<span id="cb33-5"><a href="practice.html#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb33-6"><a href="practice.html#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(a, <span class="dv">1</span>),</span>
<span id="cb33-7"><a href="practice.html#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(b, <span class="fu">f</span>(a))</span>
<span id="cb33-8"><a href="practice.html#cb33-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Then, call <code>tar_make(callr_function = NULL)</code> to drop into a debugger at the command of <code>b</code>.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="practice.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R console</span></span>
<span id="cb34-2"><a href="practice.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>(<span class="at">callr_function =</span> <span class="cn">NULL</span>)</span>
<span id="cb34-3"><a href="practice.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● run target a</span></span>
<span id="cb34-4"><a href="practice.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● run target b</span></span>
<span id="cb34-5"><a href="practice.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Called from: eval(expr, envir)</span></span>
<span id="cb34-6"><a href="practice.html#cb34-6" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span></span></code></pre></div>
<p>When the debugger launches, run <code>targets::tar_name()</code> to confirm you are running the correct target.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="practice.html#cb35-1" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span> targets<span class="sc">::</span><span class="fu">tar_name</span>()</span>
<span id="cb35-2"><a href="practice.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;b&quot;</span></span></code></pre></div>
<p>In the debugger, the dependency targets of <code>b</code> are available in the current environment, and the global objects and functions are available in the parent environment.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="practice.html#cb36-1" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="fu">ls</span>()</span>
<span id="cb36-2"><a href="practice.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;a&quot;</span></span>
<span id="cb36-3"><a href="practice.html#cb36-3" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span> a</span>
<span id="cb36-4"><a href="practice.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb36-5"><a href="practice.html#cb36-5" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="fu">ls</span>(<span class="fu">parent.env</span>(<span class="fu">environment</span>()))</span>
<span id="cb36-6"><a href="practice.html#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;f&quot;</span></span>
<span id="cb36-7"><a href="practice.html#cb36-7" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="fu">f</span>(<span class="dv">1</span>)</span>
<span id="cb36-8"><a href="practice.html#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 124</span></span></code></pre></div>
<p>Enter <code>debug(f)</code> to debug the function <code>f()</code>, and press <code>c</code> to enter the function’s calling environment where <code>another_arg</code> is defined.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="practice.html#cb37-1" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="fu">debug</span>(f)</span>
<span id="cb37-2"><a href="practice.html#cb37-2" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span> c</span>
<span id="cb37-3"><a href="practice.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; debugging in: f(a)</span></span>
<span id="cb37-4"><a href="practice.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; debug at _targets.R#3: x + another_arg</span></span>
<span id="cb37-5"><a href="practice.html#cb37-5" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">2</span>]<span class="sc">&gt;</span> <span class="fu">ls</span>()</span>
<span id="cb37-6"><a href="practice.html#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;another_arg&quot; &quot;x&quot;   </span></span>
<span id="cb37-7"><a href="practice.html#cb37-7" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">2</span>]<span class="sc">&gt;</span> another_arg</span>
<span id="cb37-8"><a href="practice.html#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 123</span></span></code></pre></div>
<p>Visit <a href="https://rstats.wtf/debugging-r-code.html">this page</a> for more information on debugging R code.</p>
</div>
</div>
<div id="performance" class="section level2" number="3.8">
<h2><span class="header-section-number">3.8</span> Performance</h2>
<p>If your pipeline has several thousand targets, functions like <code>tar_make()</code>, <code>tar_outdated()</code>, and <code>tar_visnetwork()</code> may take longer to run. There is an inevitable per-target runtime cost because package needs to check the code and data of each target individually. If this overhead becomes too much, consider batching your work into a smaller group of heavier targets. Using your custom functions, you can make each target perform multiple iterations of a task that was previously given to targets one at a time. For details and an example, please see the discussion on batching at the bottom of the <a href="dynamic.html#dynamic">dynamic branching chapter</a>.</p>
<p>Alternatively, if you see slowness in your project, you can contribute to the package with a profiling study. These contributions are great because they help improve the package. Here are the recommended steps.</p>
<ol style="list-style-type: decimal">
<li>Install the <a href="https://github.com/r-prof/proffer"><code>proffer</code></a> R package and its dependencies.</li>
<li>Run <code>proffer::pprof(tar_make(callr_function = NULL))</code> on your project.</li>
<li>When a web browser pops up with <code>pprof</code>, select the flame graph and screenshot it.</li>
<li>Post the flame graph, along with any code and data you can share, to the <a href="https://github.com/wlandau/targets/issues"><code>targets</code> package issue tracker</a>. The maintainer will have a look and try to make the package faster for your use case if speedups are possible.</li>
</ol>
</div>
<div id="cleaning-up" class="section level2" number="3.9">
<h2><span class="header-section-number">3.9</span> Cleaning up</h2>
<p>There are <a href="https://wlandau.github.io/targets/reference/index.html#section-clean">multiple functions</a> to help you manually remove data or force targets to rerun.</p>
<ul>
<li><a href="https://wlandau.github.io/targets/reference/tar_destroy.html"><code>tar_destroy()</code></a> is by far the most commonly used cleaning function. It removes the <code>_targets/</code> data store completely, deleting all the results from <a href="https://wlandau.github.io/targets/reference/tar_make.html"><code>tar_make()</code></a> except for external files. Use it if you intend to start the pipeline from scratch without any trace of a previous run.</li>
<li><a href="https://wlandau.github.io/targets/reference/tar_prune.html"><code>tar_prune()</code></a> deletes the data and metadata of all the targets no longer present in your current <code>_targets.R</code> file. This is useful if you recently worked through multiple changes to your project and are now trying to discard irrelevant data while keeping the results that still matter.</li>
<li><a href="https://wlandau.github.io/targets/reference/tar_delete.html"><code>tar_delete()</code></a> is more selective than <a href="https://wlandau.github.io/targets/reference/tar_destroy.html"><code>tar_destroy()</code></a> and <a href="https://wlandau.github.io/targets/reference/tar_prune.html"><code>tar_prune()</code></a>. It removes the individual data files of a given set of targets from <code>_targets/objects/</code> while leaving the metadata in <code>_targets/meta/meta</code> alone. If you have a small number of data-heavy targets you need to discard to conserve storage, this function can help.</li>
<li><a href="https://wlandau.github.io/targets/reference/tar_invalidate.html"><code>tar_invalidate()</code></a> is the opposite of <a href="https://wlandau.github.io/targets/reference/tar_delete.html"><code>tar_delete()</code></a>: for the selected targets, it deletes the metadata in <code>_targets/meta/meta</code> but keeps the return values in <code>_targets/objects/</code>. After invalidation, you will still be able to locate the data files with <a href="https://wlandau.github.io/targets/reference/tar_path.html"><code>tar_path()</code></a> and manually salvage them in an emergency. However, <a href="https://wlandau.github.io/targets/reference/tar_load.html"><code>tar_load()</code></a> and <a href="https://wlandau.github.io/targets/reference/tar_read.html"><code>tar_read()</code></a> will not be able to read the data into R, and subesequent calls to <a href="https://wlandau.github.io/targets/reference/tar_make.html"><code>tar_make()</code></a> will attempt to rebuild those targets.</li>
</ul>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>In addition, current random number generator seed (<code>.Random.seed</code>) is also the value <code>y_05f206d7</code> started with.<a href="practice.html#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>When you are finished debugging, you can remove all workspace files with <code>tar_destroy(destroy = "workspaces")</code>.<a href="practice.html#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<div style = "background: #1C356D; color: white; padding: 10px 10px 10px 25px; font-size: 1em; width: 100%;">
  Copyright Eli Lilly and Company
</div>
            </section>

          </div>
        </div>
      </div>
<a href="walkthrough.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="files.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
