<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Dynamic branching | The targets R Package User Manual</title>
  <meta name="description" content="In-depth discussion of the major functionality of targets." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Dynamic branching | The targets R Package User Manual" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://wlandau.github.io/targets-manual" />
  <meta property="og:image" content="https://wlandau.github.io/targets-manual/images/logo.png" />
  <meta property="og:description" content="In-depth discussion of the major functionality of targets." />
  <meta name="github-repo" content="wlandau/targets-manual" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Dynamic branching | The targets R Package User Manual" />
  
  <meta name="twitter:description" content="In-depth discussion of the major functionality of targets." />
  <meta name="twitter:image" content="https://wlandau.github.io/targets-manual/images/logo.png" />

<meta name="author" content="Will Landau" />
<meta name="author" content="Copyright Eli Lilly and Company" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/apple-touch-icon.png" />
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="files.html"/>
<link rel="next" href="static.html"/>
<script src="libs/header-attrs-2.4/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-150843595-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-150843595-1');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#motivation"><i class="fa fa-check"></i><b>1.1</b> Motivation</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#pipeline-toolkits"><i class="fa fa-check"></i><b>1.2</b> Pipeline toolkits</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#the-targets-package"><i class="fa fa-check"></i><b>1.3</b> The <code>targets</code> package</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#what-about-drake"><i class="fa fa-check"></i><b>1.4</b> What about <code>drake</code>?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="walkthrough.html"><a href="walkthrough.html"><i class="fa fa-check"></i><b>2</b> Walkthrough</a>
<ul>
<li class="chapter" data-level="2.1" data-path="walkthrough.html"><a href="walkthrough.html#goal-of-the-analysis"><i class="fa fa-check"></i><b>2.1</b> Goal of the analysis</a></li>
<li class="chapter" data-level="2.2" data-path="walkthrough.html"><a href="walkthrough.html#file-structure"><i class="fa fa-check"></i><b>2.2</b> File structure</a></li>
<li class="chapter" data-level="2.3" data-path="walkthrough.html"><a href="walkthrough.html#inspect-the-pipeline"><i class="fa fa-check"></i><b>2.3</b> Inspect the pipeline</a></li>
<li class="chapter" data-level="2.4" data-path="walkthrough.html"><a href="walkthrough.html#run-the-pipeline"><i class="fa fa-check"></i><b>2.4</b> Run the pipeline</a></li>
<li class="chapter" data-level="2.5" data-path="walkthrough.html"><a href="walkthrough.html#changes"><i class="fa fa-check"></i><b>2.5</b> Changes</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="walkthrough.html"><a href="walkthrough.html#change-code"><i class="fa fa-check"></i><b>2.5.1</b> Change code</a></li>
<li class="chapter" data-level="2.5.2" data-path="walkthrough.html"><a href="walkthrough.html#change-data"><i class="fa fa-check"></i><b>2.5.2</b> Change data</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="walkthrough.html"><a href="walkthrough.html#read-your-data"><i class="fa fa-check"></i><b>2.6</b> Read your data</a></li>
<li class="chapter" data-level="2.7" data-path="walkthrough.html"><a href="walkthrough.html#read-metadata"><i class="fa fa-check"></i><b>2.7</b> Read metadata</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="practice.html"><a href="practice.html"><i class="fa fa-check"></i><b>3</b> Best practices for <code>targets</code>-powered projects</a>
<ul>
<li class="chapter" data-level="3.1" data-path="practice.html"><a href="practice.html#a-move-away-from-imperative-scripts"><i class="fa fa-check"></i><b>3.1</b> A move away from imperative scripts</a></li>
<li class="chapter" data-level="3.2" data-path="practice.html"><a href="practice.html#functions"><i class="fa fa-check"></i><b>3.2</b> Functions</a></li>
<li class="chapter" data-level="3.3" data-path="practice.html"><a href="practice.html#targets"><i class="fa fa-check"></i><b>3.3</b> Targets</a></li>
<li class="chapter" data-level="3.4" data-path="practice.html"><a href="practice.html#dependencies"><i class="fa fa-check"></i><b>3.4</b> Dependencies</a></li>
<li class="chapter" data-level="3.5" data-path="practice.html"><a href="practice.html#debugging"><i class="fa fa-check"></i><b>3.5</b> Debugging</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="practice.html"><a href="practice.html#workspaces"><i class="fa fa-check"></i><b>3.5.1</b> Workspaces</a></li>
<li class="chapter" data-level="3.5.2" data-path="practice.html"><a href="practice.html#interactive-debugging"><i class="fa fa-check"></i><b>3.5.2</b> Interactive debugging</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="practice.html"><a href="practice.html#performance"><i class="fa fa-check"></i><b>3.6</b> Performance</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="files.html"><a href="files.html"><i class="fa fa-check"></i><b>4</b> External files and literate programming</a>
<ul>
<li class="chapter" data-level="4.1" data-path="files.html"><a href="files.html#internal-files"><i class="fa fa-check"></i><b>4.1</b> Internal files</a></li>
<li class="chapter" data-level="4.2" data-path="files.html"><a href="files.html#external-input-files"><i class="fa fa-check"></i><b>4.2</b> External input files</a></li>
<li class="chapter" data-level="4.3" data-path="files.html"><a href="files.html#external-output-files"><i class="fa fa-check"></i><b>4.3</b> External output files</a></li>
<li class="chapter" data-level="4.4" data-path="files.html"><a href="files.html#literate-programming"><i class="fa fa-check"></i><b>4.4</b> Literate programming</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="files.html"><a href="files.html#parameterized-r-markdown"><i class="fa fa-check"></i><b>4.4.1</b> Parameterized R Markdown</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dynamic.html"><a href="dynamic.html"><i class="fa fa-check"></i><b>5</b> Dynamic branching</a>
<ul>
<li class="chapter" data-level="5.1" data-path="dynamic.html"><a href="dynamic.html#patterns"><i class="fa fa-check"></i><b>5.1</b> Patterns</a></li>
<li class="chapter" data-level="5.2" data-path="dynamic.html"><a href="dynamic.html#pattern-types"><i class="fa fa-check"></i><b>5.2</b> Pattern types</a></li>
<li class="chapter" data-level="5.3" data-path="dynamic.html"><a href="dynamic.html#dynamic-branching-over-files"><i class="fa fa-check"></i><b>5.3</b> Dynamic branching over files</a></li>
<li class="chapter" data-level="5.4" data-path="dynamic.html"><a href="dynamic.html#iteration"><i class="fa fa-check"></i><b>5.4</b> Iteration</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="dynamic.html"><a href="dynamic.html#vector"><i class="fa fa-check"></i><b>5.4.1</b> Vector</a></li>
<li class="chapter" data-level="5.4.2" data-path="dynamic.html"><a href="dynamic.html#list"><i class="fa fa-check"></i><b>5.4.2</b> List</a></li>
<li class="chapter" data-level="5.4.3" data-path="dynamic.html"><a href="dynamic.html#group"><i class="fa fa-check"></i><b>5.4.3</b> Group</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="dynamic.html"><a href="dynamic.html#batching"><i class="fa fa-check"></i><b>5.5</b> Batching</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="static.html"><a href="static.html"><i class="fa fa-check"></i><b>6</b> Static branching</a>
<ul>
<li class="chapter" data-level="6.1" data-path="static.html"><a href="static.html#map"><i class="fa fa-check"></i><b>6.1</b> Map</a></li>
<li class="chapter" data-level="6.2" data-path="static.html"><a href="static.html#combine"><i class="fa fa-check"></i><b>6.2</b> Combine</a></li>
<li class="chapter" data-level="6.3" data-path="static.html"><a href="static.html#metaprogram"><i class="fa fa-check"></i><b>6.3</b> Metaprogram</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="hpc.html"><a href="hpc.html"><i class="fa fa-check"></i><b>7</b> High-performance computing</a>
<ul>
<li class="chapter" data-level="7.1" data-path="hpc.html"><a href="hpc.html#clustermq"><i class="fa fa-check"></i><b>7.1</b> Clustermq</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="hpc.html"><a href="hpc.html#clustermq-installation"><i class="fa fa-check"></i><b>7.1.1</b> Clustermq installation</a></li>
<li class="chapter" data-level="7.1.2" data-path="hpc.html"><a href="hpc.html#clustermq-locally"><i class="fa fa-check"></i><b>7.1.2</b> Clustermq locally</a></li>
<li class="chapter" data-level="7.1.3" data-path="hpc.html"><a href="hpc.html#clustermq-remotely"><i class="fa fa-check"></i><b>7.1.3</b> Clustermq remotely</a></li>
<li class="chapter" data-level="7.1.4" data-path="hpc.html"><a href="hpc.html#clustermq-configuration"><i class="fa fa-check"></i><b>7.1.4</b> Clustermq configuration</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="hpc.html"><a href="hpc.html#future"><i class="fa fa-check"></i><b>7.2</b> Future</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="hpc.html"><a href="hpc.html#future-installation"><i class="fa fa-check"></i><b>7.2.1</b> Future installation</a></li>
<li class="chapter" data-level="7.2.2" data-path="hpc.html"><a href="hpc.html#future-locally"><i class="fa fa-check"></i><b>7.2.2</b> Future locally</a></li>
<li class="chapter" data-level="7.2.3" data-path="hpc.html"><a href="hpc.html#future-remotely"><i class="fa fa-check"></i><b>7.2.3</b> Future remotely</a></li>
<li class="chapter" data-level="7.2.4" data-path="hpc.html"><a href="hpc.html#future-configuration"><i class="fa fa-check"></i><b>7.2.4</b> Future configuration</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="hpc.html"><a href="hpc.html#advanced"><i class="fa fa-check"></i><b>7.3</b> Advanced</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="cloud.html"><a href="cloud.html"><i class="fa fa-check"></i><b>8</b> Cloud integration</a>
<ul>
<li class="chapter" data-level="8.1" data-path="cloud.html"><a href="cloud.html#compute"><i class="fa fa-check"></i><b>8.1</b> Compute</a></li>
<li class="chapter" data-level="8.2" data-path="cloud.html"><a href="cloud.html#storage"><i class="fa fa-check"></i><b>8.2</b> Storage</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="cloud.html"><a href="cloud.html#get-started-with-amazon-s3-web-console"><i class="fa fa-check"></i><b>8.2.1</b> Get started with Amazon S3 web console</a></li>
<li class="chapter" data-level="8.2.2" data-path="cloud.html"><a href="cloud.html#configure-your-local-machine"><i class="fa fa-check"></i><b>8.2.2</b> Configure your local machine</a></li>
<li class="chapter" data-level="8.2.3" data-path="cloud.html"><a href="cloud.html#create-s3-buckets"><i class="fa fa-check"></i><b>8.2.3</b> Create S3 buckets</a></li>
<li class="chapter" data-level="8.2.4" data-path="cloud.html"><a href="cloud.html#configure-the-pipeline"><i class="fa fa-check"></i><b>8.2.4</b> Configure the pipeline</a></li>
<li class="chapter" data-level="8.2.5" data-path="cloud.html"><a href="cloud.html#run-the-pipeline-1"><i class="fa fa-check"></i><b>8.2.5</b> Run the pipeline</a></li>
<li class="chapter" data-level="8.2.6" data-path="cloud.html"><a href="cloud.html#manage-the-data"><i class="fa fa-check"></i><b>8.2.6</b> Manage the data</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The targets R Package User Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dynamic" class="section level1" number="5">
<h1><span class="header-section-number">Chapter 5</span> Dynamic branching</h1>
<p>The <code>targets</code> packages supports shorthand to create large pipelines. Dynamic branching defines new targets (i.e. branches) while the pipeline is running, and those definitions can be based on prior results from upstream targets. Relative to <a href="static.html#static">static branching</a>, dynamic branching is better suited to iterating over a larger number of very similar tasks (but can act as an inner layer inside <a href="static.html#static">static branching</a>, as the next chapter demonstrates).</p>
<div id="patterns" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Patterns</h2>
<p>To use dynamic branching, set the <code>pattern</code> argument of <code>tar_target()</code>. A pattern is a dynamic branching specification expressed in terms of functional programming. The following minimal example explores the mechanics of patterns (and examples of branching in real-world projects are <a href="https://wlandau.github.io/targets/index.html#examples">linked from here</a>).</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="dynamic.html#cb47-1" aria-hidden="true"></a><span class="kw">library</span>(targets)</span>
<span id="cb47-2"><a href="dynamic.html#cb47-2" aria-hidden="true"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb47-3"><a href="dynamic.html#cb47-3" aria-hidden="true"></a><span class="kw">tar_script</span>({</span>
<span id="cb47-4"><a href="dynamic.html#cb47-4" aria-hidden="true"></a>  <span class="kw">options</span>(<span class="dt">crayon.enabled =</span> <span class="ot">FALSE</span>, <span class="dt">tidyverse.quiet =</span> <span class="ot">TRUE</span>)</span>
<span id="cb47-5"><a href="dynamic.html#cb47-5" aria-hidden="true"></a>  <span class="kw">tar_pipeline</span>(</span>
<span id="cb47-6"><a href="dynamic.html#cb47-6" aria-hidden="true"></a>    <span class="kw">tar_target</span>(w, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)),</span>
<span id="cb47-7"><a href="dynamic.html#cb47-7" aria-hidden="true"></a>    <span class="kw">tar_target</span>(x, <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">20</span>)),</span>
<span id="cb47-8"><a href="dynamic.html#cb47-8" aria-hidden="true"></a>    <span class="kw">tar_target</span>(y, w <span class="op">+</span><span class="st"> </span>x, <span class="dt">pattern =</span> <span class="kw">map</span>(w, x)),</span>
<span id="cb47-9"><a href="dynamic.html#cb47-9" aria-hidden="true"></a>    <span class="kw">tar_target</span>(z, <span class="kw">sum</span>(y)),</span>
<span id="cb47-10"><a href="dynamic.html#cb47-10" aria-hidden="true"></a>    <span class="kw">tar_target</span>(z2, <span class="kw">length</span>(y), <span class="dt">pattern =</span> <span class="kw">map</span>(y))</span>
<span id="cb47-11"><a href="dynamic.html#cb47-11" aria-hidden="true"></a>  )</span>
<span id="cb47-12"><a href="dynamic.html#cb47-12" aria-hidden="true"></a>})</span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="dynamic.html#cb48-1" aria-hidden="true"></a><span class="kw">tar_visnetwork</span>()</span></code></pre></div>
<div id="htmlwidget-bf8113ac1326a2d90a68" style="width:672px;height:480px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-bf8113ac1326a2d90a68">{"x":{"nodes":{"name":["w","x","y","z","z2"],"type":["stem","stem","map","stem","map"],"status":["outdated","outdated","outdated","outdated","outdated"],"seconds":[null,null,null,null,null],"bytes":[null,null,null,null,null],"branches":[null,null,null,null,null],"id":["w","x","y","z","z2"],"label":["w","x","y","z","z2"],"font.size":[20,20,20,20,20],"level":[1,1,2,3,3],"color":["#5BBCD6","#5BBCD6","#5BBCD6","#5BBCD6","#5BBCD6"],"shape":["dot","dot","square","dot","square"]},"edges":{"from":["y","w","x","y"],"to":["z2","y","y","z"],"arrows":["to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Stem","Map"],"color":["#5BBCD6","#899DA4","#899DA4"],"shape":["dot","dot","square"],"font.size":[20,20,20]},"nodesToDataframe":true}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="dynamic.html#cb49-1" aria-hidden="true"></a><span class="kw">tar_make</span>()</span>
<span id="cb49-2"><a href="dynamic.html#cb49-2" aria-hidden="true"></a><span class="co">#&gt; ● run target w</span></span>
<span id="cb49-3"><a href="dynamic.html#cb49-3" aria-hidden="true"></a><span class="co">#&gt; ● run target x</span></span>
<span id="cb49-4"><a href="dynamic.html#cb49-4" aria-hidden="true"></a><span class="co">#&gt; ● run branch y_61ced14d</span></span>
<span id="cb49-5"><a href="dynamic.html#cb49-5" aria-hidden="true"></a><span class="co">#&gt; ● run branch y_4096b6a8</span></span>
<span id="cb49-6"><a href="dynamic.html#cb49-6" aria-hidden="true"></a><span class="co">#&gt; ● run branch z2_275d234a</span></span>
<span id="cb49-7"><a href="dynamic.html#cb49-7" aria-hidden="true"></a><span class="co">#&gt; ● run branch z2_8c730b35</span></span>
<span id="cb49-8"><a href="dynamic.html#cb49-8" aria-hidden="true"></a><span class="co">#&gt; ● run target z</span></span></code></pre></div>
<p>Above, targets <code>w</code>, <code>x</code>, and <code>z</code> are called <strong>stems</strong> because they provide values for other targets to branch over. Target <code>y</code> is a <strong>pattern</strong> becuase it defines multiple sub-targets, or <strong>branches</strong>, based on the return values of the targets named inside <code>map()</code> or <code>cross()</code>. If we read target <code>y</code> into memory, all the branches will load and get aggregated according to the <code>iteration</code> argument of <code>tar_target()</code>.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="dynamic.html#cb50-1" aria-hidden="true"></a><span class="kw">tar_read</span>(y)</span>
<span id="cb50-2"><a href="dynamic.html#cb50-2" aria-hidden="true"></a><span class="co">#&gt; [1] 11 22</span></span></code></pre></div>
<p>Target <code>z</code> accepts this entire aggregate of <code>y</code> and sums it.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="dynamic.html#cb51-1" aria-hidden="true"></a><span class="kw">tar_read</span>(z)</span>
<span id="cb51-2"><a href="dynamic.html#cb51-2" aria-hidden="true"></a><span class="co">#&gt; [1] 33</span></span></code></pre></div>
<p>Target <code>z2</code> maps over <code>y</code>, so each each branch of <code>z2</code> accepts a branch of <code>y</code>.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="dynamic.html#cb52-1" aria-hidden="true"></a><span class="kw">tar_read</span>(z2)</span>
<span id="cb52-2"><a href="dynamic.html#cb52-2" aria-hidden="true"></a><span class="co">#&gt; [1] 1 1</span></span></code></pre></div>
</div>
<div id="pattern-types" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Pattern types</h2>
<p>As we see above, the <code>map()</code> pattern creates one branch for each tuple of slices of the arguments. For example, <code>map(x, y)</code> creates one branch corresponding to <code>x[1]</code> and <code>y[1]</code> and another branch corresponding to <code>x[2]</code> and <code>y[2]</code>.</p>
<p>The <code>cross()</code> pattern instead creates a target for <em>combination</em> of arguments. Here, <code>cross(x, y)</code> creates 4 targets: One for <code>x[1]</code> and <code>y[1]</code>, one for <code>x[1]</code> and <code>y[2]</code>, one for <code>x[2]</code> and <code>y[1]</code>, and one for <code>x[2]</code> and <code>y[2]</code>. Since we already ran the equivalent <code>map()</code> pattern, the following run only builds the (<code>x[1]</code>, <code>y[2]</code>) and (<code>x[2]</code>, <code>y[1]</code>) branches <code>y</code>.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="dynamic.html#cb53-1" aria-hidden="true"></a><span class="kw">tar_script</span>({</span>
<span id="cb53-2"><a href="dynamic.html#cb53-2" aria-hidden="true"></a>  <span class="kw">options</span>(<span class="dt">crayon.enabled =</span> <span class="ot">FALSE</span>, <span class="dt">tidyverse.quiet =</span> <span class="ot">TRUE</span>)</span>
<span id="cb53-3"><a href="dynamic.html#cb53-3" aria-hidden="true"></a>  <span class="kw">tar_pipeline</span>(</span>
<span id="cb53-4"><a href="dynamic.html#cb53-4" aria-hidden="true"></a>    <span class="kw">tar_target</span>(w, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)),</span>
<span id="cb53-5"><a href="dynamic.html#cb53-5" aria-hidden="true"></a>    <span class="kw">tar_target</span>(x, <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">20</span>)),</span>
<span id="cb53-6"><a href="dynamic.html#cb53-6" aria-hidden="true"></a>    <span class="kw">tar_target</span>(y, w <span class="op">+</span><span class="st"> </span>x, <span class="dt">pattern =</span> <span class="kw">cross</span>(w, x))</span>
<span id="cb53-7"><a href="dynamic.html#cb53-7" aria-hidden="true"></a>  )</span>
<span id="cb53-8"><a href="dynamic.html#cb53-8" aria-hidden="true"></a>})</span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="dynamic.html#cb54-1" aria-hidden="true"></a><span class="kw">tar_make</span>()</span>
<span id="cb54-2"><a href="dynamic.html#cb54-2" aria-hidden="true"></a><span class="co">#&gt; ✔ skip target w</span></span>
<span id="cb54-3"><a href="dynamic.html#cb54-3" aria-hidden="true"></a><span class="co">#&gt; ✔ skip target x</span></span>
<span id="cb54-4"><a href="dynamic.html#cb54-4" aria-hidden="true"></a><span class="co">#&gt; ✔ skip branch y_61ced14d</span></span>
<span id="cb54-5"><a href="dynamic.html#cb54-5" aria-hidden="true"></a><span class="co">#&gt; ● run branch y_4b87fe9a</span></span>
<span id="cb54-6"><a href="dynamic.html#cb54-6" aria-hidden="true"></a><span class="co">#&gt; ● run branch y_6f1bdd19</span></span>
<span id="cb54-7"><a href="dynamic.html#cb54-7" aria-hidden="true"></a><span class="co">#&gt; ✔ skip branch y_4096b6a8</span></span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="dynamic.html#cb55-1" aria-hidden="true"></a><span class="kw">tar_read</span>(y)</span>
<span id="cb55-2"><a href="dynamic.html#cb55-2" aria-hidden="true"></a><span class="co">#&gt; [1] 11 21 12 22</span></span></code></pre></div>
</div>
<div id="dynamic-branching-over-files" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Dynamic branching over files</h2>
<p>Dynamic branching over files is tricky. A target with <code>format = "file"</code> treats the entire set of files as an irreducible bundle. That means in order to branch over files downstream, each file must already have its own branch.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="dynamic.html#cb56-1" aria-hidden="true"></a><span class="kw">tar_pipeline</span>(</span>
<span id="cb56-2"><a href="dynamic.html#cb56-2" aria-hidden="true"></a>  <span class="kw">tar_target</span>(paths, <span class="kw">c</span>(<span class="st">&quot;a.csv&quot;</span>, <span class="st">&quot;b.csv&quot;</span>)),</span>
<span id="cb56-3"><a href="dynamic.html#cb56-3" aria-hidden="true"></a>  <span class="kw">tar_target</span>(files, paths, <span class="dt">format =</span> <span class="st">&quot;file&quot;</span>, <span class="dt">pattern =</span> <span class="kw">map</span>(paths)),</span>
<span id="cb56-4"><a href="dynamic.html#cb56-4" aria-hidden="true"></a>  <span class="kw">tar_target</span>(data, <span class="kw">read_csv</span>(files), <span class="dt">pattern =</span> <span class="kw">map</span>(files))</span>
<span id="cb56-5"><a href="dynamic.html#cb56-5" aria-hidden="true"></a>)</span></code></pre></div>
<p>The <a href="https://wlandau.github.io/tarchetypes/reference/tar_files.html"><code>tar_files()</code></a> function from the <a href="https://github.com/wlandau/tarchetypes"><code>tarchetypes</code></a> package is shorthand for the first two targets above.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="dynamic.html#cb57-1" aria-hidden="true"></a><span class="kw">library</span>(tarchetypes)</span>
<span id="cb57-2"><a href="dynamic.html#cb57-2" aria-hidden="true"></a><span class="kw">tar_pipeline</span>(</span>
<span id="cb57-3"><a href="dynamic.html#cb57-3" aria-hidden="true"></a>  <span class="kw">tar_files</span>(files, <span class="kw">c</span>(<span class="st">&quot;a.csv&quot;</span>, <span class="st">&quot;b.csv&quot;</span>)),</span>
<span id="cb57-4"><a href="dynamic.html#cb57-4" aria-hidden="true"></a>  <span class="kw">tar_target</span>(data, <span class="kw">read_csv</span>(files), <span class="dt">pattern =</span> <span class="kw">map</span>(files))</span>
<span id="cb57-5"><a href="dynamic.html#cb57-5" aria-hidden="true"></a>)</span></code></pre></div>
</div>
<div id="iteration" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Iteration</h2>
<p>There are many ways to slice up a stem for branching, and there are many ways to aggregate the branches of a pattern.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> The <code>iteration</code> argument of <code>tar_target()</code> controls the splitting and aggregation protocol on a target-by-target basis, and you can set the default for all targets with the analogous argument of <code>tar_option_set()</code>.</p>
<div id="vector" class="section level3" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> Vector</h3>
<p><code>targets</code> uses vector iteration by default, and you can opt into this behavior by setting <code>iteration = "vector"</code> in <code>tar_target()</code>. In vector iteration, <code>targets</code> uses the <a href="https://vctrs.r-lib.org/"><code>vctrs</code></a> package to split stems and aggregate banches. That means <code>vctrs::vec_slice()</code> slices up stems like <code>x</code> for mapping, and <code>vctrs::vec_c()</code> aggregates patterns like <code>y</code> for operations like <code>tar_read()</code>.</p>
<p>For atomic vectors like in the example above, this behavior is already intuitive. But if we map over a data frame, each branch will get a row of the data frame due to vector iteration.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="dynamic.html#cb58-1" aria-hidden="true"></a><span class="kw">tar_script</span>({</span>
<span id="cb58-2"><a href="dynamic.html#cb58-2" aria-hidden="true"></a>  <span class="kw">options</span>(<span class="dt">crayon.enabled =</span> <span class="ot">FALSE</span>, <span class="dt">tidyverse.quiet =</span> <span class="ot">TRUE</span>)</span>
<span id="cb58-3"><a href="dynamic.html#cb58-3" aria-hidden="true"></a>  print_and_return &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb58-4"><a href="dynamic.html#cb58-4" aria-hidden="true"></a>    <span class="kw">print</span>(x)</span>
<span id="cb58-5"><a href="dynamic.html#cb58-5" aria-hidden="true"></a>    x</span>
<span id="cb58-6"><a href="dynamic.html#cb58-6" aria-hidden="true"></a>  }</span>
<span id="cb58-7"><a href="dynamic.html#cb58-7" aria-hidden="true"></a>  <span class="kw">tar_pipeline</span>(</span>
<span id="cb58-8"><a href="dynamic.html#cb58-8" aria-hidden="true"></a>    <span class="kw">tar_target</span>(x, <span class="kw">data.frame</span>(<span class="dt">a =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">b =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>))),</span>
<span id="cb58-9"><a href="dynamic.html#cb58-9" aria-hidden="true"></a>    <span class="kw">tar_target</span>(y, <span class="kw">print_and_return</span>(x), <span class="dt">pattern =</span> <span class="kw">map</span>(x))</span>
<span id="cb58-10"><a href="dynamic.html#cb58-10" aria-hidden="true"></a>  )</span>
<span id="cb58-11"><a href="dynamic.html#cb58-11" aria-hidden="true"></a>})</span></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="dynamic.html#cb59-1" aria-hidden="true"></a><span class="kw">tar_make</span>()</span>
<span id="cb59-2"><a href="dynamic.html#cb59-2" aria-hidden="true"></a><span class="co">#&gt; ● run target x</span></span>
<span id="cb59-3"><a href="dynamic.html#cb59-3" aria-hidden="true"></a><span class="co">#&gt; ● run branch y_2e131731</span></span>
<span id="cb59-4"><a href="dynamic.html#cb59-4" aria-hidden="true"></a><span class="co">#&gt;   a b</span></span>
<span id="cb59-5"><a href="dynamic.html#cb59-5" aria-hidden="true"></a><span class="co">#&gt; 1 1 a</span></span>
<span id="cb59-6"><a href="dynamic.html#cb59-6" aria-hidden="true"></a><span class="co">#&gt; ● run branch y_6c3b7977</span></span>
<span id="cb59-7"><a href="dynamic.html#cb59-7" aria-hidden="true"></a><span class="co">#&gt;   a b</span></span>
<span id="cb59-8"><a href="dynamic.html#cb59-8" aria-hidden="true"></a><span class="co">#&gt; 1 2 b</span></span></code></pre></div>
<p>And since <code>y</code> also has iteration = <code>"vector"</code>, the aggregate of <code>y</code> is a single data frame of all the rows.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="dynamic.html#cb60-1" aria-hidden="true"></a><span class="kw">tar_read</span>(y)</span>
<span id="cb60-2"><a href="dynamic.html#cb60-2" aria-hidden="true"></a><span class="co">#&gt;   a b</span></span>
<span id="cb60-3"><a href="dynamic.html#cb60-3" aria-hidden="true"></a><span class="co">#&gt; 1 1 a</span></span>
<span id="cb60-4"><a href="dynamic.html#cb60-4" aria-hidden="true"></a><span class="co">#&gt; 2 2 b</span></span></code></pre></div>
</div>
<div id="list" class="section level3" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> List</h3>
<p>List iteration splits and aggregates targets as simple lists. If target <code>x</code> has <code>"list"</code> iteration, all branches of downstream patterns will get <code>x[[1]]</code>, <code>x[[2]]</code>, and so on. (<code>vctrs::vec_slice()</code> behaves more like <code>[]</code> than <code>[[]]</code>.)</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="dynamic.html#cb61-1" aria-hidden="true"></a><span class="kw">tar_script</span>({</span>
<span id="cb61-2"><a href="dynamic.html#cb61-2" aria-hidden="true"></a>  <span class="kw">options</span>(<span class="dt">crayon.enabled =</span> <span class="ot">FALSE</span>, <span class="dt">tidyverse.quiet =</span> <span class="ot">TRUE</span>)</span>
<span id="cb61-3"><a href="dynamic.html#cb61-3" aria-hidden="true"></a>  print_and_return &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb61-4"><a href="dynamic.html#cb61-4" aria-hidden="true"></a>    <span class="kw">print</span>(x)</span>
<span id="cb61-5"><a href="dynamic.html#cb61-5" aria-hidden="true"></a>    x</span>
<span id="cb61-6"><a href="dynamic.html#cb61-6" aria-hidden="true"></a>  }</span>
<span id="cb61-7"><a href="dynamic.html#cb61-7" aria-hidden="true"></a>  <span class="kw">tar_pipeline</span>(</span>
<span id="cb61-8"><a href="dynamic.html#cb61-8" aria-hidden="true"></a>    <span class="kw">tar_target</span>(</span>
<span id="cb61-9"><a href="dynamic.html#cb61-9" aria-hidden="true"></a>      x,</span>
<span id="cb61-10"><a href="dynamic.html#cb61-10" aria-hidden="true"></a>      <span class="kw">data.frame</span>(<span class="dt">a =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">b =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>)),</span>
<span id="cb61-11"><a href="dynamic.html#cb61-11" aria-hidden="true"></a>      <span class="dt">iteration =</span> <span class="st">&quot;list&quot;</span></span>
<span id="cb61-12"><a href="dynamic.html#cb61-12" aria-hidden="true"></a>    ),</span>
<span id="cb61-13"><a href="dynamic.html#cb61-13" aria-hidden="true"></a>    <span class="kw">tar_target</span>(y, <span class="kw">print_and_return</span>(x), <span class="dt">pattern =</span> <span class="kw">map</span>(x)),</span>
<span id="cb61-14"><a href="dynamic.html#cb61-14" aria-hidden="true"></a>    <span class="kw">tar_target</span>(z, x, <span class="dt">pattern =</span> <span class="kw">map</span>(x), <span class="dt">iteration =</span> <span class="st">&quot;list&quot;</span>)</span>
<span id="cb61-15"><a href="dynamic.html#cb61-15" aria-hidden="true"></a>  )</span>
<span id="cb61-16"><a href="dynamic.html#cb61-16" aria-hidden="true"></a>})</span></code></pre></div>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="dynamic.html#cb62-1" aria-hidden="true"></a><span class="kw">tar_make</span>()</span>
<span id="cb62-2"><a href="dynamic.html#cb62-2" aria-hidden="true"></a><span class="co">#&gt; ● run target x</span></span>
<span id="cb62-3"><a href="dynamic.html#cb62-3" aria-hidden="true"></a><span class="co">#&gt; ● run branch y_651b13c7</span></span>
<span id="cb62-4"><a href="dynamic.html#cb62-4" aria-hidden="true"></a><span class="co">#&gt; [1] 1 2</span></span>
<span id="cb62-5"><a href="dynamic.html#cb62-5" aria-hidden="true"></a><span class="co">#&gt; ● run branch y_1c8c7726</span></span>
<span id="cb62-6"><a href="dynamic.html#cb62-6" aria-hidden="true"></a><span class="co">#&gt; [1] &quot;a&quot; &quot;b&quot;</span></span>
<span id="cb62-7"><a href="dynamic.html#cb62-7" aria-hidden="true"></a><span class="co">#&gt; ● run branch z_651b13c7</span></span>
<span id="cb62-8"><a href="dynamic.html#cb62-8" aria-hidden="true"></a><span class="co">#&gt; ● run branch z_1c8c7726</span></span></code></pre></div>
<p>Aggregation also happens differently. In this case, the vector iteration in <code>y</code> is not ideal, and the list iteration in <code>z</code> gives us more sensible output.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="dynamic.html#cb63-1" aria-hidden="true"></a><span class="kw">tar_read</span>(y)</span>
<span id="cb63-2"><a href="dynamic.html#cb63-2" aria-hidden="true"></a><span class="co">#&gt; Error: Can&#39;t combine `..1` &lt;double&gt; and `..2` &lt;character&gt;.</span></span></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="dynamic.html#cb64-1" aria-hidden="true"></a><span class="kw">tar_read</span>(z)</span>
<span id="cb64-2"><a href="dynamic.html#cb64-2" aria-hidden="true"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb64-3"><a href="dynamic.html#cb64-3" aria-hidden="true"></a><span class="co">#&gt; [1] 1 2</span></span>
<span id="cb64-4"><a href="dynamic.html#cb64-4" aria-hidden="true"></a><span class="co">#&gt; </span></span>
<span id="cb64-5"><a href="dynamic.html#cb64-5" aria-hidden="true"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb64-6"><a href="dynamic.html#cb64-6" aria-hidden="true"></a><span class="co">#&gt; [1] &quot;a&quot; &quot;b&quot;</span></span></code></pre></div>
</div>
<div id="group" class="section level3" number="5.4.3">
<h3><span class="header-section-number">5.4.3</span> Group</h3>
<p>Group iteration brings <code>dplyr::group_by()</code> functionality to patterns. This way, we can map or cross over custom subsets of rows. Consider the following data frame.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="dynamic.html#cb65-1" aria-hidden="true"></a>object &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb65-2"><a href="dynamic.html#cb65-2" aria-hidden="true"></a>  <span class="dt">x =</span> <span class="kw">seq_len</span>(<span class="dv">6</span>),</span>
<span id="cb65-3"><a href="dynamic.html#cb65-3" aria-hidden="true"></a>  <span class="dt">id =</span> <span class="kw">rep</span>(letters[<span class="kw">seq_len</span>(<span class="dv">3</span>)], <span class="dt">each =</span> <span class="dv">2</span>)</span>
<span id="cb65-4"><a href="dynamic.html#cb65-4" aria-hidden="true"></a>)</span>
<span id="cb65-5"><a href="dynamic.html#cb65-5" aria-hidden="true"></a></span>
<span id="cb65-6"><a href="dynamic.html#cb65-6" aria-hidden="true"></a>object</span>
<span id="cb65-7"><a href="dynamic.html#cb65-7" aria-hidden="true"></a><span class="co">#&gt;   x id</span></span>
<span id="cb65-8"><a href="dynamic.html#cb65-8" aria-hidden="true"></a><span class="co">#&gt; 1 1  a</span></span>
<span id="cb65-9"><a href="dynamic.html#cb65-9" aria-hidden="true"></a><span class="co">#&gt; 2 2  a</span></span>
<span id="cb65-10"><a href="dynamic.html#cb65-10" aria-hidden="true"></a><span class="co">#&gt; 3 3  b</span></span>
<span id="cb65-11"><a href="dynamic.html#cb65-11" aria-hidden="true"></a><span class="co">#&gt; 4 4  b</span></span>
<span id="cb65-12"><a href="dynamic.html#cb65-12" aria-hidden="true"></a><span class="co">#&gt; 5 5  c</span></span>
<span id="cb65-13"><a href="dynamic.html#cb65-13" aria-hidden="true"></a><span class="co">#&gt; 6 6  c</span></span></code></pre></div>
<p>To map over the groups of rows defined by the <code>id</code> column, we</p>
<ol style="list-style-type: decimal">
<li>Use <code>group_by()</code> and <code>tar_group()</code> to define the groups of rows, and</li>
<li>Use <code>iteration = "group"</code> in <code>tar_target()</code> to tell downstream patterns to use the row groups.</li>
</ol>
<p>Put together, the pipeline looks like this.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="dynamic.html#cb66-1" aria-hidden="true"></a><span class="kw">tar_script</span>({</span>
<span id="cb66-2"><a href="dynamic.html#cb66-2" aria-hidden="true"></a><span class="kw">options</span>(<span class="dt">crayon.enabled =</span> <span class="ot">FALSE</span>, <span class="dt">tidyverse.quiet =</span> <span class="ot">TRUE</span>)</span>
<span id="cb66-3"><a href="dynamic.html#cb66-3" aria-hidden="true"></a><span class="kw">tar_option_set</span>(<span class="dt">packages =</span> <span class="st">&quot;tidyverse&quot;</span>)</span>
<span id="cb66-4"><a href="dynamic.html#cb66-4" aria-hidden="true"></a></span>
<span id="cb66-5"><a href="dynamic.html#cb66-5" aria-hidden="true"></a><span class="kw">tar_pipeline</span>(</span>
<span id="cb66-6"><a href="dynamic.html#cb66-6" aria-hidden="true"></a>  <span class="kw">tar_target</span>(</span>
<span id="cb66-7"><a href="dynamic.html#cb66-7" aria-hidden="true"></a>    data,</span>
<span id="cb66-8"><a href="dynamic.html#cb66-8" aria-hidden="true"></a>    <span class="kw">data.frame</span>(</span>
<span id="cb66-9"><a href="dynamic.html#cb66-9" aria-hidden="true"></a>      <span class="dt">x =</span> <span class="kw">seq_len</span>(<span class="dv">6</span>),</span>
<span id="cb66-10"><a href="dynamic.html#cb66-10" aria-hidden="true"></a>      <span class="dt">id =</span> <span class="kw">rep</span>(letters[<span class="kw">seq_len</span>(<span class="dv">3</span>)], <span class="dt">each =</span> <span class="dv">2</span>)</span>
<span id="cb66-11"><a href="dynamic.html#cb66-11" aria-hidden="true"></a>    ) <span class="op">%&gt;%</span></span>
<span id="cb66-12"><a href="dynamic.html#cb66-12" aria-hidden="true"></a><span class="st">      </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span></span>
<span id="cb66-13"><a href="dynamic.html#cb66-13" aria-hidden="true"></a><span class="st">      </span><span class="kw">tar_group</span>(),</span>
<span id="cb66-14"><a href="dynamic.html#cb66-14" aria-hidden="true"></a>    <span class="dt">iteration =</span> <span class="st">&quot;group&quot;</span></span>
<span id="cb66-15"><a href="dynamic.html#cb66-15" aria-hidden="true"></a>  ),</span>
<span id="cb66-16"><a href="dynamic.html#cb66-16" aria-hidden="true"></a>  <span class="kw">tar_target</span>(</span>
<span id="cb66-17"><a href="dynamic.html#cb66-17" aria-hidden="true"></a>    subsets,</span>
<span id="cb66-18"><a href="dynamic.html#cb66-18" aria-hidden="true"></a>    data,</span>
<span id="cb66-19"><a href="dynamic.html#cb66-19" aria-hidden="true"></a>    <span class="dt">pattern =</span> <span class="kw">map</span>(data),</span>
<span id="cb66-20"><a href="dynamic.html#cb66-20" aria-hidden="true"></a>    <span class="dt">iteration =</span> <span class="st">&quot;list&quot;</span></span>
<span id="cb66-21"><a href="dynamic.html#cb66-21" aria-hidden="true"></a>  )</span>
<span id="cb66-22"><a href="dynamic.html#cb66-22" aria-hidden="true"></a>)</span>
<span id="cb66-23"><a href="dynamic.html#cb66-23" aria-hidden="true"></a>})</span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="dynamic.html#cb67-1" aria-hidden="true"></a><span class="kw">tar_make</span>()</span>
<span id="cb67-2"><a href="dynamic.html#cb67-2" aria-hidden="true"></a><span class="co">#&gt; ● run target data</span></span>
<span id="cb67-3"><a href="dynamic.html#cb67-3" aria-hidden="true"></a><span class="co">#&gt; ● run branch subsets_9c27c3ec</span></span>
<span id="cb67-4"><a href="dynamic.html#cb67-4" aria-hidden="true"></a><span class="co">#&gt; ● run branch subsets_8c545d52</span></span>
<span id="cb67-5"><a href="dynamic.html#cb67-5" aria-hidden="true"></a><span class="co">#&gt; ● run branch subsets_2babc46e</span></span></code></pre></div>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="dynamic.html#cb68-1" aria-hidden="true"></a><span class="kw">lapply</span>(<span class="kw">tar_read</span>(subsets), as.data.frame)</span>
<span id="cb68-2"><a href="dynamic.html#cb68-2" aria-hidden="true"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb68-3"><a href="dynamic.html#cb68-3" aria-hidden="true"></a><span class="co">#&gt;   x id tar_group</span></span>
<span id="cb68-4"><a href="dynamic.html#cb68-4" aria-hidden="true"></a><span class="co">#&gt; 1 1  a         1</span></span>
<span id="cb68-5"><a href="dynamic.html#cb68-5" aria-hidden="true"></a><span class="co">#&gt; 2 2  a         1</span></span>
<span id="cb68-6"><a href="dynamic.html#cb68-6" aria-hidden="true"></a><span class="co">#&gt; </span></span>
<span id="cb68-7"><a href="dynamic.html#cb68-7" aria-hidden="true"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb68-8"><a href="dynamic.html#cb68-8" aria-hidden="true"></a><span class="co">#&gt;   x id tar_group</span></span>
<span id="cb68-9"><a href="dynamic.html#cb68-9" aria-hidden="true"></a><span class="co">#&gt; 1 3  b         2</span></span>
<span id="cb68-10"><a href="dynamic.html#cb68-10" aria-hidden="true"></a><span class="co">#&gt; 2 4  b         2</span></span>
<span id="cb68-11"><a href="dynamic.html#cb68-11" aria-hidden="true"></a><span class="co">#&gt; </span></span>
<span id="cb68-12"><a href="dynamic.html#cb68-12" aria-hidden="true"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb68-13"><a href="dynamic.html#cb68-13" aria-hidden="true"></a><span class="co">#&gt;   x id tar_group</span></span>
<span id="cb68-14"><a href="dynamic.html#cb68-14" aria-hidden="true"></a><span class="co">#&gt; 1 5  c         3</span></span>
<span id="cb68-15"><a href="dynamic.html#cb68-15" aria-hidden="true"></a><span class="co">#&gt; 2 6  c         3</span></span></code></pre></div>
<p>Row groups are defined in the special <code>tar_group</code> column created by <code>tar_group()</code>.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="dynamic.html#cb69-1" aria-hidden="true"></a><span class="kw">data.frame</span>(</span>
<span id="cb69-2"><a href="dynamic.html#cb69-2" aria-hidden="true"></a>  <span class="dt">x =</span> <span class="kw">seq_len</span>(<span class="dv">6</span>),</span>
<span id="cb69-3"><a href="dynamic.html#cb69-3" aria-hidden="true"></a>  <span class="dt">id =</span> <span class="kw">rep</span>(letters[<span class="kw">seq_len</span>(<span class="dv">3</span>)], <span class="dt">each =</span> <span class="dv">2</span>)</span>
<span id="cb69-4"><a href="dynamic.html#cb69-4" aria-hidden="true"></a>) <span class="op">%&gt;%</span></span>
<span id="cb69-5"><a href="dynamic.html#cb69-5" aria-hidden="true"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span></span>
<span id="cb69-6"><a href="dynamic.html#cb69-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">tar_group</span>()</span>
<span id="cb69-7"><a href="dynamic.html#cb69-7" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 6 x 3</span></span>
<span id="cb69-8"><a href="dynamic.html#cb69-8" aria-hidden="true"></a><span class="co">#&gt; # Groups:   id [3]</span></span>
<span id="cb69-9"><a href="dynamic.html#cb69-9" aria-hidden="true"></a><span class="co">#&gt;       x id    tar_group</span></span>
<span id="cb69-10"><a href="dynamic.html#cb69-10" aria-hidden="true"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;     &lt;int&gt;</span></span>
<span id="cb69-11"><a href="dynamic.html#cb69-11" aria-hidden="true"></a><span class="co">#&gt; 1     1 a             1</span></span>
<span id="cb69-12"><a href="dynamic.html#cb69-12" aria-hidden="true"></a><span class="co">#&gt; 2     2 a             1</span></span>
<span id="cb69-13"><a href="dynamic.html#cb69-13" aria-hidden="true"></a><span class="co">#&gt; 3     3 b             2</span></span>
<span id="cb69-14"><a href="dynamic.html#cb69-14" aria-hidden="true"></a><span class="co">#&gt; 4     4 b             2</span></span>
<span id="cb69-15"><a href="dynamic.html#cb69-15" aria-hidden="true"></a><span class="co">#&gt; 5     5 c             3</span></span>
<span id="cb69-16"><a href="dynamic.html#cb69-16" aria-hidden="true"></a><span class="co">#&gt; 6     6 c             3</span></span></code></pre></div>
<p><code>tar_group()</code> creates this column based on the orderings of the grouping variables supplied to <code>dplyr::group_by()</code>, not the order of the rows in the data.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="dynamic.html#cb70-1" aria-hidden="true"></a>flip_order &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb70-2"><a href="dynamic.html#cb70-2" aria-hidden="true"></a>  <span class="kw">ordered</span>(x, <span class="dt">levels =</span> <span class="kw">sort</span>(<span class="kw">unique</span>(x), <span class="dt">decreasing =</span> <span class="ot">TRUE</span>))</span>
<span id="cb70-3"><a href="dynamic.html#cb70-3" aria-hidden="true"></a>}</span>
<span id="cb70-4"><a href="dynamic.html#cb70-4" aria-hidden="true"></a></span>
<span id="cb70-5"><a href="dynamic.html#cb70-5" aria-hidden="true"></a><span class="kw">data.frame</span>(</span>
<span id="cb70-6"><a href="dynamic.html#cb70-6" aria-hidden="true"></a>  <span class="dt">x =</span> <span class="kw">seq_len</span>(<span class="dv">6</span>),</span>
<span id="cb70-7"><a href="dynamic.html#cb70-7" aria-hidden="true"></a>  <span class="dt">id =</span> <span class="kw">flip_order</span>(<span class="kw">rep</span>(letters[<span class="kw">seq_len</span>(<span class="dv">3</span>)], <span class="dt">each =</span> <span class="dv">2</span>))</span>
<span id="cb70-8"><a href="dynamic.html#cb70-8" aria-hidden="true"></a>) <span class="op">%&gt;%</span></span>
<span id="cb70-9"><a href="dynamic.html#cb70-9" aria-hidden="true"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span></span>
<span id="cb70-10"><a href="dynamic.html#cb70-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">tar_group</span>()</span>
<span id="cb70-11"><a href="dynamic.html#cb70-11" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 6 x 3</span></span>
<span id="cb70-12"><a href="dynamic.html#cb70-12" aria-hidden="true"></a><span class="co">#&gt; # Groups:   id [3]</span></span>
<span id="cb70-13"><a href="dynamic.html#cb70-13" aria-hidden="true"></a><span class="co">#&gt;       x id    tar_group</span></span>
<span id="cb70-14"><a href="dynamic.html#cb70-14" aria-hidden="true"></a><span class="co">#&gt;   &lt;int&gt; &lt;ord&gt;     &lt;int&gt;</span></span>
<span id="cb70-15"><a href="dynamic.html#cb70-15" aria-hidden="true"></a><span class="co">#&gt; 1     1 a             3</span></span>
<span id="cb70-16"><a href="dynamic.html#cb70-16" aria-hidden="true"></a><span class="co">#&gt; 2     2 a             3</span></span>
<span id="cb70-17"><a href="dynamic.html#cb70-17" aria-hidden="true"></a><span class="co">#&gt; 3     3 b             2</span></span>
<span id="cb70-18"><a href="dynamic.html#cb70-18" aria-hidden="true"></a><span class="co">#&gt; 4     4 b             2</span></span>
<span id="cb70-19"><a href="dynamic.html#cb70-19" aria-hidden="true"></a><span class="co">#&gt; 5     5 c             1</span></span>
<span id="cb70-20"><a href="dynamic.html#cb70-20" aria-hidden="true"></a><span class="co">#&gt; 6     6 c             1</span></span></code></pre></div>
<p>The ordering in <code>tar_group</code> agrees with the ordering shown by <code>dplyr::group_keys()</code>.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="dynamic.html#cb71-1" aria-hidden="true"></a><span class="kw">data.frame</span>(</span>
<span id="cb71-2"><a href="dynamic.html#cb71-2" aria-hidden="true"></a>  <span class="dt">x =</span> <span class="kw">seq_len</span>(<span class="dv">6</span>),</span>
<span id="cb71-3"><a href="dynamic.html#cb71-3" aria-hidden="true"></a>  <span class="dt">id =</span> <span class="kw">flip_order</span>(<span class="kw">rep</span>(letters[<span class="kw">seq_len</span>(<span class="dv">3</span>)], <span class="dt">each =</span> <span class="dv">2</span>))</span>
<span id="cb71-4"><a href="dynamic.html#cb71-4" aria-hidden="true"></a>) <span class="op">%&gt;%</span></span>
<span id="cb71-5"><a href="dynamic.html#cb71-5" aria-hidden="true"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span></span>
<span id="cb71-6"><a href="dynamic.html#cb71-6" aria-hidden="true"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">group_keys</span>()</span>
<span id="cb71-7"><a href="dynamic.html#cb71-7" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 3 x 1</span></span>
<span id="cb71-8"><a href="dynamic.html#cb71-8" aria-hidden="true"></a><span class="co">#&gt;   id   </span></span>
<span id="cb71-9"><a href="dynamic.html#cb71-9" aria-hidden="true"></a><span class="co">#&gt; * &lt;ord&gt;</span></span>
<span id="cb71-10"><a href="dynamic.html#cb71-10" aria-hidden="true"></a><span class="co">#&gt; 1 c    </span></span>
<span id="cb71-11"><a href="dynamic.html#cb71-11" aria-hidden="true"></a><span class="co">#&gt; 2 b    </span></span>
<span id="cb71-12"><a href="dynamic.html#cb71-12" aria-hidden="true"></a><span class="co">#&gt; 3 a</span></span></code></pre></div>
<p>Branches are arranged in increasing order with respect to the integers in <code>tar_group</code>.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="dynamic.html#cb72-1" aria-hidden="true"></a><span class="kw">tar_script</span>({</span>
<span id="cb72-2"><a href="dynamic.html#cb72-2" aria-hidden="true"></a><span class="kw">options</span>(<span class="dt">crayon.enabled =</span> <span class="ot">FALSE</span>, <span class="dt">tidyverse.quiet =</span> <span class="ot">TRUE</span>)</span>
<span id="cb72-3"><a href="dynamic.html#cb72-3" aria-hidden="true"></a><span class="kw">tar_option_set</span>(<span class="dt">packages =</span> <span class="st">&quot;tidyverse&quot;</span>)</span>
<span id="cb72-4"><a href="dynamic.html#cb72-4" aria-hidden="true"></a></span>
<span id="cb72-5"><a href="dynamic.html#cb72-5" aria-hidden="true"></a>flip_order &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb72-6"><a href="dynamic.html#cb72-6" aria-hidden="true"></a>  <span class="kw">ordered</span>(x, <span class="dt">levels =</span> <span class="kw">sort</span>(<span class="kw">unique</span>(x), <span class="dt">decreasing =</span> <span class="ot">TRUE</span>))</span>
<span id="cb72-7"><a href="dynamic.html#cb72-7" aria-hidden="true"></a>}</span>
<span id="cb72-8"><a href="dynamic.html#cb72-8" aria-hidden="true"></a></span>
<span id="cb72-9"><a href="dynamic.html#cb72-9" aria-hidden="true"></a><span class="kw">tar_pipeline</span>(</span>
<span id="cb72-10"><a href="dynamic.html#cb72-10" aria-hidden="true"></a>  <span class="kw">tar_target</span>(</span>
<span id="cb72-11"><a href="dynamic.html#cb72-11" aria-hidden="true"></a>    data,</span>
<span id="cb72-12"><a href="dynamic.html#cb72-12" aria-hidden="true"></a>    <span class="kw">data.frame</span>(</span>
<span id="cb72-13"><a href="dynamic.html#cb72-13" aria-hidden="true"></a>      <span class="dt">x =</span> <span class="kw">seq_len</span>(<span class="dv">6</span>),</span>
<span id="cb72-14"><a href="dynamic.html#cb72-14" aria-hidden="true"></a>      <span class="dt">id =</span> <span class="kw">flip_order</span>(<span class="kw">rep</span>(letters[<span class="kw">seq_len</span>(<span class="dv">3</span>)], <span class="dt">each =</span> <span class="dv">2</span>))</span>
<span id="cb72-15"><a href="dynamic.html#cb72-15" aria-hidden="true"></a>    ) <span class="op">%&gt;%</span></span>
<span id="cb72-16"><a href="dynamic.html#cb72-16" aria-hidden="true"></a><span class="st">      </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span></span>
<span id="cb72-17"><a href="dynamic.html#cb72-17" aria-hidden="true"></a><span class="st">      </span><span class="kw">tar_group</span>(),</span>
<span id="cb72-18"><a href="dynamic.html#cb72-18" aria-hidden="true"></a>    <span class="dt">iteration =</span> <span class="st">&quot;group&quot;</span></span>
<span id="cb72-19"><a href="dynamic.html#cb72-19" aria-hidden="true"></a>  ),</span>
<span id="cb72-20"><a href="dynamic.html#cb72-20" aria-hidden="true"></a>  <span class="kw">tar_target</span>(</span>
<span id="cb72-21"><a href="dynamic.html#cb72-21" aria-hidden="true"></a>    subsets,</span>
<span id="cb72-22"><a href="dynamic.html#cb72-22" aria-hidden="true"></a>    data,</span>
<span id="cb72-23"><a href="dynamic.html#cb72-23" aria-hidden="true"></a>    <span class="dt">pattern =</span> <span class="kw">map</span>(data),</span>
<span id="cb72-24"><a href="dynamic.html#cb72-24" aria-hidden="true"></a>    <span class="dt">iteration =</span> <span class="st">&quot;list&quot;</span></span>
<span id="cb72-25"><a href="dynamic.html#cb72-25" aria-hidden="true"></a>  )</span>
<span id="cb72-26"><a href="dynamic.html#cb72-26" aria-hidden="true"></a>)</span>
<span id="cb72-27"><a href="dynamic.html#cb72-27" aria-hidden="true"></a>})</span></code></pre></div>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="dynamic.html#cb73-1" aria-hidden="true"></a><span class="kw">tar_make</span>()</span>
<span id="cb73-2"><a href="dynamic.html#cb73-2" aria-hidden="true"></a><span class="co">#&gt; ● run target data</span></span>
<span id="cb73-3"><a href="dynamic.html#cb73-3" aria-hidden="true"></a><span class="co">#&gt; ● run branch subsets_9249dc2d</span></span>
<span id="cb73-4"><a href="dynamic.html#cb73-4" aria-hidden="true"></a><span class="co">#&gt; ● run branch subsets_5125c804</span></span>
<span id="cb73-5"><a href="dynamic.html#cb73-5" aria-hidden="true"></a><span class="co">#&gt; ● run branch subsets_a50321ad</span></span></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="dynamic.html#cb74-1" aria-hidden="true"></a><span class="kw">lapply</span>(<span class="kw">tar_read</span>(subsets), as.data.frame)</span>
<span id="cb74-2"><a href="dynamic.html#cb74-2" aria-hidden="true"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb74-3"><a href="dynamic.html#cb74-3" aria-hidden="true"></a><span class="co">#&gt;   x id tar_group</span></span>
<span id="cb74-4"><a href="dynamic.html#cb74-4" aria-hidden="true"></a><span class="co">#&gt; 1 5  c         1</span></span>
<span id="cb74-5"><a href="dynamic.html#cb74-5" aria-hidden="true"></a><span class="co">#&gt; 2 6  c         1</span></span>
<span id="cb74-6"><a href="dynamic.html#cb74-6" aria-hidden="true"></a><span class="co">#&gt; </span></span>
<span id="cb74-7"><a href="dynamic.html#cb74-7" aria-hidden="true"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb74-8"><a href="dynamic.html#cb74-8" aria-hidden="true"></a><span class="co">#&gt;   x id tar_group</span></span>
<span id="cb74-9"><a href="dynamic.html#cb74-9" aria-hidden="true"></a><span class="co">#&gt; 1 3  b         2</span></span>
<span id="cb74-10"><a href="dynamic.html#cb74-10" aria-hidden="true"></a><span class="co">#&gt; 2 4  b         2</span></span>
<span id="cb74-11"><a href="dynamic.html#cb74-11" aria-hidden="true"></a><span class="co">#&gt; </span></span>
<span id="cb74-12"><a href="dynamic.html#cb74-12" aria-hidden="true"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb74-13"><a href="dynamic.html#cb74-13" aria-hidden="true"></a><span class="co">#&gt;   x id tar_group</span></span>
<span id="cb74-14"><a href="dynamic.html#cb74-14" aria-hidden="true"></a><span class="co">#&gt; 1 1  a         3</span></span>
<span id="cb74-15"><a href="dynamic.html#cb74-15" aria-hidden="true"></a><span class="co">#&gt; 2 2  a         3</span></span></code></pre></div>
</div>
</div>
<div id="batching" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> Batching</h2>
<p>With dynamic branching, it is super easy to create an enormous number of targets. But when the number of targets starts to exceed a couple hundred, <code>tar_make()</code> slows down, and graphs from <code>tar_visnetwork()</code> start to become unmanageable. If that happens to you, consider batching your work into a smaller number of targets.</p>
<p>The <a href="https://github.com/wlandau/targets-stan"><code>targets-stan</code></a> repository has an excellent example of batching. The goal of the pipeline is to validate a Bayesian model by simulating thousands of dataset, analyzing each with a Bayesian model, and assessing the overall accuracy of the inference. Rather than define a target for each dataset in model, the pipeline breaks up the work into batches, where each batch has multiple datasets or multiple analyses. Here is a version of the pipeline with 40 batches and 25 simulation reps per batch (1000 reps total in a pipeline of 82 targets).</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="dynamic.html#cb75-1" aria-hidden="true"></a><span class="kw">tar_pipeline</span>(</span>
<span id="cb75-2"><a href="dynamic.html#cb75-2" aria-hidden="true"></a>  <span class="kw">tar_target</span>(model_file, <span class="kw">compile_model</span>(<span class="st">&quot;stan/model.stan&quot;</span>), <span class="dt">format =</span> <span class="st">&quot;file&quot;</span>),</span>
<span id="cb75-3"><a href="dynamic.html#cb75-3" aria-hidden="true"></a>  <span class="kw">tar_target</span>(index_batch, <span class="kw">seq_len</span>(<span class="dv">40</span>)),</span>
<span id="cb75-4"><a href="dynamic.html#cb75-4" aria-hidden="true"></a>  <span class="kw">tar_target</span>(index_sim, <span class="kw">seq_len</span>(<span class="dv">25</span>)),</span>
<span id="cb75-5"><a href="dynamic.html#cb75-5" aria-hidden="true"></a>  <span class="kw">tar_target</span>(</span>
<span id="cb75-6"><a href="dynamic.html#cb75-6" aria-hidden="true"></a>    data_continuous,</span>
<span id="cb75-7"><a href="dynamic.html#cb75-7" aria-hidden="true"></a>    purrr<span class="op">::</span><span class="kw">map_dfr</span>(index_sim, <span class="op">~</span><span class="kw">simulate_data_continuous</span>()),</span>
<span id="cb75-8"><a href="dynamic.html#cb75-8" aria-hidden="true"></a>    <span class="dt">pattern =</span> <span class="kw">map</span>(index_batch)</span>
<span id="cb75-9"><a href="dynamic.html#cb75-9" aria-hidden="true"></a>  ),</span>
<span id="cb75-10"><a href="dynamic.html#cb75-10" aria-hidden="true"></a>  <span class="kw">tar_target</span>(</span>
<span id="cb75-11"><a href="dynamic.html#cb75-11" aria-hidden="true"></a>    fit_continuous,</span>
<span id="cb75-12"><a href="dynamic.html#cb75-12" aria-hidden="true"></a>    <span class="kw">map_sims</span>(data_continuous, <span class="dt">model_file =</span> model_file),</span>
<span id="cb75-13"><a href="dynamic.html#cb75-13" aria-hidden="true"></a>    <span class="dt">pattern =</span> <span class="kw">map</span>(data_continuous)</span>
<span id="cb75-14"><a href="dynamic.html#cb75-14" aria-hidden="true"></a>  )</span>
<span id="cb75-15"><a href="dynamic.html#cb75-15" aria-hidden="true"></a>)</span></code></pre></div>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>Slicing is always the same when we branch over an existing pattern. If we have <code>tar_target(y, x, pattern = map(x))</code> and <code>x</code> is another pattern, then each branch of <code>y</code> always gets a branch of <code>x</code> regardless of the iteration method. Likewise, the aggregation of stems does not depend on the iteration method because every stem is already aggregated.<a href="dynamic.html#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<div style = "background: #1C356D; color: white; padding: 10px 10px 10px 25px; font-size: 1em; width: 100%;">
  Copyright Eli Lilly and Company
</div>
            </section>

          </div>
        </div>
      </div>
<a href="files.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="static.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
