<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 Dynamic branching | The targets R Package User Manual</title>
  <meta name="description" content="In-depth discussion of the major functionality of targets." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 Dynamic branching | The targets R Package User Manual" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://books.ropensci.org/targets" />
  <meta property="og:image" content="https://books.ropensci.org/targets/man/figures/logo.png" />
  <meta property="og:description" content="In-depth discussion of the major functionality of targets." />
  <meta name="github-repo" content="ropensci-books/targets" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Dynamic branching | The targets R Package User Manual" />
  
  <meta name="twitter:description" content="In-depth discussion of the major functionality of targets." />
  <meta name="twitter:image" content="https://books.ropensci.org/targets/man/figures/logo.png" />

<meta name="author" content="Will Landau" />
<meta name="author" content="Copyright Eli Lilly and Company" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="man/figures/apple-touch-icon.png" />
  <link rel="shortcut icon" href="man/figures/favicon.ico" type="image/x-icon" />
<link rel="prev" href="markdown.html"/>
<link rel="next" href="static.html"/>
<script src="libs/header-attrs-2.13/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
<script src="libs/vis-9.1.0/vis-network.min.js"></script>
<script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-150843595-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-150843595-1');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The targets R Package User Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction<span></span></a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#motivation"><i class="fa fa-check"></i><b>1.1</b> Motivation<span></span></a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#pipeline-toolkits"><i class="fa fa-check"></i><b>1.2</b> Pipeline toolkits<span></span></a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#the-targets-package"><i class="fa fa-check"></i><b>1.3</b> The <code>targets</code> package<span></span></a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#about-this-manual"><i class="fa fa-check"></i><b>1.4</b> About this manual<span></span></a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#what-about-drake"><i class="fa fa-check"></i><b>1.5</b> What about <code>drake</code>?<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="walkthrough.html"><a href="walkthrough.html"><i class="fa fa-check"></i><b>2</b> Walkthrough<span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="walkthrough.html"><a href="walkthrough.html#about-this-minimal-example"><i class="fa fa-check"></i><b>2.1</b> About this minimal example<span></span></a></li>
<li class="chapter" data-level="2.2" data-path="walkthrough.html"><a href="walkthrough.html#file-structure"><i class="fa fa-check"></i><b>2.2</b> File structure<span></span></a></li>
<li class="chapter" data-level="2.3" data-path="walkthrough.html"><a href="walkthrough.html#target-script-file"><i class="fa fa-check"></i><b>2.3</b> Target script file<span></span></a></li>
<li class="chapter" data-level="2.4" data-path="walkthrough.html"><a href="walkthrough.html#inspect-the-pipeline"><i class="fa fa-check"></i><b>2.4</b> Inspect the pipeline<span></span></a></li>
<li class="chapter" data-level="2.5" data-path="walkthrough.html"><a href="walkthrough.html#run-the-pipeline"><i class="fa fa-check"></i><b>2.5</b> Run the pipeline<span></span></a></li>
<li class="chapter" data-level="2.6" data-path="walkthrough.html"><a href="walkthrough.html#changes"><i class="fa fa-check"></i><b>2.6</b> Changes<span></span></a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="walkthrough.html"><a href="walkthrough.html#change-code"><i class="fa fa-check"></i><b>2.6.1</b> Change code<span></span></a></li>
<li class="chapter" data-level="2.6.2" data-path="walkthrough.html"><a href="walkthrough.html#change-data"><i class="fa fa-check"></i><b>2.6.2</b> Change data<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="walkthrough.html"><a href="walkthrough.html#read-your-data"><i class="fa fa-check"></i><b>2.7</b> Read your data<span></span></a></li>
<li class="chapter" data-level="2.8" data-path="walkthrough.html"><a href="walkthrough.html#read-metadata"><i class="fa fa-check"></i><b>2.8</b> Read metadata<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>3</b> Debugging<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="debugging.html"><a href="debugging.html#error-messages"><i class="fa fa-check"></i><b>3.1</b> Error messages<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="debugging.html"><a href="debugging.html#environment-browser"><i class="fa fa-check"></i><b>3.2</b> Environment browser<span></span></a></li>
<li class="chapter" data-level="3.3" data-path="debugging.html"><a href="debugging.html#the-debug-option"><i class="fa fa-check"></i><b>3.3</b> The debug option<span></span></a></li>
<li class="chapter" data-level="3.4" data-path="debugging.html"><a href="debugging.html#workspaces"><i class="fa fa-check"></i><b>3.4</b> Workspaces<span></span></a></li>
<li class="chapter" data-level="3.5" data-path="debugging.html"><a href="debugging.html#tradeoffs"><i class="fa fa-check"></i><b>3.5</b> Tradeoffs<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="performance.html"><a href="performance.html"><i class="fa fa-check"></i><b>4</b> Performance<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="performance.html"><a href="performance.html#monitoring-the-pipeline"><i class="fa fa-check"></i><b>4.1</b> Monitoring the pipeline<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="performance.html"><a href="performance.html#performance-1"><i class="fa fa-check"></i><b>4.2</b> Performance<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>5</b> Functions<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="functions.html"><a href="functions.html#problems-with-script-based-workflows"><i class="fa fa-check"></i><b>5.1</b> Problems with script-based workflows<span></span></a></li>
<li class="chapter" data-level="5.2" data-path="functions.html"><a href="functions.html#functions-1"><i class="fa fa-check"></i><b>5.2</b> Functions<span></span></a></li>
<li class="chapter" data-level="5.3" data-path="functions.html"><a href="functions.html#writing-functions"><i class="fa fa-check"></i><b>5.3</b> Writing functions<span></span></a></li>
<li class="chapter" data-level="5.4" data-path="functions.html"><a href="functions.html#functions-in-pipelines"><i class="fa fa-check"></i><b>5.4</b> Functions in pipelines<span></span></a></li>
<li class="chapter" data-level="5.5" data-path="functions.html"><a href="functions.html#tracking-changes"><i class="fa fa-check"></i><b>5.5</b> Tracking changes<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="targets.html"><a href="targets.html"><i class="fa fa-check"></i><b>6</b> Target construction<span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="targets.html"><a href="targets.html#target-names"><i class="fa fa-check"></i><b>6.1</b> Target names<span></span></a></li>
<li class="chapter" data-level="6.2" data-path="targets.html"><a href="targets.html#what-a-target-should-do"><i class="fa fa-check"></i><b>6.2</b> What a target should do<span></span></a></li>
<li class="chapter" data-level="6.3" data-path="targets.html"><a href="targets.html#how-much-a-target-should-do"><i class="fa fa-check"></i><b>6.3</b> How much a target should do<span></span></a></li>
<li class="chapter" data-level="6.4" data-path="targets.html"><a href="targets.html#working-with-tools-outside-r"><i class="fa fa-check"></i><b>6.4</b> Working with tools outside R<span></span></a></li>
<li class="chapter" data-level="6.5" data-path="targets.html"><a href="targets.html#side-effects"><i class="fa fa-check"></i><b>6.5</b> Side effects<span></span></a></li>
<li class="chapter" data-level="6.6" data-path="targets.html"><a href="targets.html#dependencies"><i class="fa fa-check"></i><b>6.6</b> Dependencies<span></span></a></li>
<li class="chapter" data-level="6.7" data-path="targets.html"><a href="targets.html#return-value"><i class="fa fa-check"></i><b>6.7</b> Return value<span></span></a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="targets.html"><a href="targets.html#saving"><i class="fa fa-check"></i><b>6.7.1</b> Saving<span></span></a></li>
<li class="chapter" data-level="6.7.2" data-path="targets.html"><a href="targets.html#hashing"><i class="fa fa-check"></i><b>6.7.2</b> Hashing<span></span></a></li>
<li class="chapter" data-level="6.7.3" data-path="targets.html"><a href="targets.html#workaround"><i class="fa fa-check"></i><b>6.7.3</b> Workaround<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>7</b> Packages<span></span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="packages.html"><a href="packages.html#loading-and-configuring-r-packages"><i class="fa fa-check"></i><b>7.1</b> Loading and configuring R packages<span></span></a></li>
<li class="chapter" data-level="7.2" data-path="packages.html"><a href="packages.html#r-packages-as-projects"><i class="fa fa-check"></i><b>7.2</b> R packages as projects<span></span></a></li>
<li class="chapter" data-level="7.3" data-path="packages.html"><a href="packages.html#target-factories"><i class="fa fa-check"></i><b>7.3</b> Target Factories<span></span></a></li>
<li class="chapter" data-level="7.4" data-path="packages.html"><a href="packages.html#package-based-invalidation"><i class="fa fa-check"></i><b>7.4</b> Package-based invalidation<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="projects.html"><a href="projects.html"><i class="fa fa-check"></i><b>8</b> Projects<span></span></a>
<ul>
<li class="chapter" data-level="8.1" data-path="projects.html"><a href="projects.html#extra-reproducibility"><i class="fa fa-check"></i><b>8.1</b> Extra reproducibility<span></span></a></li>
<li class="chapter" data-level="8.2" data-path="projects.html"><a href="projects.html#project-files"><i class="fa fa-check"></i><b>8.2</b> Project files<span></span></a></li>
<li class="chapter" data-level="8.3" data-path="projects.html"><a href="projects.html#multiple-projects"><i class="fa fa-check"></i><b>8.3</b> Multiple projects<span></span></a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="projects.html"><a href="projects.html#create-each-project."><i class="fa fa-check"></i><b>8.3.1</b> Create each project.<span></span></a></li>
<li class="chapter" data-level="8.3.2" data-path="projects.html"><a href="projects.html#configure-each-project."><i class="fa fa-check"></i><b>8.3.2</b> Configure each project.<span></span></a></li>
<li class="chapter" data-level="8.3.3" data-path="projects.html"><a href="projects.html#run-each-project"><i class="fa fa-check"></i><b>8.3.3</b> Run each project<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="projects.html"><a href="projects.html#interdependent-projects"><i class="fa fa-check"></i><b>8.4</b> Interdependent projects<span></span></a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="projects.html"><a href="projects.html#config-inheritance"><i class="fa fa-check"></i><b>8.4.1</b> Config inheritance<span></span></a></li>
<li class="chapter" data-level="8.4.2" data-path="projects.html"><a href="projects.html#sharing-targets"><i class="fa fa-check"></i><b>8.4.2</b> Sharing targets<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="projects.html"><a href="projects.html#the-config-package"><i class="fa fa-check"></i><b>8.5</b> The config package<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>9</b> Data: storage and memory<span></span></a>
<ul>
<li class="chapter" data-level="9.1" data-path="data.html"><a href="data.html#local-data-store"><i class="fa fa-check"></i><b>9.1</b> Local data store<span></span></a></li>
<li class="chapter" data-level="9.2" data-path="data.html"><a href="data.html#external-files"><i class="fa fa-check"></i><b>9.2</b> External files<span></span></a></li>
<li class="chapter" data-level="9.3" data-path="data.html"><a href="data.html#memory"><i class="fa fa-check"></i><b>9.3</b> Memory<span></span></a></li>
<li class="chapter" data-level="9.4" data-path="data.html"><a href="data.html#cloud-storage"><i class="fa fa-check"></i><b>9.4</b> Cloud storage<span></span></a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="data.html"><a href="data.html#cost"><i class="fa fa-check"></i><b>9.4.1</b> Cost<span></span></a></li>
<li class="chapter" data-level="9.4.2" data-path="data.html"><a href="data.html#aws-setup"><i class="fa fa-check"></i><b>9.4.2</b> AWS setup<span></span></a></li>
<li class="chapter" data-level="9.4.3" data-path="data.html"><a href="data.html#gcp-setup"><i class="fa fa-check"></i><b>9.4.3</b> GCP setup<span></span></a></li>
<li class="chapter" data-level="9.4.4" data-path="data.html"><a href="data.html#usage"><i class="fa fa-check"></i><b>9.4.4</b> Usage<span></span></a></li>
<li class="chapter" data-level="9.4.5" data-path="data.html"><a href="data.html#data-version-control"><i class="fa fa-check"></i><b>9.4.5</b> Data version control<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="data.html"><a href="data.html#cleaning-up-local-internal-data-files"><i class="fa fa-check"></i><b>9.5</b> Cleaning up local internal data files<span></span></a></li>
<li class="chapter" data-level="9.6" data-path="data.html"><a href="data.html#literate-programming"><i class="fa fa-check"></i><b>9.6</b> Literate programming<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="markdown.html"><a href="markdown.html"><i class="fa fa-check"></i><b>10</b> Literate programming<span></span></a>
<ul>
<li class="chapter" data-level="10.1" data-path="markdown.html"><a href="markdown.html#rendering-within-a-target"><i class="fa fa-check"></i><b>10.1</b> Rendering within a target<span></span></a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="markdown.html"><a href="markdown.html#parameterized-r-markdown"><i class="fa fa-check"></i><b>10.1.1</b> Parameterized R Markdown<span></span></a></li>
<li class="chapter" data-level="10.1.2" data-path="markdown.html"><a href="markdown.html#single-parameter-set"><i class="fa fa-check"></i><b>10.1.2</b> Single parameter set<span></span></a></li>
<li class="chapter" data-level="10.1.3" data-path="markdown.html"><a href="markdown.html#multiple-parameter-sets"><i class="fa fa-check"></i><b>10.1.3</b> Multiple parameter sets<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="markdown.html"><a href="markdown.html#target-markdown"><i class="fa fa-check"></i><b>10.2</b> Target Markdown<span></span></a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="markdown.html"><a href="markdown.html#access"><i class="fa fa-check"></i><b>10.2.1</b> Access<span></span></a></li>
<li class="chapter" data-level="10.2.2" data-path="markdown.html"><a href="markdown.html#purpose"><i class="fa fa-check"></i><b>10.2.2</b> Purpose<span></span></a></li>
<li class="chapter" data-level="10.2.3" data-path="markdown.html"><a href="markdown.html#example"><i class="fa fa-check"></i><b>10.2.3</b> Example<span></span></a></li>
<li class="chapter" data-level="10.2.4" data-path="markdown.html"><a href="markdown.html#required-packages"><i class="fa fa-check"></i><b>10.2.4</b> Required packages<span></span></a></li>
<li class="chapter" data-level="10.2.5" data-path="markdown.html"><a href="markdown.html#setup"><i class="fa fa-check"></i><b>10.2.5</b> Setup<span></span></a></li>
<li class="chapter" data-level="10.2.6" data-path="markdown.html"><a href="markdown.html#globals"><i class="fa fa-check"></i><b>10.2.6</b> Globals<span></span></a></li>
<li class="chapter" data-level="10.2.7" data-path="markdown.html"><a href="markdown.html#target-definitions"><i class="fa fa-check"></i><b>10.2.7</b> Target definitions<span></span></a></li>
<li class="chapter" data-level="10.2.8" data-path="markdown.html"><a href="markdown.html#pipeline"><i class="fa fa-check"></i><b>10.2.8</b> Pipeline<span></span></a></li>
<li class="chapter" data-level="10.2.9" data-path="markdown.html"><a href="markdown.html#output"><i class="fa fa-check"></i><b>10.2.9</b> Output<span></span></a></li>
<li class="chapter" data-level="10.2.10" data-path="markdown.html"><a href="markdown.html#conditioning-on-interactive-mode"><i class="fa fa-check"></i><b>10.2.10</b> Conditioning on interactive mode<span></span></a></li>
<li class="chapter" data-level="10.2.11" data-path="markdown.html"><a href="markdown.html#tar_interactive"><i class="fa fa-check"></i><b>10.2.11</b> <code>tar_interactive()</code><span></span></a></li>
<li class="chapter" data-level="10.2.12" data-path="markdown.html"><a href="markdown.html#tar_toggle"><i class="fa fa-check"></i><b>10.2.12</b> <code>tar_toggle()</code><span></span></a></li>
<li class="chapter" data-level="10.2.13" data-path="markdown.html"><a href="markdown.html#chunk-options"><i class="fa fa-check"></i><b>10.2.13</b> Chunk options<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="dynamic.html"><a href="dynamic.html"><i class="fa fa-check"></i><b>11</b> Dynamic branching<span></span></a>
<ul>
<li class="chapter" data-level="11.1" data-path="dynamic.html"><a href="dynamic.html#branching"><i class="fa fa-check"></i><b>11.1</b> Branching<span></span></a></li>
<li class="chapter" data-level="11.2" data-path="dynamic.html"><a href="dynamic.html#about-dynamic-branching"><i class="fa fa-check"></i><b>11.2</b> About dynamic branching<span></span></a></li>
<li class="chapter" data-level="11.3" data-path="dynamic.html"><a href="dynamic.html#patterns"><i class="fa fa-check"></i><b>11.3</b> Patterns<span></span></a></li>
<li class="chapter" data-level="11.4" data-path="dynamic.html"><a href="dynamic.html#pattern-construction"><i class="fa fa-check"></i><b>11.4</b> Pattern construction<span></span></a></li>
<li class="chapter" data-level="11.5" data-path="dynamic.html"><a href="dynamic.html#branch-provenance"><i class="fa fa-check"></i><b>11.5</b> Branch provenance<span></span></a></li>
<li class="chapter" data-level="11.6" data-path="dynamic.html"><a href="dynamic.html#testing-patterns"><i class="fa fa-check"></i><b>11.6</b> Testing patterns<span></span></a></li>
<li class="chapter" data-level="11.7" data-path="dynamic.html"><a href="dynamic.html#branching-over-files"><i class="fa fa-check"></i><b>11.7</b> Branching over files<span></span></a></li>
<li class="chapter" data-level="11.8" data-path="dynamic.html"><a href="dynamic.html#branching-over-rows"><i class="fa fa-check"></i><b>11.8</b> Branching over rows<span></span></a></li>
<li class="chapter" data-level="11.9" data-path="dynamic.html"><a href="dynamic.html#iteration"><i class="fa fa-check"></i><b>11.9</b> Iteration<span></span></a>
<ul>
<li class="chapter" data-level="11.9.1" data-path="dynamic.html"><a href="dynamic.html#vector-iteration"><i class="fa fa-check"></i><b>11.9.1</b> Vector iteration<span></span></a></li>
<li class="chapter" data-level="11.9.2" data-path="dynamic.html"><a href="dynamic.html#list-iteration"><i class="fa fa-check"></i><b>11.9.2</b> List iteration<span></span></a></li>
<li class="chapter" data-level="11.9.3" data-path="dynamic.html"><a href="dynamic.html#group-iteration"><i class="fa fa-check"></i><b>11.9.3</b> Group iteration<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11.10" data-path="dynamic.html"><a href="dynamic.html#dynamic-branching-performance"><i class="fa fa-check"></i><b>11.10</b> Dynamic branching performance<span></span></a></li>
<li class="chapter" data-level="11.11" data-path="dynamic.html"><a href="dynamic.html#batching"><i class="fa fa-check"></i><b>11.11</b> Batching<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="static.html"><a href="static.html"><i class="fa fa-check"></i><b>12</b> Static branching<span></span></a>
<ul>
<li class="chapter" data-level="12.1" data-path="static.html"><a href="static.html#branching-1"><i class="fa fa-check"></i><b>12.1</b> Branching<span></span></a></li>
<li class="chapter" data-level="12.2" data-path="static.html"><a href="static.html#when-to-use-static-branching"><i class="fa fa-check"></i><b>12.2</b> When to use static branching<span></span></a></li>
<li class="chapter" data-level="12.3" data-path="static.html"><a href="static.html#map"><i class="fa fa-check"></i><b>12.3</b> Map<span></span></a></li>
<li class="chapter" data-level="12.4" data-path="static.html"><a href="static.html#dynamic-within-static-branching"><i class="fa fa-check"></i><b>12.4</b> Dynamic-within-static branching<span></span></a></li>
<li class="chapter" data-level="12.5" data-path="static.html"><a href="static.html#combine"><i class="fa fa-check"></i><b>12.5</b> Combine<span></span></a></li>
<li class="chapter" data-level="12.6" data-path="static.html"><a href="static.html#metaprogramming"><i class="fa fa-check"></i><b>12.6</b> Metaprogramming<span></span></a></li>
<li class="chapter" data-level="12.7" data-path="static.html"><a href="static.html#hooks"><i class="fa fa-check"></i><b>12.7</b> Hooks<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="hpc.html"><a href="hpc.html"><i class="fa fa-check"></i><b>13</b> High-performance computing<span></span></a>
<ul>
<li class="chapter" data-level="13.1" data-path="hpc.html"><a href="hpc.html#clustermq"><i class="fa fa-check"></i><b>13.1</b> Clustermq<span></span></a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="hpc.html"><a href="hpc.html#persistent-workers"><i class="fa fa-check"></i><b>13.1.1</b> Persistent workers<span></span></a></li>
<li class="chapter" data-level="13.1.2" data-path="hpc.html"><a href="hpc.html#clustermq-installation"><i class="fa fa-check"></i><b>13.1.2</b> Clustermq installation<span></span></a></li>
<li class="chapter" data-level="13.1.3" data-path="hpc.html"><a href="hpc.html#clustermq-locally"><i class="fa fa-check"></i><b>13.1.3</b> Clustermq locally<span></span></a></li>
<li class="chapter" data-level="13.1.4" data-path="hpc.html"><a href="hpc.html#clustermq-remotely"><i class="fa fa-check"></i><b>13.1.4</b> Clustermq remotely<span></span></a></li>
<li class="chapter" data-level="13.1.5" data-path="hpc.html"><a href="hpc.html#clustermq-configuration"><i class="fa fa-check"></i><b>13.1.5</b> Clustermq configuration<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="hpc.html"><a href="hpc.html#future"><i class="fa fa-check"></i><b>13.2</b> Future<span></span></a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="hpc.html"><a href="hpc.html#transient-workers"><i class="fa fa-check"></i><b>13.2.1</b> Transient workers<span></span></a></li>
<li class="chapter" data-level="13.2.2" data-path="hpc.html"><a href="hpc.html#future-installation"><i class="fa fa-check"></i><b>13.2.2</b> Future installation<span></span></a></li>
<li class="chapter" data-level="13.2.3" data-path="hpc.html"><a href="hpc.html#future-locally"><i class="fa fa-check"></i><b>13.2.3</b> Future locally<span></span></a></li>
<li class="chapter" data-level="13.2.4" data-path="hpc.html"><a href="hpc.html#future-remotely"><i class="fa fa-check"></i><b>13.2.4</b> Future remotely<span></span></a></li>
<li class="chapter" data-level="13.2.5" data-path="hpc.html"><a href="hpc.html#future-configuration"><i class="fa fa-check"></i><b>13.2.5</b> Future configuration<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="hpc.html"><a href="hpc.html#advanced"><i class="fa fa-check"></i><b>13.3</b> Advanced<span></span></a></li>
<li class="chapter" data-level="13.4" data-path="hpc.html"><a href="hpc.html#cloud-computing"><i class="fa fa-check"></i><b>13.4</b> Cloud computing<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="drake.html"><a href="drake.html"><i class="fa fa-check"></i><b>14</b> What about <code>drake</code>?<span></span></a>
<ul>
<li class="chapter" data-level="14.1" data-path="drake.html"><a href="drake.html#why-is-drake-superseded"><i class="fa fa-check"></i><b>14.1</b> Why is <code>drake</code> superseded?<span></span></a></li>
<li class="chapter" data-level="14.2" data-path="drake.html"><a href="drake.html#transitioning-to-targets"><i class="fa fa-check"></i><b>14.2</b> Transitioning to <code>targets</code><span></span></a></li>
<li class="chapter" data-level="14.3" data-path="drake.html"><a href="drake.html#advantages-of-targets-over-drake"><i class="fa fa-check"></i><b>14.3</b> Advantages of <code>targets</code> over <code>drake</code><span></span></a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="drake.html"><a href="drake.html#better-guardrails-by-design"><i class="fa fa-check"></i><b>14.3.1</b> Better guardrails by design<span></span></a></li>
<li class="chapter" data-level="14.3.2" data-path="drake.html"><a href="drake.html#enhanced-debugging-support"><i class="fa fa-check"></i><b>14.3.2</b> Enhanced debugging support<span></span></a></li>
<li class="chapter" data-level="14.3.3" data-path="drake.html"><a href="drake.html#improved-tracking-of-package-functions"><i class="fa fa-check"></i><b>14.3.3</b> Improved tracking of package functions<span></span></a></li>
<li class="chapter" data-level="14.3.4" data-path="drake.html"><a href="drake.html#lighter-friendlier-data-management"><i class="fa fa-check"></i><b>14.3.4</b> Lighter, friendlier data management<span></span></a></li>
<li class="chapter" data-level="14.3.5" data-path="drake.html"><a href="drake.html#cloud-storage-1"><i class="fa fa-check"></i><b>14.3.5</b> Cloud storage<span></span></a></li>
<li class="chapter" data-level="14.3.6" data-path="drake.html"><a href="drake.html#show-status-of-functions-and-global-objects"><i class="fa fa-check"></i><b>14.3.6</b> Show status of functions and global objects<span></span></a></li>
<li class="chapter" data-level="14.3.7" data-path="drake.html"><a href="drake.html#dynamic-branching-with-dplyrgroup_by"><i class="fa fa-check"></i><b>14.3.7</b> Dynamic branching with <code>dplyr::group_by()</code><span></span></a></li>
<li class="chapter" data-level="14.3.8" data-path="drake.html"><a href="drake.html#composable-dynamic-branching"><i class="fa fa-check"></i><b>14.3.8</b> Composable dynamic branching<span></span></a></li>
<li class="chapter" data-level="14.3.9" data-path="drake.html"><a href="drake.html#improved-parallel-efficiency"><i class="fa fa-check"></i><b>14.3.9</b> Improved parallel efficiency<span></span></a></li>
<li class="chapter" data-level="14.3.10" data-path="drake.html"><a href="drake.html#metaprogramming-1"><i class="fa fa-check"></i><b>14.3.10</b> Metaprogramming<span></span></a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The targets R Package User Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dynamic" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">Chapter 11</span> Dynamic branching<a href="dynamic.html#dynamic" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="branching" class="section level2 hasAnchor" number="11.1">
<h2><span class="header-section-number">11.1</span> Branching<a href="dynamic.html#branching" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Sometimes, a pipeline contains more targets than a user can comfortably type by hand. For projects with hundreds of targets, branching can make the <code>_targets.R</code> file more concise and easier to read and maintain.</p>
<p><code>targets</code> supports two types of branching: dynamic branching and <a href="static.html#static">static branching</a>. Some projects are better suited to dynamic branching, while others benefit more from <a href="static.html#static">static branching</a> or a combination of both. Some users understand dynamic branching more easily because it avoids metaprogramming, while others prefer <a href="static.html#static">static branching</a> because <code>tar_manifest()</code> and <code>tar_visnetwork()</code> provide immediate feedback. Except for the <a href="static.html#dynamic-within-static-branching">section on dynamic-within-static branching</a>, you can read the two chapters on branching in any order (or skip them) depending on your needs.</p>
</div>
<div id="about-dynamic-branching" class="section level2 hasAnchor" number="11.2">
<h2><span class="header-section-number">11.2</span> About dynamic branching<a href="dynamic.html#about-dynamic-branching" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Dynamic branching is the act of defining new targets (i.e. branches) while the pipeline is running. Prior to launching the pipeline, the user does not necessarily know which branches will spawn or how many branches there will be, and each branch’s inputs are determined at the last minute. Relative to <a href="static.html#static">static branching</a>, dynamic branching is better suited to iterating over a larger number of very similar tasks (but can act as an inner layer inside <a href="static.html#static">static branching</a>, as the next chapter demonstrates).</p>
</div>
<div id="patterns" class="section level2 hasAnchor" number="11.3">
<h2><span class="header-section-number">11.3</span> Patterns<a href="dynamic.html#patterns" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To use dynamic branching, set the <code>pattern</code> argument of <code>tar_target()</code>. A pattern is a dynamic branching specification expressed in terms of functional programming. The following minimal example explores the mechanics of patterns (and examples of branching in real-world projects are <a href="https://docs.ropensci.org/targets/index.html#examples">linked from here</a>).</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="dynamic.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R</span></span>
<span id="cb119-2"><a href="dynamic.html#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb119-3"><a href="dynamic.html#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb119-4"><a href="dynamic.html#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(w, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)),</span>
<span id="cb119-5"><a href="dynamic.html#cb119-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(x, <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>)),</span>
<span id="cb119-6"><a href="dynamic.html#cb119-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(y, w <span class="sc">+</span> x, <span class="at">pattern =</span> <span class="fu">map</span>(w, x)),</span>
<span id="cb119-7"><a href="dynamic.html#cb119-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(z, <span class="fu">sum</span>(y)),</span>
<span id="cb119-8"><a href="dynamic.html#cb119-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(z2, <span class="fu">length</span>(y), <span class="at">pattern =</span> <span class="fu">map</span>(y))</span>
<span id="cb119-9"><a href="dynamic.html#cb119-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="dynamic.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_visnetwork</span>()</span></code></pre></div>
<div id="htmlwidget-d62426f761e64a380948" style="width:672px;height:480px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-d62426f761e64a380948">{"x":{"nodes":{"name":["w","x","y","z","z2"],"type":["stem","stem","pattern","stem","pattern"],"status":["outdated","outdated","outdated","outdated","outdated"],"seconds":[null,null,null,null,null],"bytes":[null,null,null,null,null],"branches":[null,null,null,null,null],"label":["w","x","y","z","z2"],"color":["#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5"],"id":["w","x","y","z","z2"],"level":[1,1,2,3,3],"shape":["dot","dot","square","dot","square"]},"edges":{"from":["y","w","x","y"],"to":["z2","y","y","z"],"arrows":["to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"physics":{"stabilization":false},"interaction":{"zoomSpeed":1},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":1,"to":1},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Stem","Pattern"],"color":["#78B7C5","#899DA4","#899DA4"],"shape":["dot","dot","square"]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="dynamic.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>()</span>
<span id="cb121-2"><a href="dynamic.html#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start target w</span></span>
<span id="cb121-3"><a href="dynamic.html#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built target w</span></span>
<span id="cb121-4"><a href="dynamic.html#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start target x</span></span>
<span id="cb121-5"><a href="dynamic.html#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built target x</span></span>
<span id="cb121-6"><a href="dynamic.html#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch y_61ced14d</span></span>
<span id="cb121-7"><a href="dynamic.html#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch y_61ced14d</span></span>
<span id="cb121-8"><a href="dynamic.html#cb121-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch y_4096b6a8</span></span>
<span id="cb121-9"><a href="dynamic.html#cb121-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch y_4096b6a8</span></span>
<span id="cb121-10"><a href="dynamic.html#cb121-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built pattern y</span></span>
<span id="cb121-11"><a href="dynamic.html#cb121-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch z2_275d234a</span></span>
<span id="cb121-12"><a href="dynamic.html#cb121-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch z2_275d234a</span></span>
<span id="cb121-13"><a href="dynamic.html#cb121-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch z2_8c730b35</span></span>
<span id="cb121-14"><a href="dynamic.html#cb121-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch z2_8c730b35</span></span>
<span id="cb121-15"><a href="dynamic.html#cb121-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built pattern z2</span></span>
<span id="cb121-16"><a href="dynamic.html#cb121-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start target z</span></span>
<span id="cb121-17"><a href="dynamic.html#cb121-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built target z</span></span>
<span id="cb121-18"><a href="dynamic.html#cb121-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • end pipeline: 0.124 seconds</span></span></code></pre></div>
<p>Above, targets <code>w</code>, <code>x</code>, and <code>z</code> are called <strong>stems</strong> because they do not create branches themselves. Target <code>y</code> is a <strong>pattern</strong> because it creates its own <strong>branches</strong> like <code>y_4096b6a8</code>. A branch is a special kind of target whose dependencies are slices of the targets mentioned in <code>pattern = map(...)</code> etc. If we read target <code>y</code> into memory, all the branches will load and automatically aggregate as a vector.<a href="drake.html#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a></p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="dynamic.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read</span>(y)</span>
<span id="cb122-2"><a href="dynamic.html#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; y_61ced14d y_4096b6a8 </span></span>
<span id="cb122-3"><a href="dynamic.html#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         11         22</span></span></code></pre></div>
<p>Target <code>z</code> accepts this entire aggregate of <code>y</code> and sums it.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="dynamic.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read</span>(z)</span>
<span id="cb123-2"><a href="dynamic.html#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 33</span></span></code></pre></div>
<p>Target <code>z2</code> maps over <code>y</code>, so each each branch of <code>z2</code> accepts a branch of <code>y</code>.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="dynamic.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read</span>(z2)</span>
<span id="cb124-2"><a href="dynamic.html#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; z2_275d234a z2_8c730b35 </span></span>
<span id="cb124-3"><a href="dynamic.html#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           1           1</span></span></code></pre></div>
</div>
<div id="pattern-construction" class="section level2 hasAnchor" number="11.4">
<h2><span class="header-section-number">11.4</span> Pattern construction<a href="dynamic.html#pattern-construction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>targets</code> supports the following pattern types.</p>
<ul>
<li><code>map()</code>: iterate over one or more targets in sequence.</li>
<li><code>cross()</code>: iterate over combinations of slices of targets.</li>
<li><code>slice()</code>: select individual branches slices by numeric index. For example, <code>pattern = slice(x, index = c(3, 4))</code> applies the target’s command to the third and fourth slices (or branches) of upstream target <code>x</code>.</li>
<li><code>head()</code>: restrict branching to the first few elements.</li>
<li><code>tail()</code>: restrict branching to the last few elements.</li>
<li><code>sample()</code>: restrict branching to a random subset of elements.</li>
</ul>
<p>These patterns are composable. Below, target <code>z</code> creates six branches, one for each combination of <code>w</code> and (<code>x</code>, <code>y</code>) pair. The pattern <code>cross(w, map(x, y))</code> is equivalent to <code>tidyr::crossing(w, tidyr::nesting(x, y))</code>.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="dynamic.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R</span></span>
<span id="cb125-2"><a href="dynamic.html#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb125-3"><a href="dynamic.html#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb125-4"><a href="dynamic.html#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(w_comp, <span class="fu">seq_len</span>(<span class="dv">2</span>)),</span>
<span id="cb125-5"><a href="dynamic.html#cb125-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(x_comp, <span class="fu">head</span>(letters, <span class="dv">3</span>)),</span>
<span id="cb125-6"><a href="dynamic.html#cb125-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(y_comp, <span class="fu">head</span>(LETTERS, <span class="dv">3</span>)),</span>
<span id="cb125-7"><a href="dynamic.html#cb125-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb125-8"><a href="dynamic.html#cb125-8" aria-hidden="true" tabindex="-1"></a>    z_comp,</span>
<span id="cb125-9"><a href="dynamic.html#cb125-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">w =</span> w_comp, <span class="at">x =</span> x_comp, <span class="at">y =</span> y_comp),</span>
<span id="cb125-10"><a href="dynamic.html#cb125-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="fu">cross</span>(w_comp, <span class="fu">map</span>(x_comp, y_comp))</span>
<span id="cb125-11"><a href="dynamic.html#cb125-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb125-12"><a href="dynamic.html#cb125-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="dynamic.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R console</span></span>
<span id="cb126-2"><a href="dynamic.html#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>()</span>
<span id="cb126-3"><a href="dynamic.html#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start target w_comp</span></span>
<span id="cb126-4"><a href="dynamic.html#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built target w_comp</span></span>
<span id="cb126-5"><a href="dynamic.html#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start target x_comp</span></span>
<span id="cb126-6"><a href="dynamic.html#cb126-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built target x_comp</span></span>
<span id="cb126-7"><a href="dynamic.html#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start target y_comp</span></span>
<span id="cb126-8"><a href="dynamic.html#cb126-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built target y_comp</span></span>
<span id="cb126-9"><a href="dynamic.html#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch z_comp_a601a6f3</span></span>
<span id="cb126-10"><a href="dynamic.html#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch z_comp_a601a6f3</span></span>
<span id="cb126-11"><a href="dynamic.html#cb126-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch z_comp_38222c1e</span></span>
<span id="cb126-12"><a href="dynamic.html#cb126-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch z_comp_38222c1e</span></span>
<span id="cb126-13"><a href="dynamic.html#cb126-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch z_comp_b9220de4</span></span>
<span id="cb126-14"><a href="dynamic.html#cb126-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch z_comp_b9220de4</span></span>
<span id="cb126-15"><a href="dynamic.html#cb126-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch z_comp_c3fe35d0</span></span>
<span id="cb126-16"><a href="dynamic.html#cb126-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch z_comp_c3fe35d0</span></span>
<span id="cb126-17"><a href="dynamic.html#cb126-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch z_comp_1a64d49a</span></span>
<span id="cb126-18"><a href="dynamic.html#cb126-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch z_comp_1a64d49a</span></span>
<span id="cb126-19"><a href="dynamic.html#cb126-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch z_comp_7cbac5ae</span></span>
<span id="cb126-20"><a href="dynamic.html#cb126-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch z_comp_7cbac5ae</span></span>
<span id="cb126-21"><a href="dynamic.html#cb126-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built pattern z_comp</span></span>
<span id="cb126-22"><a href="dynamic.html#cb126-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • end pipeline: 0.143 seconds</span></span></code></pre></div>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="dynamic.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R console</span></span>
<span id="cb127-2"><a href="dynamic.html#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read</span>(z_comp)</span>
<span id="cb127-3"><a href="dynamic.html#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   w x y</span></span>
<span id="cb127-4"><a href="dynamic.html#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1 a A</span></span>
<span id="cb127-5"><a href="dynamic.html#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 1 b B</span></span>
<span id="cb127-6"><a href="dynamic.html#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 1 c C</span></span>
<span id="cb127-7"><a href="dynamic.html#cb127-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 2 a A</span></span>
<span id="cb127-8"><a href="dynamic.html#cb127-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 2 b B</span></span>
<span id="cb127-9"><a href="dynamic.html#cb127-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 2 c C</span></span></code></pre></div>
<p>With <code>slice()</code>, you can select pieces of a pattern or upstream target as follows.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="dynamic.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R</span></span>
<span id="cb128-2"><a href="dynamic.html#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb128-3"><a href="dynamic.html#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb128-4"><a href="dynamic.html#cb128-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(a_data, letters),</span>
<span id="cb128-5"><a href="dynamic.html#cb128-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(b_data, LETTERS),</span>
<span id="cb128-6"><a href="dynamic.html#cb128-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb128-7"><a href="dynamic.html#cb128-7" aria-hidden="true" tabindex="-1"></a>    c_data,</span>
<span id="cb128-8"><a href="dynamic.html#cb128-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(a_data, b_data),</span>
<span id="cb128-9"><a href="dynamic.html#cb128-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="fu">slice</span>(<span class="fu">cross</span>(a_data, b_data), <span class="at">index =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb128-10"><a href="dynamic.html#cb128-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb128-11"><a href="dynamic.html#cb128-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="dynamic.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R console</span></span>
<span id="cb129-2"><a href="dynamic.html#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>()</span>
<span id="cb129-3"><a href="dynamic.html#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start target a_data</span></span>
<span id="cb129-4"><a href="dynamic.html#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built target a_data</span></span>
<span id="cb129-5"><a href="dynamic.html#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start target b_data</span></span>
<span id="cb129-6"><a href="dynamic.html#cb129-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built target b_data</span></span>
<span id="cb129-7"><a href="dynamic.html#cb129-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch c_data_5a10da89</span></span>
<span id="cb129-8"><a href="dynamic.html#cb129-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch c_data_5a10da89</span></span>
<span id="cb129-9"><a href="dynamic.html#cb129-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch c_data_3a92ccbc</span></span>
<span id="cb129-10"><a href="dynamic.html#cb129-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch c_data_3a92ccbc</span></span>
<span id="cb129-11"><a href="dynamic.html#cb129-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built pattern c_data</span></span>
<span id="cb129-12"><a href="dynamic.html#cb129-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • end pipeline: 0.112 seconds</span></span></code></pre></div>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="dynamic.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R console</span></span>
<span id="cb130-2"><a href="dynamic.html#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read</span>(c_data)</span>
<span id="cb130-3"><a href="dynamic.html#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; c_data_5a10da89 c_data_3a92ccbc </span></span>
<span id="cb130-4"><a href="dynamic.html#cb130-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           &quot;a B&quot;           &quot;a C&quot;</span></span></code></pre></div>
</div>
<div id="branch-provenance" class="section level2 hasAnchor" number="11.5">
<h2><span class="header-section-number">11.5</span> Branch provenance<a href="dynamic.html#branch-provenance" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>tar_branches()</code> function identifies dependency relationships among individual branches. In the example pipeline below, we can find out the branch of <code>y</code> that each branch of <code>z</code> depends on.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="dynamic.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R</span></span>
<span id="cb131-2"><a href="dynamic.html#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb131-3"><a href="dynamic.html#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb131-4"><a href="dynamic.html#cb131-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(x, <span class="fu">seq_len</span>(<span class="dv">3</span>)),</span>
<span id="cb131-5"><a href="dynamic.html#cb131-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(y, x <span class="sc">+</span> <span class="dv">1</span>, <span class="at">pattern =</span> <span class="fu">map</span>(x)),</span>
<span id="cb131-6"><a href="dynamic.html#cb131-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(z, y <span class="sc">+</span> <span class="dv">1</span>, <span class="at">pattern =</span> <span class="fu">map</span>(y))</span>
<span id="cb131-7"><a href="dynamic.html#cb131-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="dynamic.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>()</span>
<span id="cb132-2"><a href="dynamic.html#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start target x</span></span>
<span id="cb132-3"><a href="dynamic.html#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built target x</span></span>
<span id="cb132-4"><a href="dynamic.html#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch y_29239c8a</span></span>
<span id="cb132-5"><a href="dynamic.html#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch y_29239c8a</span></span>
<span id="cb132-6"><a href="dynamic.html#cb132-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch y_7cc32924</span></span>
<span id="cb132-7"><a href="dynamic.html#cb132-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch y_7cc32924</span></span>
<span id="cb132-8"><a href="dynamic.html#cb132-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch y_bd602d50</span></span>
<span id="cb132-9"><a href="dynamic.html#cb132-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch y_bd602d50</span></span>
<span id="cb132-10"><a href="dynamic.html#cb132-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built pattern y</span></span>
<span id="cb132-11"><a href="dynamic.html#cb132-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch z_d0697b30</span></span>
<span id="cb132-12"><a href="dynamic.html#cb132-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch z_d0697b30</span></span>
<span id="cb132-13"><a href="dynamic.html#cb132-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch z_959da4d3</span></span>
<span id="cb132-14"><a href="dynamic.html#cb132-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch z_959da4d3</span></span>
<span id="cb132-15"><a href="dynamic.html#cb132-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch z_92be5b5f</span></span>
<span id="cb132-16"><a href="dynamic.html#cb132-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch z_92be5b5f</span></span>
<span id="cb132-17"><a href="dynamic.html#cb132-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built pattern z</span></span>
<span id="cb132-18"><a href="dynamic.html#cb132-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • end pipeline: 0.132 seconds</span></span></code></pre></div>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="dynamic.html#cb133-1" aria-hidden="true" tabindex="-1"></a>branches <span class="ot">&lt;-</span> <span class="fu">tar_branches</span>(z, <span class="fu">map</span>(y))</span>
<span id="cb133-2"><a href="dynamic.html#cb133-2" aria-hidden="true" tabindex="-1"></a>branches</span>
<span id="cb133-3"><a href="dynamic.html#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span id="cb133-4"><a href="dynamic.html#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   z          y         </span></span>
<span id="cb133-5"><a href="dynamic.html#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;     </span></span>
<span id="cb133-6"><a href="dynamic.html#cb133-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 z_d0697b30 y_29239c8a</span></span>
<span id="cb133-7"><a href="dynamic.html#cb133-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 z_959da4d3 y_7cc32924</span></span>
<span id="cb133-8"><a href="dynamic.html#cb133-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 z_92be5b5f y_bd602d50</span></span></code></pre></div>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="dynamic.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read_raw</span>(branches<span class="sc">$</span>y[<span class="dv">2</span>])</span>
<span id="cb134-2"><a href="dynamic.html#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span></code></pre></div>
<p>However, <code>tar_branches()</code> is not always helpful: for example, if we look at how <code>y</code> branches over <code>x</code>. <code>x</code> does not use dynamic branching, so <code>tar_branches()</code> does not return meaningful branch names.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="dynamic.html#cb135-1" aria-hidden="true" tabindex="-1"></a>branches <span class="ot">&lt;-</span> <span class="fu">tar_branches</span>(y, <span class="fu">map</span>(x))</span>
<span id="cb135-2"><a href="dynamic.html#cb135-2" aria-hidden="true" tabindex="-1"></a>branches</span>
<span id="cb135-3"><a href="dynamic.html#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span id="cb135-4"><a href="dynamic.html#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   y          x         </span></span>
<span id="cb135-5"><a href="dynamic.html#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;     </span></span>
<span id="cb135-6"><a href="dynamic.html#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 y_29239c8a x_ccba877f</span></span>
<span id="cb135-7"><a href="dynamic.html#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 y_7cc32924 x_084b9b29</span></span>
<span id="cb135-8"><a href="dynamic.html#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 y_bd602d50 x_91e9ed7e</span></span></code></pre></div>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="dynamic.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read_raw</span>(branches<span class="sc">$</span>x[<span class="dv">2</span>])</span>
<span id="cb136-2"><a href="dynamic.html#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in `tar_throw_validate()`:</span></span>
<span id="cb136-3"><a href="dynamic.html#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ! target x_084b9b29 not found</span></span></code></pre></div>
<p>In situations like this, it is best to proactively write targets that keep track of information about their upstream branches. Data frames and <code>tibble</code>s are useful for this.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="dynamic.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R</span></span>
<span id="cb137-2"><a href="dynamic.html#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb137-3"><a href="dynamic.html#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb137-4"><a href="dynamic.html#cb137-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(x, <span class="fu">seq_len</span>(<span class="dv">3</span>)),</span>
<span id="cb137-5"><a href="dynamic.html#cb137-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(y, <span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> x <span class="sc">+</span> <span class="dv">1</span>), <span class="at">pattern =</span> <span class="fu">map</span>(x))</span>
<span id="cb137-6"><a href="dynamic.html#cb137-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="dynamic.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>()</span>
<span id="cb138-2"><a href="dynamic.html#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✔ skip target x</span></span>
<span id="cb138-3"><a href="dynamic.html#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch y_29239c8a</span></span>
<span id="cb138-4"><a href="dynamic.html#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch y_29239c8a</span></span>
<span id="cb138-5"><a href="dynamic.html#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch y_7cc32924</span></span>
<span id="cb138-6"><a href="dynamic.html#cb138-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch y_7cc32924</span></span>
<span id="cb138-7"><a href="dynamic.html#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch y_bd602d50</span></span>
<span id="cb138-8"><a href="dynamic.html#cb138-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch y_bd602d50</span></span>
<span id="cb138-9"><a href="dynamic.html#cb138-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built pattern y</span></span>
<span id="cb138-10"><a href="dynamic.html#cb138-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • end pipeline: 0.112 seconds</span></span></code></pre></div>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="dynamic.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read</span>(y)</span>
<span id="cb139-2"><a href="dynamic.html#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x y</span></span>
<span id="cb139-3"><a href="dynamic.html#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1 2</span></span>
<span id="cb139-4"><a href="dynamic.html#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 2 3</span></span>
<span id="cb139-5"><a href="dynamic.html#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 3 4</span></span></code></pre></div>
</div>
<div id="testing-patterns" class="section level2 hasAnchor" number="11.6">
<h2><span class="header-section-number">11.6</span> Testing patterns<a href="dynamic.html#testing-patterns" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To check the correctness of a pattern without running the pipeline, use <a href="https://docs.ropensci.org/targets/reference/tar_pattern.html"><code>tar_pattern()</code></a>. Simply supply the pattern itself and the length of each dependency target. The branch names in the data frames below are made up, but they convey a high-level picture of the branching structure.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="dynamic.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_pattern</span>(</span>
<span id="cb140-2"><a href="dynamic.html#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cross</span>(w_comp, <span class="fu">map</span>(x_comp, y_comp)),</span>
<span id="cb140-3"><a href="dynamic.html#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">w_comp =</span> <span class="dv">2</span>,</span>
<span id="cb140-4"><a href="dynamic.html#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_comp =</span> <span class="dv">3</span>,</span>
<span id="cb140-5"><a href="dynamic.html#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_comp =</span> <span class="dv">3</span></span>
<span id="cb140-6"><a href="dynamic.html#cb140-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb140-7"><a href="dynamic.html#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb140-8"><a href="dynamic.html#cb140-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   w_comp   x_comp   y_comp  </span></span>
<span id="cb140-9"><a href="dynamic.html#cb140-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   </span></span>
<span id="cb140-10"><a href="dynamic.html#cb140-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 w_comp_1 x_comp_1 y_comp_1</span></span>
<span id="cb140-11"><a href="dynamic.html#cb140-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 w_comp_1 x_comp_2 y_comp_2</span></span>
<span id="cb140-12"><a href="dynamic.html#cb140-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 w_comp_1 x_comp_3 y_comp_3</span></span>
<span id="cb140-13"><a href="dynamic.html#cb140-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 w_comp_2 x_comp_1 y_comp_1</span></span>
<span id="cb140-14"><a href="dynamic.html#cb140-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 w_comp_2 x_comp_2 y_comp_2</span></span>
<span id="cb140-15"><a href="dynamic.html#cb140-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 w_comp_2 x_comp_3 y_comp_3</span></span></code></pre></div>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="dynamic.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_pattern</span>(</span>
<span id="cb141-2"><a href="dynamic.html#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="fu">cross</span>(w_comp, <span class="fu">map</span>(x_comp, y_comp)), <span class="at">n =</span> <span class="dv">2</span>),</span>
<span id="cb141-3"><a href="dynamic.html#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">w_comp =</span> <span class="dv">2</span>,</span>
<span id="cb141-4"><a href="dynamic.html#cb141-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_comp =</span> <span class="dv">3</span>,</span>
<span id="cb141-5"><a href="dynamic.html#cb141-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_comp =</span> <span class="dv">3</span></span>
<span id="cb141-6"><a href="dynamic.html#cb141-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb141-7"><a href="dynamic.html#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 3</span></span>
<span id="cb141-8"><a href="dynamic.html#cb141-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   w_comp   x_comp   y_comp  </span></span>
<span id="cb141-9"><a href="dynamic.html#cb141-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   </span></span>
<span id="cb141-10"><a href="dynamic.html#cb141-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 w_comp_1 x_comp_1 y_comp_1</span></span>
<span id="cb141-11"><a href="dynamic.html#cb141-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 w_comp_1 x_comp_2 y_comp_2</span></span></code></pre></div>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="dynamic.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_pattern</span>(</span>
<span id="cb142-2"><a href="dynamic.html#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cross</span>(w_comp, <span class="fu">sample</span>(<span class="fu">map</span>(x_comp, y_comp), <span class="at">n =</span> <span class="dv">2</span>)),</span>
<span id="cb142-3"><a href="dynamic.html#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">w_comp =</span> <span class="dv">2</span>,</span>
<span id="cb142-4"><a href="dynamic.html#cb142-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_comp =</span> <span class="dv">3</span>,</span>
<span id="cb142-5"><a href="dynamic.html#cb142-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_comp =</span> <span class="dv">3</span></span>
<span id="cb142-6"><a href="dynamic.html#cb142-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb142-7"><a href="dynamic.html#cb142-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 × 3</span></span>
<span id="cb142-8"><a href="dynamic.html#cb142-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   w_comp   x_comp   y_comp  </span></span>
<span id="cb142-9"><a href="dynamic.html#cb142-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   </span></span>
<span id="cb142-10"><a href="dynamic.html#cb142-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 w_comp_1 x_comp_2 y_comp_2</span></span>
<span id="cb142-11"><a href="dynamic.html#cb142-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 w_comp_1 x_comp_1 y_comp_1</span></span>
<span id="cb142-12"><a href="dynamic.html#cb142-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 w_comp_2 x_comp_2 y_comp_2</span></span>
<span id="cb142-13"><a href="dynamic.html#cb142-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 w_comp_2 x_comp_1 y_comp_1</span></span></code></pre></div>
</div>
<div id="branching-over-files" class="section level2 hasAnchor" number="11.7">
<h2><span class="header-section-number">11.7</span> Branching over files<a href="dynamic.html#branching-over-files" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Dynamic branching over files is tricky. A target with <code>format = "file"</code> treats the entire set of files as an irreducible bundle. That means in order to branch over files downstream, each file must already have its own branch.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="dynamic.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R</span></span>
<span id="cb143-2"><a href="dynamic.html#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb143-3"><a href="dynamic.html#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb143-4"><a href="dynamic.html#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(paths, <span class="fu">c</span>(<span class="st">&quot;a.csv&quot;</span>, <span class="st">&quot;b.csv&quot;</span>)),</span>
<span id="cb143-5"><a href="dynamic.html#cb143-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(files, paths, <span class="at">format =</span> <span class="st">&quot;file&quot;</span>, <span class="at">pattern =</span> <span class="fu">map</span>(paths)),</span>
<span id="cb143-6"><a href="dynamic.html#cb143-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(data, <span class="fu">read_csv</span>(files), <span class="at">pattern =</span> <span class="fu">map</span>(files))</span>
<span id="cb143-7"><a href="dynamic.html#cb143-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>The <a href="https://docs.ropensci.org/tarchetypes/reference/tar_files.html"><code>tar_files()</code></a> function from the <a href="https://github.com/ropensci/tarchetypes"><code>tarchetypes</code></a> package is shorthand for the first two targets above.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="dynamic.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R</span></span>
<span id="cb144-2"><a href="dynamic.html#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb144-3"><a href="dynamic.html#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tarchetypes)</span>
<span id="cb144-4"><a href="dynamic.html#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb144-5"><a href="dynamic.html#cb144-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_files</span>(files, <span class="fu">c</span>(<span class="st">&quot;a.csv&quot;</span>, <span class="st">&quot;b.csv&quot;</span>)),</span>
<span id="cb144-6"><a href="dynamic.html#cb144-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(data, <span class="fu">read_csv</span>(files), <span class="at">pattern =</span> <span class="fu">map</span>(files))</span>
<span id="cb144-7"><a href="dynamic.html#cb144-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="branching-over-rows" class="section level2 hasAnchor" number="11.8">
<h2><span class="header-section-number">11.8</span> Branching over rows<a href="dynamic.html#branching-over-rows" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>By default, if you dynamically branch over a data frame, the branches are the rows. As later sections explain, this behavior changes if you set the <code>iteration</code> argument of <code>tar_target()</code> to anything other than <code>"vector"</code> (default).</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="dynamic.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R</span></span>
<span id="cb145-2"><a href="dynamic.html#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb145-3"><a href="dynamic.html#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb145-4"><a href="dynamic.html#cb145-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(x, <span class="fu">head</span>(mtcars[, <span class="fu">seq_len</span>(<span class="dv">3</span>)])),</span>
<span id="cb145-5"><a href="dynamic.html#cb145-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(y, x, <span class="at">pattern =</span> <span class="fu">map</span>(x), <span class="at">iteration =</span> <span class="st">&quot;vector&quot;</span>) <span class="co"># &quot;vector&quot; is already default</span></span>
<span id="cb145-6"><a href="dynamic.html#cb145-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="dynamic.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>()</span>
<span id="cb146-2"><a href="dynamic.html#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start target x</span></span>
<span id="cb146-3"><a href="dynamic.html#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built target x</span></span>
<span id="cb146-4"><a href="dynamic.html#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch y_ab68055f</span></span>
<span id="cb146-5"><a href="dynamic.html#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch y_ab68055f</span></span>
<span id="cb146-6"><a href="dynamic.html#cb146-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch y_82fbaf4b</span></span>
<span id="cb146-7"><a href="dynamic.html#cb146-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch y_82fbaf4b</span></span>
<span id="cb146-8"><a href="dynamic.html#cb146-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch y_711d3bba</span></span>
<span id="cb146-9"><a href="dynamic.html#cb146-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch y_711d3bba</span></span>
<span id="cb146-10"><a href="dynamic.html#cb146-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch y_c726abf9</span></span>
<span id="cb146-11"><a href="dynamic.html#cb146-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch y_c726abf9</span></span>
<span id="cb146-12"><a href="dynamic.html#cb146-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch y_ad48cb8f</span></span>
<span id="cb146-13"><a href="dynamic.html#cb146-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch y_ad48cb8f</span></span>
<span id="cb146-14"><a href="dynamic.html#cb146-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch y_981c388a</span></span>
<span id="cb146-15"><a href="dynamic.html#cb146-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch y_981c388a</span></span>
<span id="cb146-16"><a href="dynamic.html#cb146-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built pattern y</span></span>
<span id="cb146-17"><a href="dynamic.html#cb146-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • end pipeline: 0.131 seconds</span></span></code></pre></div>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="dynamic.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read</span>(y, <span class="at">branches =</span> <span class="dv">2</span>)</span>
<span id="cb147-2"><a href="dynamic.html#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               mpg cyl disp</span></span>
<span id="cb147-3"><a href="dynamic.html#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Mazda RX4 Wag  21   6  160</span></span></code></pre></div>
<p><code>iteration = "vector"</code> also tells <code>tar_read(y)</code> to aggregate all the loaded branches into a data frame.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="dynamic.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read</span>(y, <span class="at">branches =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>))</span>
<span id="cb148-2"><a href="dynamic.html#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                    mpg cyl disp</span></span>
<span id="cb148-3"><a href="dynamic.html#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Mazda RX4         21.0   6  160</span></span>
<span id="cb148-4"><a href="dynamic.html#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Mazda RX4 Wag     21.0   6  160</span></span>
<span id="cb148-5"><a href="dynamic.html#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Hornet Sportabout 18.7   8  360</span></span></code></pre></div>
<p>In addition, helpers in <code>tarchetypes</code> can branch over entire groups of rows. Row grouping happens through <code>iteration = "group"</code>, as explained later.</p>
<ul>
<li><code>tar_group_by()</code>: define row groups using <code>dplyr::group_by()</code> semantics.</li>
<li><code>tar_group_select()</code>: define row groups using <code>tidyselect</code> semantics.</li>
<li><code>tar_group_count()</code>: define a given number row groups.</li>
<li><code>tar_group_size()</code>: define row groups of a given size.</li>
</ul>
<p>If you define a target with one of these functions, all downstream dynamic targets will automatically branch over the row groups.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="dynamic.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R file:</span></span>
<span id="cb149-2"><a href="dynamic.html#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb149-3"><a href="dynamic.html#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tarchetypes)</span>
<span id="cb149-4"><a href="dynamic.html#cb149-4" aria-hidden="true" tabindex="-1"></a>produce_data <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb149-5"><a href="dynamic.html#cb149-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand.grid</span>(<span class="at">var1 =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>), <span class="at">var2 =</span> <span class="fu">c</span>(<span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>), <span class="at">rep =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb149-6"><a href="dynamic.html#cb149-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb149-7"><a href="dynamic.html#cb149-7" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb149-8"><a href="dynamic.html#cb149-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_group_by</span>(data, <span class="fu">produce_data</span>(), var1, var2),</span>
<span id="cb149-9"><a href="dynamic.html#cb149-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(group, data, <span class="at">pattern =</span> <span class="fu">map</span>(data))</span>
<span id="cb149-10"><a href="dynamic.html#cb149-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="dynamic.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R console:</span></span>
<span id="cb150-2"><a href="dynamic.html#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb150-3"><a href="dynamic.html#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>()</span>
<span id="cb150-4"><a href="dynamic.html#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start target data</span></span>
<span id="cb150-5"><a href="dynamic.html#cb150-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built target data</span></span>
<span id="cb150-6"><a href="dynamic.html#cb150-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch group_b3d7d010</span></span>
<span id="cb150-7"><a href="dynamic.html#cb150-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch group_b3d7d010</span></span>
<span id="cb150-8"><a href="dynamic.html#cb150-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch group_6a76c5c0</span></span>
<span id="cb150-9"><a href="dynamic.html#cb150-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch group_6a76c5c0</span></span>
<span id="cb150-10"><a href="dynamic.html#cb150-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch group_164b16bf</span></span>
<span id="cb150-11"><a href="dynamic.html#cb150-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch group_164b16bf</span></span>
<span id="cb150-12"><a href="dynamic.html#cb150-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch group_f5aae602</span></span>
<span id="cb150-13"><a href="dynamic.html#cb150-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch group_f5aae602</span></span>
<span id="cb150-14"><a href="dynamic.html#cb150-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built pattern group</span></span>
<span id="cb150-15"><a href="dynamic.html#cb150-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • end pipeline: 0.132 seconds</span></span>
<span id="cb150-16"><a href="dynamic.html#cb150-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-17"><a href="dynamic.html#cb150-17" aria-hidden="true" tabindex="-1"></a><span class="co"># First row group:</span></span>
<span id="cb150-18"><a href="dynamic.html#cb150-18" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read</span>(group, <span class="at">branches =</span> <span class="dv">1</span>)</span>
<span id="cb150-19"><a href="dynamic.html#cb150-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 4</span></span>
<span id="cb150-20"><a href="dynamic.html#cb150-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   var1  var2    rep tar_group</span></span>
<span id="cb150-21"><a href="dynamic.html#cb150-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;     &lt;int&gt;</span></span>
<span id="cb150-22"><a href="dynamic.html#cb150-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 a     c         1         1</span></span>
<span id="cb150-23"><a href="dynamic.html#cb150-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 a     c         2         1</span></span>
<span id="cb150-24"><a href="dynamic.html#cb150-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 a     c         3         1</span></span>
<span id="cb150-25"><a href="dynamic.html#cb150-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-26"><a href="dynamic.html#cb150-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Second row group:</span></span>
<span id="cb150-27"><a href="dynamic.html#cb150-27" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read</span>(group, <span class="at">branches =</span> <span class="dv">2</span>)</span>
<span id="cb150-28"><a href="dynamic.html#cb150-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 4</span></span>
<span id="cb150-29"><a href="dynamic.html#cb150-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   var1  var2    rep tar_group</span></span>
<span id="cb150-30"><a href="dynamic.html#cb150-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;     &lt;int&gt;</span></span>
<span id="cb150-31"><a href="dynamic.html#cb150-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 a     d         1         2</span></span>
<span id="cb150-32"><a href="dynamic.html#cb150-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 a     d         2         2</span></span>
<span id="cb150-33"><a href="dynamic.html#cb150-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 a     d         3         2</span></span></code></pre></div>
<p>For more information on how the row grouping mechanism works, see the section on “group” iteration below.</p>
</div>
<div id="iteration" class="section level2 hasAnchor" number="11.9">
<h2><span class="header-section-number">11.9</span> Iteration<a href="dynamic.html#iteration" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>iteration</code> arguments of <code>tar_target()</code> and <code>tar_option_set()</code> control the slicing of stems and the aggregation of patterns. For example, if you write a stem target with <code>tar_target(x, fun(), iteration = "list")</code>, then all downstream targets that branch over <code>x</code> will give list-like slices <code>x[[1]]</code>, <code>x[[2]]</code>, etc. to the individual branches instead of the default vector-like slices <code>x[1]</code>, <code>x[2]</code>, etc. Likewise, for a pattern defined with <code>tar_target(y, fun(x), pattern = map(x), iteration = "list")</code>, <code>tar_read(y)</code> will return a list instead of a vector, and a downstream target like <code>tar_target(y, fun(z))</code> will treat <code>z</code> as a list instead of a vector.<a href="drake.html#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a></p>
<div id="vector-iteration" class="section level3 hasAnchor" number="11.9.1">
<h3><span class="header-section-number">11.9.1</span> Vector iteration<a href="dynamic.html#vector-iteration" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>targets</code> uses vector iteration by default, and you can opt into this behavior by setting <code>iteration = "vector"</code> in <code>tar_target()</code>. In vector iteration, <code>targets</code> uses the <a href="https://vctrs.r-lib.org/"><code>vctrs</code></a> package to split stems and aggregate branches. That means <code>vctrs::vec_slice()</code> slices up stems like <code>x</code> for mapping, and <code>vctrs::vec_c()</code> aggregates patterns like <code>y</code> for operations like <code>tar_read()</code>.</p>
<p>For atomic vectors like in the example above, this behavior is already intuitive. But if we map over a data frame, each branch will get a row of the data frame due to vector iteration.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="dynamic.html#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb151-2"><a href="dynamic.html#cb151-2" aria-hidden="true" tabindex="-1"></a>print_and_return <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb151-3"><a href="dynamic.html#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(x)</span>
<span id="cb151-4"><a href="dynamic.html#cb151-4" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb151-5"><a href="dynamic.html#cb151-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb151-6"><a href="dynamic.html#cb151-6" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb151-7"><a href="dynamic.html#cb151-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb151-8"><a href="dynamic.html#cb151-8" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb151-9"><a href="dynamic.html#cb151-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">a =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">b =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>)),</span>
<span id="cb151-10"><a href="dynamic.html#cb151-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Already the default unless tar_option_get(iteration&quot;) is not &quot;vector&quot;:</span></span>
<span id="cb151-11"><a href="dynamic.html#cb151-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">iteration =</span> <span class="st">&quot;vector&quot;</span></span>
<span id="cb151-12"><a href="dynamic.html#cb151-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb151-13"><a href="dynamic.html#cb151-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb151-14"><a href="dynamic.html#cb151-14" aria-hidden="true" tabindex="-1"></a>    y,</span>
<span id="cb151-15"><a href="dynamic.html#cb151-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print_and_return</span>(x),</span>
<span id="cb151-16"><a href="dynamic.html#cb151-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="fu">map</span>(x),</span>
<span id="cb151-17"><a href="dynamic.html#cb151-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Already the default unless tar_option_get(iteration&quot;) is not &quot;vector&quot;:</span></span>
<span id="cb151-18"><a href="dynamic.html#cb151-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">iteration =</span> <span class="st">&quot;vector&quot;</span></span>
<span id="cb151-19"><a href="dynamic.html#cb151-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb151-20"><a href="dynamic.html#cb151-20" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="dynamic.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>()</span>
<span id="cb152-2"><a href="dynamic.html#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start target x</span></span>
<span id="cb152-3"><a href="dynamic.html#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built target x</span></span>
<span id="cb152-4"><a href="dynamic.html#cb152-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch y_2e131731</span></span>
<span id="cb152-5"><a href="dynamic.html#cb152-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   a b</span></span>
<span id="cb152-6"><a href="dynamic.html#cb152-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1 a</span></span>
<span id="cb152-7"><a href="dynamic.html#cb152-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch y_2e131731</span></span>
<span id="cb152-8"><a href="dynamic.html#cb152-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch y_6c3b7977</span></span>
<span id="cb152-9"><a href="dynamic.html#cb152-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   a b</span></span>
<span id="cb152-10"><a href="dynamic.html#cb152-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 2 b</span></span>
<span id="cb152-11"><a href="dynamic.html#cb152-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch y_6c3b7977</span></span>
<span id="cb152-12"><a href="dynamic.html#cb152-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built pattern y</span></span>
<span id="cb152-13"><a href="dynamic.html#cb152-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • end pipeline: 0.117 seconds</span></span></code></pre></div>
<p>And since <code>y</code> also has iteration = <code>"vector"</code>, the aggregate of <code>y</code> is a single data frame of all the rows.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="dynamic.html#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read</span>(y)</span>
<span id="cb153-2"><a href="dynamic.html#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   a b</span></span>
<span id="cb153-3"><a href="dynamic.html#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1 a</span></span>
<span id="cb153-4"><a href="dynamic.html#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 2 b</span></span></code></pre></div>
</div>
<div id="list-iteration" class="section level3 hasAnchor" number="11.9.2">
<h3><span class="header-section-number">11.9.2</span> List iteration<a href="dynamic.html#list-iteration" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>List iteration splits and aggregates targets as simple lists. If a non-dynamic target <code>x</code> has list iteration, then all branches of downstream patterns will get <code>x[[1]]</code>, <code>x[[2]]</code>, and so on. If a dynamic target <code>y</code> has list iteration, then all targets downstream of <code>y</code> will see <code>y</code> as a list, and <code>tar_read(y)</code> will be a list.</p>
<p>The following example demonstrates the slicing and aggregation behavior of list iteration. Because stem target <code>x</code> uses list iteration, the downstream target <code>y</code> maps over the columns of the data frame instead of the rows. Likewise, <code>tar_read(z)</code> is a list because <code>z</code> is a dynamic target with list iteration.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="dynamic.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R</span></span>
<span id="cb154-2"><a href="dynamic.html#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb154-3"><a href="dynamic.html#cb154-3" aria-hidden="true" tabindex="-1"></a>print_and_return <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb154-4"><a href="dynamic.html#cb154-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(x)</span>
<span id="cb154-5"><a href="dynamic.html#cb154-5" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb154-6"><a href="dynamic.html#cb154-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb154-7"><a href="dynamic.html#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb154-8"><a href="dynamic.html#cb154-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb154-9"><a href="dynamic.html#cb154-9" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb154-10"><a href="dynamic.html#cb154-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">a =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">b =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>)),</span>
<span id="cb154-11"><a href="dynamic.html#cb154-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">iteration =</span> <span class="st">&quot;list&quot;</span></span>
<span id="cb154-12"><a href="dynamic.html#cb154-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb154-13"><a href="dynamic.html#cb154-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(y, <span class="fu">print_and_return</span>(x), <span class="at">pattern =</span> <span class="fu">map</span>(x)),</span>
<span id="cb154-14"><a href="dynamic.html#cb154-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(z, x, <span class="at">pattern =</span> <span class="fu">map</span>(x), <span class="at">iteration =</span> <span class="st">&quot;list&quot;</span>)</span>
<span id="cb154-15"><a href="dynamic.html#cb154-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="dynamic.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>()</span>
<span id="cb155-2"><a href="dynamic.html#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start target x</span></span>
<span id="cb155-3"><a href="dynamic.html#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built target x</span></span>
<span id="cb155-4"><a href="dynamic.html#cb155-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch y_651b13c7</span></span>
<span id="cb155-5"><a href="dynamic.html#cb155-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1 2</span></span>
<span id="cb155-6"><a href="dynamic.html#cb155-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch y_651b13c7</span></span>
<span id="cb155-7"><a href="dynamic.html#cb155-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;a&quot; &quot;b&quot;</span></span>
<span id="cb155-8"><a href="dynamic.html#cb155-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch y_1c8c7726</span></span>
<span id="cb155-9"><a href="dynamic.html#cb155-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch y_1c8c7726</span></span>
<span id="cb155-10"><a href="dynamic.html#cb155-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built pattern y</span></span>
<span id="cb155-11"><a href="dynamic.html#cb155-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch z_651b13c7</span></span>
<span id="cb155-12"><a href="dynamic.html#cb155-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch z_651b13c7</span></span>
<span id="cb155-13"><a href="dynamic.html#cb155-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch z_1c8c7726</span></span>
<span id="cb155-14"><a href="dynamic.html#cb155-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch z_1c8c7726</span></span>
<span id="cb155-15"><a href="dynamic.html#cb155-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built pattern z</span></span>
<span id="cb155-16"><a href="dynamic.html#cb155-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • end pipeline: 0.18 seconds</span></span></code></pre></div>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="dynamic.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read</span>(y)</span>
<span id="cb156-2"><a href="dynamic.html#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in `stop_vctrs()`:</span></span>
<span id="cb156-3"><a href="dynamic.html#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ! Can&#39;t combine `y_651b13c7` &lt;double&gt; and `y_1c8c7726` &lt;character&gt;.</span></span></code></pre></div>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="dynamic.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read</span>(z)</span>
<span id="cb157-2"><a href="dynamic.html#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $z_651b13c7</span></span>
<span id="cb157-3"><a href="dynamic.html#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1 2</span></span>
<span id="cb157-4"><a href="dynamic.html#cb157-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb157-5"><a href="dynamic.html#cb157-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $z_1c8c7726</span></span>
<span id="cb157-6"><a href="dynamic.html#cb157-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;a&quot; &quot;b&quot;</span></span></code></pre></div>
</div>
<div id="group-iteration" class="section level3 hasAnchor" number="11.9.3">
<h3><span class="header-section-number">11.9.3</span> Group iteration<a href="dynamic.html#group-iteration" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Group iteration brings <code>dplyr::group_by()</code> functionality to patterns. This way, we can map or cross over custom subsets of rows. Consider the following data frame.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="dynamic.html#cb158-1" aria-hidden="true" tabindex="-1"></a>object <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb158-2"><a href="dynamic.html#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq_len</span>(<span class="dv">6</span>),</span>
<span id="cb158-3"><a href="dynamic.html#cb158-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">rep</span>(letters[<span class="fu">seq_len</span>(<span class="dv">3</span>)], <span class="at">each =</span> <span class="dv">2</span>)</span>
<span id="cb158-4"><a href="dynamic.html#cb158-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb158-5"><a href="dynamic.html#cb158-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-6"><a href="dynamic.html#cb158-6" aria-hidden="true" tabindex="-1"></a>object</span>
<span id="cb158-7"><a href="dynamic.html#cb158-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x id</span></span>
<span id="cb158-8"><a href="dynamic.html#cb158-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1  a</span></span>
<span id="cb158-9"><a href="dynamic.html#cb158-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 2  a</span></span>
<span id="cb158-10"><a href="dynamic.html#cb158-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 3  b</span></span>
<span id="cb158-11"><a href="dynamic.html#cb158-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 4  b</span></span>
<span id="cb158-12"><a href="dynamic.html#cb158-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 5  c</span></span>
<span id="cb158-13"><a href="dynamic.html#cb158-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 6  c</span></span></code></pre></div>
<p>To map over the groups of rows defined by the <code>id</code> column, we</p>
<ol style="list-style-type: decimal">
<li>Use <code>group_by()</code> and <code>tar_group()</code> to define the groups of rows, and</li>
<li>Use <code>iteration = "group"</code> in <code>tar_target()</code> to tell downstream patterns to use the row groups.</li>
</ol>
<p>Put together, the pipeline looks like this.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="dynamic.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R</span></span>
<span id="cb159-2"><a href="dynamic.html#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb159-3"><a href="dynamic.html#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_option_set</span>(<span class="at">packages =</span> <span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb159-4"><a href="dynamic.html#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb159-5"><a href="dynamic.html#cb159-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb159-6"><a href="dynamic.html#cb159-6" aria-hidden="true" tabindex="-1"></a>    data,</span>
<span id="cb159-7"><a href="dynamic.html#cb159-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb159-8"><a href="dynamic.html#cb159-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">seq_len</span>(<span class="dv">6</span>),</span>
<span id="cb159-9"><a href="dynamic.html#cb159-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">id =</span> <span class="fu">rep</span>(letters[<span class="fu">seq_len</span>(<span class="dv">3</span>)], <span class="at">each =</span> <span class="dv">2</span>)</span>
<span id="cb159-10"><a href="dynamic.html#cb159-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb159-11"><a href="dynamic.html#cb159-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb159-12"><a href="dynamic.html#cb159-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tar_group</span>(),</span>
<span id="cb159-13"><a href="dynamic.html#cb159-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">iteration =</span> <span class="st">&quot;group&quot;</span></span>
<span id="cb159-14"><a href="dynamic.html#cb159-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb159-15"><a href="dynamic.html#cb159-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb159-16"><a href="dynamic.html#cb159-16" aria-hidden="true" tabindex="-1"></a>    subsets,</span>
<span id="cb159-17"><a href="dynamic.html#cb159-17" aria-hidden="true" tabindex="-1"></a>    data,</span>
<span id="cb159-18"><a href="dynamic.html#cb159-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="fu">map</span>(data),</span>
<span id="cb159-19"><a href="dynamic.html#cb159-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">iteration =</span> <span class="st">&quot;list&quot;</span></span>
<span id="cb159-20"><a href="dynamic.html#cb159-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb159-21"><a href="dynamic.html#cb159-21" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="dynamic.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>()</span>
<span id="cb160-2"><a href="dynamic.html#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start target data</span></span>
<span id="cb160-3"><a href="dynamic.html#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built target data</span></span>
<span id="cb160-4"><a href="dynamic.html#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch subsets_f6af59da</span></span>
<span id="cb160-5"><a href="dynamic.html#cb160-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch subsets_f6af59da</span></span>
<span id="cb160-6"><a href="dynamic.html#cb160-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch subsets_f91945cc</span></span>
<span id="cb160-7"><a href="dynamic.html#cb160-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch subsets_f91945cc</span></span>
<span id="cb160-8"><a href="dynamic.html#cb160-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch subsets_cae649ac</span></span>
<span id="cb160-9"><a href="dynamic.html#cb160-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch subsets_cae649ac</span></span>
<span id="cb160-10"><a href="dynamic.html#cb160-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built pattern subsets</span></span>
<span id="cb160-11"><a href="dynamic.html#cb160-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • end pipeline: 0.475 seconds</span></span></code></pre></div>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="dynamic.html#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">tar_read</span>(subsets), as.data.frame)</span>
<span id="cb161-2"><a href="dynamic.html#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $subsets_f6af59da</span></span>
<span id="cb161-3"><a href="dynamic.html#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x id tar_group</span></span>
<span id="cb161-4"><a href="dynamic.html#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1  a         1</span></span>
<span id="cb161-5"><a href="dynamic.html#cb161-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 2  a         1</span></span>
<span id="cb161-6"><a href="dynamic.html#cb161-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb161-7"><a href="dynamic.html#cb161-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $subsets_f91945cc</span></span>
<span id="cb161-8"><a href="dynamic.html#cb161-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x id tar_group</span></span>
<span id="cb161-9"><a href="dynamic.html#cb161-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 3  b         2</span></span>
<span id="cb161-10"><a href="dynamic.html#cb161-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 4  b         2</span></span>
<span id="cb161-11"><a href="dynamic.html#cb161-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb161-12"><a href="dynamic.html#cb161-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $subsets_cae649ac</span></span>
<span id="cb161-13"><a href="dynamic.html#cb161-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x id tar_group</span></span>
<span id="cb161-14"><a href="dynamic.html#cb161-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 5  c         3</span></span>
<span id="cb161-15"><a href="dynamic.html#cb161-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 6  c         3</span></span></code></pre></div>
<p>Row groups are defined in the special <code>tar_group</code> column created by <code>tar_group()</code>.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="dynamic.html#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb162-2"><a href="dynamic.html#cb162-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq_len</span>(<span class="dv">6</span>),</span>
<span id="cb162-3"><a href="dynamic.html#cb162-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">rep</span>(letters[<span class="fu">seq_len</span>(<span class="dv">3</span>)], <span class="at">each =</span> <span class="dv">2</span>)</span>
<span id="cb162-4"><a href="dynamic.html#cb162-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb162-5"><a href="dynamic.html#cb162-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb162-6"><a href="dynamic.html#cb162-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_group</span>()</span>
<span id="cb162-7"><a href="dynamic.html#cb162-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb162-8"><a href="dynamic.html#cb162-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       x id    tar_group</span></span>
<span id="cb162-9"><a href="dynamic.html#cb162-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;     &lt;int&gt;</span></span>
<span id="cb162-10"><a href="dynamic.html#cb162-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 a             1</span></span>
<span id="cb162-11"><a href="dynamic.html#cb162-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 a             1</span></span>
<span id="cb162-12"><a href="dynamic.html#cb162-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3 b             2</span></span>
<span id="cb162-13"><a href="dynamic.html#cb162-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4 b             2</span></span>
<span id="cb162-14"><a href="dynamic.html#cb162-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     5 c             3</span></span>
<span id="cb162-15"><a href="dynamic.html#cb162-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6     6 c             3</span></span></code></pre></div>
<p><code>tar_group()</code> creates this column based on the orderings of the grouping variables supplied to <code>dplyr::group_by()</code>, not the order of the rows in the data.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="dynamic.html#cb163-1" aria-hidden="true" tabindex="-1"></a>flip_order <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb163-2"><a href="dynamic.html#cb163-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ordered</span>(x, <span class="at">levels =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(x), <span class="at">decreasing =</span> <span class="cn">TRUE</span>))</span>
<span id="cb163-3"><a href="dynamic.html#cb163-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb163-4"><a href="dynamic.html#cb163-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-5"><a href="dynamic.html#cb163-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb163-6"><a href="dynamic.html#cb163-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq_len</span>(<span class="dv">6</span>),</span>
<span id="cb163-7"><a href="dynamic.html#cb163-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">flip_order</span>(<span class="fu">rep</span>(letters[<span class="fu">seq_len</span>(<span class="dv">3</span>)], <span class="at">each =</span> <span class="dv">2</span>))</span>
<span id="cb163-8"><a href="dynamic.html#cb163-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb163-9"><a href="dynamic.html#cb163-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb163-10"><a href="dynamic.html#cb163-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_group</span>()</span>
<span id="cb163-11"><a href="dynamic.html#cb163-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb163-12"><a href="dynamic.html#cb163-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       x id    tar_group</span></span>
<span id="cb163-13"><a href="dynamic.html#cb163-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;ord&gt;     &lt;int&gt;</span></span>
<span id="cb163-14"><a href="dynamic.html#cb163-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 a             3</span></span>
<span id="cb163-15"><a href="dynamic.html#cb163-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 a             3</span></span>
<span id="cb163-16"><a href="dynamic.html#cb163-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3 b             2</span></span>
<span id="cb163-17"><a href="dynamic.html#cb163-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4 b             2</span></span>
<span id="cb163-18"><a href="dynamic.html#cb163-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     5 c             1</span></span>
<span id="cb163-19"><a href="dynamic.html#cb163-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6     6 c             1</span></span></code></pre></div>
<p>The ordering in <code>tar_group</code> agrees with the ordering shown by <code>dplyr::group_keys()</code>.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="dynamic.html#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb164-2"><a href="dynamic.html#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq_len</span>(<span class="dv">6</span>),</span>
<span id="cb164-3"><a href="dynamic.html#cb164-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">flip_order</span>(<span class="fu">rep</span>(letters[<span class="fu">seq_len</span>(<span class="dv">3</span>)], <span class="at">each =</span> <span class="dv">2</span>))</span>
<span id="cb164-4"><a href="dynamic.html#cb164-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb164-5"><a href="dynamic.html#cb164-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb164-6"><a href="dynamic.html#cb164-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_keys</span>()</span>
<span id="cb164-7"><a href="dynamic.html#cb164-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 1</span></span>
<span id="cb164-8"><a href="dynamic.html#cb164-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id   </span></span>
<span id="cb164-9"><a href="dynamic.html#cb164-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;ord&gt;</span></span>
<span id="cb164-10"><a href="dynamic.html#cb164-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 c    </span></span>
<span id="cb164-11"><a href="dynamic.html#cb164-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 b    </span></span>
<span id="cb164-12"><a href="dynamic.html#cb164-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 a</span></span></code></pre></div>
<p>Branches are arranged in increasing order with respect to the integers in <code>tar_group</code>.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="dynamic.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R</span></span>
<span id="cb165-2"><a href="dynamic.html#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb165-3"><a href="dynamic.html#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_option_set</span>(<span class="at">packages =</span> <span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb165-4"><a href="dynamic.html#cb165-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-5"><a href="dynamic.html#cb165-5" aria-hidden="true" tabindex="-1"></a>flip_order <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb165-6"><a href="dynamic.html#cb165-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ordered</span>(x, <span class="at">levels =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(x), <span class="at">decreasing =</span> <span class="cn">TRUE</span>))</span>
<span id="cb165-7"><a href="dynamic.html#cb165-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb165-8"><a href="dynamic.html#cb165-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-9"><a href="dynamic.html#cb165-9" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb165-10"><a href="dynamic.html#cb165-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb165-11"><a href="dynamic.html#cb165-11" aria-hidden="true" tabindex="-1"></a>    data,</span>
<span id="cb165-12"><a href="dynamic.html#cb165-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb165-13"><a href="dynamic.html#cb165-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">seq_len</span>(<span class="dv">6</span>),</span>
<span id="cb165-14"><a href="dynamic.html#cb165-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">id =</span> <span class="fu">flip_order</span>(<span class="fu">rep</span>(letters[<span class="fu">seq_len</span>(<span class="dv">3</span>)], <span class="at">each =</span> <span class="dv">2</span>))</span>
<span id="cb165-15"><a href="dynamic.html#cb165-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb165-16"><a href="dynamic.html#cb165-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb165-17"><a href="dynamic.html#cb165-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tar_group</span>(),</span>
<span id="cb165-18"><a href="dynamic.html#cb165-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">iteration =</span> <span class="st">&quot;group&quot;</span></span>
<span id="cb165-19"><a href="dynamic.html#cb165-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb165-20"><a href="dynamic.html#cb165-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb165-21"><a href="dynamic.html#cb165-21" aria-hidden="true" tabindex="-1"></a>    subsets,</span>
<span id="cb165-22"><a href="dynamic.html#cb165-22" aria-hidden="true" tabindex="-1"></a>    data,</span>
<span id="cb165-23"><a href="dynamic.html#cb165-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="fu">map</span>(data),</span>
<span id="cb165-24"><a href="dynamic.html#cb165-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">iteration =</span> <span class="st">&quot;list&quot;</span></span>
<span id="cb165-25"><a href="dynamic.html#cb165-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb165-26"><a href="dynamic.html#cb165-26" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="dynamic.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>()</span>
<span id="cb166-2"><a href="dynamic.html#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start target data</span></span>
<span id="cb166-3"><a href="dynamic.html#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built target data</span></span>
<span id="cb166-4"><a href="dynamic.html#cb166-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch subsets_13c06a5c</span></span>
<span id="cb166-5"><a href="dynamic.html#cb166-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch subsets_13c06a5c</span></span>
<span id="cb166-6"><a href="dynamic.html#cb166-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch subsets_f38b90a2</span></span>
<span id="cb166-7"><a href="dynamic.html#cb166-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch subsets_f38b90a2</span></span>
<span id="cb166-8"><a href="dynamic.html#cb166-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • start branch subsets_d2717707</span></span>
<span id="cb166-9"><a href="dynamic.html#cb166-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built branch subsets_d2717707</span></span>
<span id="cb166-10"><a href="dynamic.html#cb166-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • built pattern subsets</span></span>
<span id="cb166-11"><a href="dynamic.html#cb166-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • end pipeline: 0.393 seconds</span></span></code></pre></div>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="dynamic.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">tar_read</span>(subsets), as.data.frame)</span>
<span id="cb167-2"><a href="dynamic.html#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $subsets_13c06a5c</span></span>
<span id="cb167-3"><a href="dynamic.html#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x id tar_group</span></span>
<span id="cb167-4"><a href="dynamic.html#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 5  c         1</span></span>
<span id="cb167-5"><a href="dynamic.html#cb167-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 6  c         1</span></span>
<span id="cb167-6"><a href="dynamic.html#cb167-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb167-7"><a href="dynamic.html#cb167-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $subsets_f38b90a2</span></span>
<span id="cb167-8"><a href="dynamic.html#cb167-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x id tar_group</span></span>
<span id="cb167-9"><a href="dynamic.html#cb167-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 3  b         2</span></span>
<span id="cb167-10"><a href="dynamic.html#cb167-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 4  b         2</span></span>
<span id="cb167-11"><a href="dynamic.html#cb167-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb167-12"><a href="dynamic.html#cb167-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $subsets_d2717707</span></span>
<span id="cb167-13"><a href="dynamic.html#cb167-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x id tar_group</span></span>
<span id="cb167-14"><a href="dynamic.html#cb167-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1  a         3</span></span>
<span id="cb167-15"><a href="dynamic.html#cb167-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 2  a         3</span></span></code></pre></div>
</div>
</div>
<div id="dynamic-branching-performance" class="section level2 hasAnchor" number="11.10">
<h2><span class="header-section-number">11.10</span> Dynamic branching performance<a href="dynamic.html#dynamic-branching-performance" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>With dynamic branching, it is super easy to create an enormous number of targets. But when the number of targets starts to exceed a couple hundred, <code>tar_make()</code> slows down, and graphs from <code>tar_visnetwork()</code> start to become unmanageable.</p>
<p>If that happens to you, you might be tempted to use the <code>names</code> and <code>shortcut</code> arguments to <code>tar_make()</code>, e.g. <code>tar_make(names = all_of("only", "these", "targets"), shortcut = TRUE)</code>, to completely temporarily omit thousands of upstream targets for the sake of concentrating on one section at a time. However, this technique is only a temporary measure, and it is best to eventually revert back to the default <code>names = NULL</code> and <code>shortcut = FALSE</code> to ensure reproducibility.</p>
<p>Another temporary workaround is to temporarily select subsets of branches. For example, instead of <code>pattern = map(large_target)</code> in <code>tar_target()</code>, you could prototype on a target that uses <code>pattern = head(map(large_target), n = 1)</code> or <code>pattern = slice(map(large_target), c(4, 5, 6))</code>. In the case of <code>slice()</code>, the <code>tar_branch_index()</code> function (only in <code>targets</code> version 0.5.0.9000 and above) can help you find the required integer indexes corresponding to individual branch names you may want.</p>
<p>However, both the above solutions are temporary workarounds for the sake of prototyping a pipeline and chipping away at a large computation. To help the entire pipeline scale more efficiently, consider batching your work into a smaller number of targets.</p>
</div>
<div id="batching" class="section level2 hasAnchor" number="11.11">
<h2><span class="header-section-number">11.11</span> Batching<a href="dynamic.html#batching" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://wlandau.github.io/targetopia.html">Targetopia</a> packages usually have functions that support batching for various use cases. In <a href="https://wlandau.github.io/stantargets/"><code>stantargets</code></a>, <a href="https://wlandau.github.io/stantargets/articles/mcmc_rep.html"><code>tar_stan_mcmc_rep_summary()</code></a> and friends automatically use batching behind the scenes. The user simply needs to select the number of batches and number of reps per batch. Each batch is a dynamic branch with multiple reps, and each rep fits the user’s model once and computes summary statistics.</p>
<p>In <a href="https://docs.ropensci.org/tarchetypes/"><code>tarchetypes</code></a>, <a href="https://docs.ropensci.org/tarchetypes/reference/tar_rep.html"><code>tar_rep()</code></a> is a general-use target factory for dynamic branching. It allows you to repeat arbitrary code over multiple reps split into multiple batches. Each batch gets its own reproducible random number seed generated from the target name (as do all targets) and reps run sequentially within each batch, so the results are reproducible.
The <a href="https://github.com/ropensci/targets-stan"><code>targets-stan</code></a> repository has an example of batching implemented from scratch. The goal of the pipeline is to validate a Bayesian model by simulating thousands of dataset, analyzing each with a Bayesian model, and assessing the overall accuracy of the inference. Rather than define a target for each dataset in model, the pipeline breaks up the work into batches, where each batch has multiple datasets or multiple analyses. Here is a version of the pipeline with 40 batches and 25 simulation reps per batch (1000 reps total in a pipeline of 82 targets).</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="dynamic.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R</span></span>
<span id="cb168-2"><a href="dynamic.html#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb168-3"><a href="dynamic.html#cb168-3" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb168-4"><a href="dynamic.html#cb168-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(model_file, <span class="fu">compile_model</span>(<span class="st">&quot;stan/model.stan&quot;</span>), <span class="at">format =</span> <span class="st">&quot;file&quot;</span>),</span>
<span id="cb168-5"><a href="dynamic.html#cb168-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(index_batch, <span class="fu">seq_len</span>(<span class="dv">40</span>)),</span>
<span id="cb168-6"><a href="dynamic.html#cb168-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(index_sim, <span class="fu">seq_len</span>(<span class="dv">25</span>)),</span>
<span id="cb168-7"><a href="dynamic.html#cb168-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb168-8"><a href="dynamic.html#cb168-8" aria-hidden="true" tabindex="-1"></a>    data_continuous,</span>
<span id="cb168-9"><a href="dynamic.html#cb168-9" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_dfr</span>(index_sim, <span class="sc">~</span><span class="fu">simulate_data_continuous</span>()),</span>
<span id="cb168-10"><a href="dynamic.html#cb168-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="fu">map</span>(index_batch)</span>
<span id="cb168-11"><a href="dynamic.html#cb168-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb168-12"><a href="dynamic.html#cb168-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb168-13"><a href="dynamic.html#cb168-13" aria-hidden="true" tabindex="-1"></a>    fit_continuous,</span>
<span id="cb168-14"><a href="dynamic.html#cb168-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_sims</span>(data_continuous, <span class="at">model_file =</span> model_file),</span>
<span id="cb168-15"><a href="dynamic.html#cb168-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="fu">map</span>(data_continuous)</span>
<span id="cb168-16"><a href="dynamic.html#cb168-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb168-17"><a href="dynamic.html#cb168-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>

</div>
</div>
<div style = "background: #1C356D; color: white; padding: 10px 10px 10px 25px; font-size: 1em; width: 100%;">
  Copyright Eli Lilly and Company
</div>
            </section>

          </div>
        </div>
      </div>
<a href="markdown.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="static.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ropensci-books/targets/edit/main/dynamic.Rmd",
"text": "Edit this chapter"
},
"history": {
"link": "https://github.com/ropensci-books/targets/commits/main/dynamic.Rmd",
"text": "Chapter edit history"
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
