<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>The {targets} R package user manual - 11&nbsp; Literate programming</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./dynamic.html" rel="next">
<link href="./data.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="site_libs/htmlwidgets-1.6.0/htmlwidgets.js"></script>
<link href="site_libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="site_libs/vis-9.1.0/vis-network.min.js"></script>
<script src="site_libs/visNetwork-binding-2.1.2/visNetwork.js"></script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Literate programming</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">The {targets} R package user manual</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./walkthrough.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Walkthrough</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./help.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Help</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./debugging.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Debugging</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./performance.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Performance</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Functions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./targets.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Targets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Packages</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./projects.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Projects</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./literate-programming.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Literate programming</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dynamic.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Dynamic branching</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./static.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Static branching</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hpc.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">High-performance computing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./drake.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">What about <code>drake</code>?</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./markdown.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">R Markdown</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#literate-programming-within-a-target" id="toc-literate-programming-within-a-target" class="nav-link active" data-scroll-target="#literate-programming-within-a-target"><span class="toc-section-number">11.1</span>  Literate programming within a target</a>
  <ul class="collapse">
  <li><a href="#r-markdown-targets" id="toc-r-markdown-targets" class="nav-link" data-scroll-target="#r-markdown-targets"><span class="toc-section-number">11.1.1</span>  R Markdown targets</a></li>
  <li><a href="#quarto-targets" id="toc-quarto-targets" class="nav-link" data-scroll-target="#quarto-targets"><span class="toc-section-number">11.1.2</span>  Quarto targets</a></li>
  <li><a href="#parameterized-documents" id="toc-parameterized-documents" class="nav-link" data-scroll-target="#parameterized-documents"><span class="toc-section-number">11.1.3</span>  Parameterized documents</a></li>
  <li><a href="#single-parameter-set" id="toc-single-parameter-set" class="nav-link" data-scroll-target="#single-parameter-set"><span class="toc-section-number">11.1.4</span>  Single parameter set</a></li>
  <li><a href="#multiple-parameter-sets" id="toc-multiple-parameter-sets" class="nav-link" data-scroll-target="#multiple-parameter-sets"><span class="toc-section-number">11.1.5</span>  Multiple parameter sets</a></li>
  </ul></li>
  <li><a href="#target-markdown" id="toc-target-markdown" class="nav-link" data-scroll-target="#target-markdown"><span class="toc-section-number">11.2</span>  Target Markdown</a>
  <ul class="collapse">
  <li><a href="#access" id="toc-access" class="nav-link" data-scroll-target="#access"><span class="toc-section-number">11.2.1</span>  Access</a></li>
  <li><a href="#purpose" id="toc-purpose" class="nav-link" data-scroll-target="#purpose"><span class="toc-section-number">11.2.2</span>  Purpose</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example"><span class="toc-section-number">11.2.3</span>  Example</a></li>
  <li><a href="#required-packages" id="toc-required-packages" class="nav-link" data-scroll-target="#required-packages"><span class="toc-section-number">11.2.4</span>  Required packages</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup"><span class="toc-section-number">11.2.5</span>  Setup</a></li>
  <li><a href="#globals" id="toc-globals" class="nav-link" data-scroll-target="#globals"><span class="toc-section-number">11.2.6</span>  Globals</a></li>
  <li><a href="#target-definitions" id="toc-target-definitions" class="nav-link" data-scroll-target="#target-definitions"><span class="toc-section-number">11.2.7</span>  Target definitions</a></li>
  <li><a href="#pipeline" id="toc-pipeline" class="nav-link" data-scroll-target="#pipeline"><span class="toc-section-number">11.2.8</span>  Pipeline</a></li>
  <li><a href="#output" id="toc-output" class="nav-link" data-scroll-target="#output"><span class="toc-section-number">11.2.9</span>  Output</a></li>
  <li><a href="#conditioning-on-interactive-mode" id="toc-conditioning-on-interactive-mode" class="nav-link" data-scroll-target="#conditioning-on-interactive-mode"><span class="toc-section-number">11.2.10</span>  Conditioning on interactive mode</a></li>
  <li><a href="#tar_interactive" id="toc-tar_interactive" class="nav-link" data-scroll-target="#tar_interactive"><span class="toc-section-number">11.2.11</span>  <code>tar_interactive()</code></a></li>
  <li><a href="#tar_toggle" id="toc-tar_toggle" class="nav-link" data-scroll-target="#tar_toggle"><span class="toc-section-number">11.2.12</span>  <code>tar_toggle()</code></a></li>
  <li><a href="#chunk-options" id="toc-chunk-options" class="nav-link" data-scroll-target="#chunk-options"><span class="toc-section-number">11.2.13</span>  Chunk options</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="literate-programming" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Literate programming</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<p>Literate programming is the practice of mixing code and descriptive writing in order to execute and explain a data analysis simultaneously in the same document. The <code>targets</code> package supports literate programming through tight integration with <a href="https://quarto.org/">Quarto</a>, <a href="https://rmarkdown.rstudio.com/">R Markdown</a>, and <a href="https://yihui.org/knitr/"><code>knitr</code></a>. It is recommended to learn one of these three tools before proceeding with the following chapter.</p>
<p>There are two kinds of literate programming in <code>targets</code>:</p>
<ol type="1">
<li>A literate programming source document (or Quarto project) that renders inside an individual target. Here, you define a special kind of target that runs a lightweight R Markdown report which depends on upstream targets.</li>
<li>Target Markdown, an overarching system in which one or more <a href="https://quarto.org/">Quarto</a> or R Markdown files write the <code>_targets.R</code> file and encapsulate the pipeline.</li>
</ol>
<section id="literate-programming-within-a-target" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="literate-programming-within-a-target"><span class="header-section-number">11.1</span> Literate programming within a target</h2>
<section id="r-markdown-targets" class="level3" data-number="11.1.1">
<h3 data-number="11.1.1" class="anchored" data-anchor-id="r-markdown-targets"><span class="header-section-number">11.1.1</span> R Markdown targets</h3>
<p>Here, literate programming serves to display, summarize, and annotate results from upstream in the <code>targets</code> pipeline. The document(s) have little to no computation of their own, and they make heavy use of <code>tar_read()</code> and <code>tar_load()</code> to leverage output from other targets.</p>
<p>As an example, let us extend the <a href="walkthrough.html">walkthrough example</a> chapter with the following <a href="https://rmarkdown.rstudio.com/">R Markdown</a> source file <code>report.Rmd</code>.</p>
<p><img src="./man/figures/knitr-source.png" class="img-fluid"></p>
<p>This document depends on targets <code>fit</code> and <code>hist</code>. If we previously ran the pipeline and the data store <code>_targets/</code> exists, then <code>tar_read()</code> and <code>tar_load()</code> will read those targets and show them in the rendered HTML output <code>report.html</code>.</p>
<p><img src="./man/figures/knitr-ide.png" class="img-fluid"></p>
<p>With the <code>tar_render()</code> function in <a href="https://github.com/ropensci/tarchetypes"><code>tarchetypes</code></a>, we can go a step further and include <code>report.Rmd</code> as a <em>target</em> in the pipeline. This new targets re-renders <code>report.Rmd</code> whenever <code>fit</code> or <code>hist</code> changes, which means <code>tar_make()</code> brings the output file <code>report.html</code> up to date.</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tarchetypes)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>target <span class="ot">&lt;-</span> <span class="fu">tar_render</span>(report, <span class="st">"report.Rmd"</span>) <span class="co"># Just defines a target object.</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>target<span class="sc">$</span>command<span class="sc">$</span>expr[[<span class="dv">1</span>]]</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; tarchetypes::tar_render_run(path = "report.Rmd", args = list(input = "report.Rmd", </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     knit_root_dir = getwd(), quiet = TRUE), deps = list(fit, </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     hist))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>tar_render()</code> is like <code>tar_target()</code>, except that you supply the file path to the R Markdown report instead of an R command. Here it is at the bottom of the example <code>_targets.R</code> file below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tarchetypes)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/functions.R"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    raw_data_file,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/raw_data.csv"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">format =</span> <span class="st">"file"</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    raw_data,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(raw_data_file, <span class="at">col_types =</span> <span class="fu">cols</span>())</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    data,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    raw_data <span class="sc">%&gt;%</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Ozone =</span> <span class="fu">replace_na</span>(Ozone, <span class="fu">mean</span>(Ozone, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(hist, <span class="fu">create_plot</span>(data)),</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(fit, <span class="fu">biglm</span>(Ozone <span class="sc">~</span> Wind <span class="sc">+</span> Temp, data)),</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_render</span>(report, <span class="st">"report.Rmd"</span>) <span class="co"># Here is our call to tar_render().</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When we visualize the pipeline, we see that our <code>report</code> target depends on targets <code>fit</code> and <code>hist</code>. <code>tar_render()</code> automatically detects these upstream dependencies by statically analyzing <code>report.Rmd</code> for calls to <code>tar_load()</code> and <code>tar_read()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R console</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_visnetwork</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./man/figures/knitr-graph.png" class="img-fluid"></p>
</section>
<section id="quarto-targets" class="level3" data-number="11.1.2">
<h3 data-number="11.1.2" class="anchored" data-anchor-id="quarto-targets"><span class="header-section-number">11.1.2</span> Quarto targets</h3>
<p><code>tarchetypes</code> &gt;= 0.6.0.9000 supports a <code>tar_quarto()</code> function, which is like <code>tar_render()</code>, but for Quarto. For an individual source document, <code>tar_quarto()</code> works exactly the same way as <code>tar_render()</code>. However, <code>tar_quarto()</code> is more powerful: you can supply the path to an entire Quarto project, such as a book, blog, or website. <code>tar_quarto()</code> looks for target dependencies in all the source documents (e.g.&nbsp;listed in <code>_quarto.yml</code>), and it tracks the important files in the project for changes (run <code>tar_quarto_files()</code> to see which ones).</p>
</section>
<section id="parameterized-documents" class="level3" data-number="11.1.3">
<h3 data-number="11.1.3" class="anchored" data-anchor-id="parameterized-documents"><span class="header-section-number">11.1.3</span> Parameterized documents</h3>
<p><a href="https://docs.ropensci.org/tarchetypes"><code>tarchetypes</code></a> functions make it straightforward to use <a href="https://rmarkdown.rstudio.com/developer_parameterized_reports.html">parameterized R Markdown</a> and <a href="https://quarto.org/docs/computations/parameters.html">parameterized Quarto</a> in a <code>targets</code> pipeline. The next two subsections walk through the major use cases.</p>
</section>
<section id="single-parameter-set" class="level3" data-number="11.1.4">
<h3 data-number="11.1.4" class="anchored" data-anchor-id="single-parameter-set"><span class="header-section-number">11.1.4</span> Single parameter set</h3>
<p>In this scenario, the pipeline renders your parameterized report one time using a single set of parameters. These parameters can be upstream targets, global objects, or fixed values. Simply pass a <code>params</code> argument to <a href="https://docs.ropensci.org/tarchetypes/reference/tar_render.html"><code>tar_render()</code></a> or an <code>execute_params</code> argument to <a href="https://docs.ropensci.org/tarchetypes/reference/tar_quarto.html"><code>tar_quarto()</code></a>. Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tarchetypes)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(data, <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">seq_len</span>(<span class="dv">26</span>), <span class="at">y =</span> letters))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_quarto</span>(report, <span class="st">"report.qmd"</span>, <span class="at">execute_params =</span> <span class="fu">list</span>(<span class="at">your_param =</span> data))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Internally, the <code>report</code> target runs:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R console</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>quarto<span class="sc">::</span><span class="fu">quarto_render</span>(<span class="st">"report.qmd"</span>, <span class="at">params =</span> <span class="fu">list</span>(<span class="at">your_param =</span> your_target))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>where <code>report.qmd</code> looks like this:</p>
<p><img src="./man/figures/param-qmd.png" class="img-fluid"></p>
<p>See <a href="https://docs.ropensci.org/tarchetypes/reference/tar_quarto.html#examples"><code>tar_quarto()</code> examples</a> and <a href="https://docs.ropensci.org/tarchetypes/reference/tar_render.html#examples"><code>tar_render()</code> examples</a> for more.</p>
</section>
<section id="multiple-parameter-sets" class="level3" data-number="11.1.5">
<h3 data-number="11.1.5" class="anchored" data-anchor-id="multiple-parameter-sets"><span class="header-section-number">11.1.5</span> Multiple parameter sets</h3>
<p>In this scenario, you still have a single report, but you render it multiple times over a grid of parameters. This time, use <a href="https://docs.ropensci.org/tarchetypes/reference/tar_quarto_rep.html"><code>tar_quarto_rep()</code></a> or <a href="https://docs.ropensci.org/tarchetypes/reference/tar_render_rep.html"><code>tar_render_rep()</code></a>. Each of these functions takes as input a grid of parameters with one column per parameter and one row per parameter set, where each parameter set is used to render an instance of the document. In other words, the number of rows in the parameter grid is the number of output documents you will produce. Below is an example <code>_targets.R</code> file using <code>tar_render_rep()</code>. Usage with <code>tar_quarto_rep()</code> is the same<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tarchetypes)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_option_set</span>(<span class="at">packages =</span> <span class="st">"tibble"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(x, <span class="st">"value_of_x"</span>),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_render_rep</span>(</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    report,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"report.Rmd"</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> <span class="fu">tibble</span>(</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">par =</span> <span class="fu">c</span>(<span class="st">"par_val_1"</span>, <span class="st">"par_val_2"</span>, <span class="st">"par_val_3"</span>, <span class="st">"par_val_4"</span>),</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">output_file =</span> <span class="fu">c</span>(<span class="st">"f1.html"</span>, <span class="st">"f2.html"</span>, <span class="st">"f3.html"</span>, <span class="st">"f4.html"</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">batches =</span> <span class="dv">2</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>where <code>report.Rmd</code> has the following YAML front matter:</p>
<pre><code>title: report
output_format: html_document
params:
  par: "default value"</code></pre>
<p>and the following R code chunk:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(params<span class="sc">$</span>par)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">tar_read</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>tar_render_rep()</code> creates a target for the parameter grid and uses <a href="dynamic.html">dynamic branching</a> to render the output reports in batches. In this case, we have two batches (dynamic branches) that each produce two reports (four output reports total).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R console</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● run target x</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● run target report_params</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● run branch report_9e7470a1</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● run branch report_457829de</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ● end pipeline</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The third output file <code>f3.html</code> is below, and the rest look similar.</p>
<p><img src="./man/figures/dynamic-rmarkdown-params.png" class="img-fluid"></p>
<p>For more information, see <a href="https://docs.ropensci.org/tarchetypes/reference/tar_render_rep.html#examples">these examples</a>.</p>
</section>
</section>
<section id="target-markdown" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="target-markdown"><span class="header-section-number">11.2</span> Target Markdown</h2>
<p>Target Markdown, available in <code>targets</code> &gt; 0.6.0, is a powerful Markdown/<code>knitr</code>-based interface for reproducible analysis pipelines.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> With Target Markdown, you can define a fully scalable pipeline from within one or more Quarto or R Markdown reports or projects (even spreading a single pipeline over multiple source documents). You get the best of both worlds: the human readable narrative of literate programming, and the sophisticated caching and dependency management systems of <code>targets</code>.</p>
<section id="access" class="level3" data-number="11.2.1">
<h3 data-number="11.2.1" class="anchored" data-anchor-id="access"><span class="header-section-number">11.2.1</span> Access</h3>
<p>This chapter’s <a href="https://github.com/ropensci/targets/blob/main/inst/rmarkdown/templates/targets/skeleton/skeleton.Rmd">example Target Markdown document</a> is itself a tutorial and a simplified version of the chapter. There are two convenient ways to access the file:</p>
<ol type="1">
<li>The <a href="https://docs.ropensci.org/targets/reference/use_targets.html"><code>use_targets()</code></a> function.</li>
<li>The <a href="https://rstudio.github.io/rstudio-extensions/rmarkdown_templates.html">RStudio R Markdown template system</a>.</li>
</ol>
<p>For (2), in the RStudio IDE, select a new Quarto or R Markdown document in the New File dropdown menu in the upper left-hand corner of the window.</p>
<p><img src="./man/figures/new_rmd.png" class="img-fluid"></p>
<p>Then, select the Target Markdown template and click OK to open a copy of the report for editing.</p>
<p><img src="./man/figures/target_markdown.png" class="img-fluid"></p>
</section>
<section id="purpose" class="level3" data-number="11.2.2">
<h3 data-number="11.2.2" class="anchored" data-anchor-id="purpose"><span class="header-section-number">11.2.2</span> Purpose</h3>
<p>Target Markdown has two primary objectives:</p>
<ol type="1">
<li>Interactively explore, prototype, and test the components of a <code>targets</code> pipeline using the Quarto notebook interface or the R Markdown <a href="https://bookdown.org/yihui/rmarkdown/notebook.html">notebook interface</a>.</li>
<li>Set up a <code>targets</code> pipeline using convenient Markdown-like code chunks.</li>
</ol>
<p>Target Markdown supports a special <code>{targets}</code> <a href="https://bookdown.org/yihui/rmarkdown-cookbook/other-languages.html">language engine</a> with an interactive mode for (1) and a non-interactive mode for (2). By default, the mode is interactive in the <a href="https://bookdown.org/yihui/rmarkdown/notebook.html">notebook interface</a> and non-interactive when you knit/render the whole document.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. You can set the mode using the <code>tar_interactive</code> chunk option.</p>
</section>
<section id="example" class="level3" data-number="11.2.3">
<h3 data-number="11.2.3" class="anchored" data-anchor-id="example"><span class="header-section-number">11.2.3</span> Example</h3>
<p>The following example is based on the minimal <code>targets</code> project at https://github.com/wlandau/targets-minimal/. We process the base <code>airquality</code> dataset, fit a model, and display a histogram of ozone concentration.</p>
</section>
<section id="required-packages" class="level3" data-number="11.2.4">
<h3 data-number="11.2.4" class="anchored" data-anchor-id="required-packages"><span class="header-section-number">11.2.4</span> Required packages</h3>
<p>This example requires several R packages, and <code>targets</code> must be version 0.6.0 or above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R console</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"biglm"</span>, <span class="st">"dplyr"</span>, <span class="st">"ggplot2"</span>, <span class="st">"readr"</span>, <span class="st">"targets"</span>, <span class="st">"tidyr"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="setup" class="level3" data-number="11.2.5">
<h3 data-number="11.2.5" class="anchored" data-anchor-id="setup"><span class="header-section-number">11.2.5</span> Setup</h3>
<p>First, load <code>targets</code> to activate the specialized <code>knitr</code> engine for Target Markdown.</p>
<pre><code>```{r}
library(targets)
```</code></pre>
<div class="cell">

</div>
<p>Non-interactive Target Markdown writes scripts to a special <code>_targets_r/</code> directory to define individual targets and global objects. In order to keep your target definitions up to date, it is recommended to remove <code>_targets_r/</code> at the beginning of the R Markdown document(s) in order to clear out superfluous targets and globals from a previous version. <code>tar_unscript()</code> is a convenient way to do this.</p>
<pre><code>```{r}
tar_unscript()
```</code></pre>
</section>
<section id="globals" class="level3" data-number="11.2.6">
<h3 data-number="11.2.6" class="anchored" data-anchor-id="globals"><span class="header-section-number">11.2.6</span> Globals</h3>
<p>As usual, your targets depend on custom functions, global objects, and <code>tar_option_set()</code> options you define before the pipeline begins. Define these globals using the <code>{targets}</code> engine with <code>tar_globals = TRUE</code> chunk option.</p>
<pre><code>```{targets some-globals, tar_globals = TRUE, tar_interactive = TRUE}
options(tidyverse.quiet = TRUE)
tar_option_set(packages = c("biglm", "dplyr", "ggplot2", "readr", "tidyr"))
create_plot &lt;- function(data) {
  ggplot(data) +
    geom_histogram(aes(x = Ozone), bins = 12) +
    theme_gray(24)
}
```</code></pre>
<p>In interactive mode, the chunk simply runs the R code in the <code>tar_option_get("envir")</code> environment (usually the global environment) and displays a message:</p>
<p>::: {.cell tar_globals=‘true’ tar_interactive=‘true’} ::: {.cell tar_globals=‘true’ tar_interactive=‘true’ tar_name=‘some-globals’ tar_script=’_targets.R’}</p>
<div class="cell" data-tar_globals="true" data-tar_interactive="true" data-tar_name="some-globals" data-tar_script="_targets.R">
<pre><code>#&gt; Run code and assign objects to the environment.</code></pre>
<div class="cell" data-tar_globals="true" data-tar_interactive="true" data-tar_name="some-globals" data-tar_script="_targets.R">

</div>
</div>
<p>Here is the same chunk in non-interactive mode. Normally, there is no need to duplicate chunks like this, but we do so here in order to demonstrate both modes.</p>
<pre><code>```{targets chunk-name, tar_globals = TRUE, tar_interactive = FALSE}
options(tidyverse.quiet = TRUE)
tar_option_set(packages = c("biglm", "dplyr", "ggplot2", "readr", "tidyr"))
create_plot &lt;- function(data) {
  ggplot(data) +
    geom_histogram(aes(x = Ozone), bins = 12) +
    theme_gray(24)
}
```</code></pre>
<p>In non-interactive mode, the chunk establishes a common <code>_targets.R</code> file and writes the R code to a script in <code>_targets_r/globals/</code>, and displays an informative message:<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="cell" data-tar_globals="true" data-tar_interactive="false">
<pre><code>#&gt; Establish _targets.R and _targets_r/globals/chunk-name.R.</code></pre>
</div>
<p>It is good practice to assign explicit chunk labels or set the <code>tar_name</code> chunk option on a chunk-by-chunk basis. Each chunk writes code to a script path that depends on the name, and all script paths need to be unique.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
</section>
<section id="target-definitions" class="level3" data-number="11.2.7">
<h3 data-number="11.2.7" class="anchored" data-anchor-id="target-definitions"><span class="header-section-number">11.2.7</span> Target definitions</h3>
<p>To define targets of the pipeline, use the <code>{targets}</code> language engine with the <code>tar_globals</code> chunk option equal <code>FALSE</code> or <code>NULL</code> (default). The return value of the chunk must be a target object or a list of target objects, created by <code>tar_target()</code> or a similar function.</p>
<p>Below, we define a target to establish the air quality dataset in the pipeline.</p>
<pre><code>```{targets raw-data, tar_interactive = TRUE}
tar_target(raw_data, airquality)
```</code></pre>
<p>If you run this chunk in interactive mode, the target’s R command runs, the engine tests if the output can be saved and loaded from disk correctly, and then the return value gets assigned to the <code>tar_option_get("envir")</code> environment (usually the global environment).</p>
<p>::: {.cell tar_interactive=‘true’} ::: {.cell tar_interactive=‘true’ tar_name=‘raw-data’ tar_script=’_targets.R’}</p>
<div class="cell" data-tar_interactive="true" data-tar_name="raw-data" data-tar_script="_targets.R">
<pre><code>#&gt; Run targets and assign them to the environment.</code></pre>
<div class="cell" data-tar_interactive="true" data-tar_name="raw-data" data-tar_script="_targets.R">

</div>
</div>
<p>In the process, some temporary files are created and destroyed, but your local file space will remain untouched (barring any custom side effects in your custom code).</p>
<p>After you run a target in interactive mode, the return value is available in memory, and you can write an ordinary R code chunk to read it.</p>
<pre><code>```{r}
head(raw_data)
```</code></pre>
<p>The output is the same as what <code>tar_read(raw_data)</code> would show after a serious pipeline run.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(raw_data)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Ozone Solar.R Wind Temp Month Day</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1    41     190  7.4   67     5   1</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2    36     118  8.0   72     5   2</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3    12     149 12.6   74     5   3</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4    18     313 11.5   62     5   4</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5    NA      NA 14.3   56     5   5</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6    28      NA 14.9   66     5   6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For demonstration purposes, here is the <code>raw_data</code> target code chunk in non-interactive mode.</p>
<pre><code>```{targets chunk-name-with-target, tar_interactive = FALSE}
tar_target(raw_data, airquality)
```</code></pre>
<p>In non-interactive mode, the <code>{targets}</code> engine does not actually run any targets. Instead, it establishes a common <code>_targets.R</code> and writes the code to a script in <code>_targets_r/targets/</code>.</p>
<div class="cell" data-tar_interactive="false">
<pre><code>#&gt; Establish _targets.R and _targets_r/targets/chunk-name-with-target.R.</code></pre>
</div>
<p>Next, we define more targets to process the raw data and plot a histogram. Only the returned value of the chunk code actually becomes part of the pipeline, so if you define multiple targets in a single chunk, be sure to wrap them all in a list.</p>
<pre><code>```{targets downstream-targets}
list(
  tar_target(data, raw_data %&gt;% filter(!is.na(Ozone))),
  tar_target(hist, create_plot(data))
)
```</code></pre>
<p>In non-interactive mode, the whole target list gets written to a single script.</p>
<div class="cell" data-tar_interactive="false">
<pre><code>#&gt; Establish _targets.R and _targets_r/targets/downstream-targets.R.</code></pre>
</div>
<p>Lastly, we define a target to fit a model to the data. For simple targets like this one, we can use convenient shorthand to convert the code in a chunk into a valid target. Simply set the <code>tar_simple</code> chunk option to <code>TRUE</code>.</p>
<pre><code>```{targets fit, tar_simple = TRUE}
analysis_data &lt;- data
biglm(Ozone ~ Wind + Temp, analysis_data)
```</code></pre>
<p>When the chunk is preprocessed, chunk label (or the <code>tar_name</code> chunk option if you set it) becomes the target name, and the chunk code becomes the target command. All other arguments of <code>tar_target()</code> remain at their default values (configurable with <code>tar_option_set()</code> in a <code>tar_globals = TRUE</code> chunk). The output in the rendered R Markdown document reflects this preprocessing.</p>
<div class="cell" data-tar_simple="true" data-tar_interactive="false">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_target</span>(fit, {</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">biglm</span>(Ozone <span class="sc">~</span> Wind <span class="sc">+</span> Temp, data)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Define target fit from chunk code.</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Establish _targets.R and _targets_r/targets/fit.R.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pipeline" class="level3" data-number="11.2.8">
<h3 data-number="11.2.8" class="anchored" data-anchor-id="pipeline"><span class="header-section-number">11.2.8</span> Pipeline</h3>
<p>If you ran all the <code>{targets}</code> chunks in non-interactive mode (i.e.&nbsp;pipeline construction mode), then the target script file and helper scripts should all be established, and you are ready to run the pipeline in with <code>tar_make()</code> in an ordinary <code>{r}</code> code chunk. This time, the output is written to persistent storage at the project root.</p>
<pre><code>```{r}
tar_make()
```</code></pre>
<div class="cell">
<pre><code>#&gt; • start target raw_data
#&gt; • built target raw_data [1.236 seconds]
#&gt; • start target data
#&gt; • built target data [0.036 seconds]
#&gt; • start target fit
#&gt; • built target fit [0.004 seconds]
#&gt; • start target hist
#&gt; • built target hist [0.033 seconds]
#&gt; • end pipeline [1.598 seconds]</code></pre>
</div>
</section>
<section id="output" class="level3" data-number="11.2.9">
<h3 data-number="11.2.9" class="anchored" data-anchor-id="output"><span class="header-section-number">11.2.9</span> Output</h3>
<p>You can retrieve results from the <code>_targets/</code> data store using <code>tar_read()</code> or <code>tar_load()</code>.</p>
<pre><code>```{r}
library(biglm)
tar_read(fit)
```</code></pre>
<div class="cell">
<pre><code>#&gt; Large data regression model: biglm(Ozone ~ Wind + Temp, data)
#&gt; Sample size =  116</code></pre>
</div>
<pre><code>```{r}
tar_read(hist)
```</code></pre>
<div class="cell">
<div class="cell-output-display">
<p><img src="literate-programming_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The <code>targets</code> dependency graph helps your readers understand the steps of your pipeline at a high level.</p>
<pre><code>```{r}
tar_visnetwork()
```</code></pre>
<div class="cell">
<div class="cell-output-display">
<div class="visNetwork html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ce4f80849c1545d8ed61" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-ce4f80849c1545d8ed61">{"x":{"nodes":{"name":["data","fit","hist","raw_data","create_plot"],"type":["stem","stem","stem","stem","function"],"status":["uptodate","uptodate","uptodate","uptodate","uptodate"],"seconds":[0.036,0.004,0.033,1.236,null],"bytes":[1079,1575,48980,1263,null],"branches":[null,null,null,null,null],"label":["data","fit","hist","raw_data","create_plot"],"color":["#354823","#354823","#354823","#354823","#354823"],"id":["data","fit","hist","raw_data","create_plot"],"level":[2,3,3,1,1],"shape":["dot","dot","dot","dot","triangle"]},"edges":{"from":["data","create_plot","data","raw_data"],"to":["fit","hist","hist","data"],"arrows":["to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"physics":{"stabilization":false},"interaction":{"zoomSpeed":1},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":1,"to":1},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Up to date","Stem","Function"],"color":["#354823","#899DA4","#899DA4"],"shape":["dot","dot","triangle"]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>At this point, you can go back and run <code>{targets}</code> chunks in interactive mode without interfering with the code or data of the non-interactive pipeline.</p>
</section>
<section id="conditioning-on-interactive-mode" class="level3" data-number="11.2.10">
<h3 data-number="11.2.10" class="anchored" data-anchor-id="conditioning-on-interactive-mode"><span class="header-section-number">11.2.10</span> Conditioning on interactive mode</h3>
<p><code>targets</code> version 0.6.0.9001 and above supports the <code>tar_interactive()</code> function, which suppresses code unless Target Markdown interactive mode is turned on. Similarly, <code>tar_noninteractive()</code> suppresses code in interactive mode, and <code>tar_toggle()</code> selects alternative pieces of code based on the current mode.</p>
</section>
<section id="tar_interactive" class="level3" data-number="11.2.11">
<h3 data-number="11.2.11" class="anchored" data-anchor-id="tar_interactive"><span class="header-section-number">11.2.11</span> <code>tar_interactive()</code></h3>
<p><code>tar_interactive()</code> is useful for dynamic branching. If a dynamic target branches over a target from a different chunk, this ordinarily breaks interactive mode.</p>
<pre><code>```{targets condition, tar_interactive = TRUE}
tar_target(y, x ^ 2, pattern = map(x))
```</code></pre>
<p>::: {.cell tar_interactive=‘true’} ::: {.cell tar_interactive=‘true’ tar_name=‘condition’ tar_script=’_targets.R’}</p>
<div class="cell" data-tar_interactive="true" data-tar_name="condition" data-tar_script="_targets.R">
<pre><code>#&gt; Run targets and assign them to the environment.</code></pre>
<div class="cell" data-tar_interactive="true" data-tar_name="condition" data-tar_script="_targets.R">
<pre><code>#&gt; Error:
#&gt; ! Target y tried to branch over x, which is illegal. Patterns must only branch over explicitly declared targets in the pipeline. Stems and patterns are fine, but you cannot branch over branches or global objects. Also, if you branch over a target with format = "file", then that target must also be a pattern.</code></pre>
</div>
</div>
<p>However, with <code>tar_interactive()</code>, you can define a version of <code>x</code> just for testing and prototyping in interactive mode. The chunk below fixes interactive mode without changing the pipeline in non-interactive mode.</p>
<pre><code>```{targets condition-fixed, tar_interactive = TRUE}
list(
  tar_interactive(tar_target(x, seq_len(2))),
  tar_target(y, x ^ 2, pattern = map(x))
)
```</code></pre>
<p>::: {.cell tar_interactive=‘true’} ::: {.cell tar_interactive=‘true’ tar_name=‘condition-fixed’ tar_script=’_targets.R’}</p>
<div class="cell" data-tar_interactive="true" data-tar_name="condition-fixed" data-tar_script="_targets.R">
<pre><code>#&gt; Run targets and assign them to the environment.</code></pre>
<div class="cell" data-tar_interactive="true" data-tar_name="condition-fixed" data-tar_script="_targets.R">

</div>
</div>
</section>
<section id="tar_toggle" class="level3" data-number="11.2.12">
<h3 data-number="11.2.12" class="anchored" data-anchor-id="tar_toggle"><span class="header-section-number">11.2.12</span> <code>tar_toggle()</code></h3>
<p><code>tar_toggle()</code> is useful for scaling up and down the amount of work based on the current mode. Interactive mode should finish quickly for prototyping and testing, and non-interactive mode should take on the full level work required for a serious pipeline. Below, <code>tar_toggle()</code> seamlessly scales up and down the number of simulations repetitions in the example target from <a href="https://wlandau.github.io/rmedicine2021-pipeline/#target-definitions" class="uri">https://wlandau.github.io/rmedicine2021-pipeline/#target-definitions</a>. To learn more about <code>stantargets</code>, visit <a href="https://docs.ropensci.org/stantargets/" class="uri">https://docs.ropensci.org/stantargets/</a>.</p>
<pre><code>```{targets bayesian-model-validation, tar_interactive = TRUE}
tar_stan_mcmc_rep_summary(
  name = mcmc,
  stan_files = "model.stan",
  data = simulate_data(), # Defined in another code chunk.
  batches = tar_toggle(1, 100),
  reps = tar_toggle(1, 10),
  chains = tar_toggle(1, 4),
  parallel_chains = tar_toggle(1, 4),
  iter_warmup = tar_toggle(100, 4e4),
  iter_sampling = tar_toggle(100, 4e4),
  summaries = list(
    ~posterior::quantile2(.x, probs = c(0.025, 0.25, 0.5, 0.75, 0.975)),
    rhat = ~posterior::rhat(.x)
  ),
  deployment = "worker"
)
```</code></pre>
</section>
<section id="chunk-options" class="level3" data-number="11.2.13">
<h3 data-number="11.2.13" class="anchored" data-anchor-id="chunk-options"><span class="header-section-number">11.2.13</span> Chunk options</h3>
<ul>
<li><code>tar_globals</code>: Logical of length 1, whether to define globals or targets. If <code>TRUE</code>, the chunk code defines functions, objects, and options common to all the targets. If <code>FALSE</code> or <code>NULL</code> (default), then the chunk returns formal targets for the pipeline.</li>
<li><code>tar_interactive</code>: Logical of length 1 to choose whether to run the chunk in interactive mode or non-interactive mode.</li>
<li><code>tar_name</code>: name to use for writing helper script files (e.g.&nbsp;_targets_r/targets/target_script.R) and specifying target names if the tar_simple chunk option is TRUE. All helper scripts and target names must have unique names, so please do not set this option globally with knitr::opts_chunk$set().</li>
<li><code>tar_script</code>: Character of length 1, where to write the target script file in non-interactive mode. Most users can skip this option and stick with the default <code>_targets.R</code> script path. Helper script files are always written next to the target script in a folder with an <code>"_r"</code> suffix. The <code>tar_script</code> path must either be absolute or be relative to the project root (where you call <code>tar_make()</code> or similar). If not specified, the target script path defaults to <code>tar_config_get("script")</code> (default: <code>_targets.R</code>; helpers default: <code>_targets_r/</code>). When you run <code>tar_make()</code> etc. with a non-default target script, you must select the correct target script file either with the <code>script</code> argument or with <code>tar_config_set(script = ...)</code>. The function will <code>source()</code> the script file from the current working directory (i.e.&nbsp;with <code>chdir = FALSE</code> in <code>source()</code>).</li>
<li><code>tar_simple</code>: Logical of length 1. Set to <code>TRUE</code> to define a single target with a simplified interface. In code chunks with <code>tar_simple</code> equal to <code>TRUE</code>, the chunk label (or the <code>tar_name</code> chunk option if you set it) becomes the name, and the chunk code becomes the command. In other words, a code chunk with label <code>targetname</code> and command <code>mycommand()</code> automatically gets converted to <code>tar_target(name = targetname, command = mycommand())</code>. All other arguments of <code>tar_target()</code> remain at their default values (configurable with <code>tar_option_set()</code> in a <code>tar_globals = TRUE</code> chunk).</li>
</ul>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>except the parameter grid argument is called <code>execute_params</code> in <code>tar_quarto_rep()</code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Target Markdown is powered entirely by <code>targets</code> and <code>knitr</code>. It does not actually require Markdown, although Markdown is the recommended way to interact with it.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>In <code>targets</code> version 0.6.0, the mode is interactive if <code>interactive()</code> is <code>TRUE</code>. In subsequent versions, the mode is interactive if <code>!isTRUE(getOption("knitr.in.progress"))</code> is <code>TRUE</code>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>The <code>_targets.R</code> file from Target Markdown never changes from chunk to chunk or report to report, so you can spread your work over multiple reports without worrying about aligning <code>_targets.R</code> scripts. Just be sure all your chunk names are unique across all the reports of a project, or you set the <code>tar_name</code> chunk option to specify base names of script file paths.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>In addition, for <code>bookdown</code> projects, chunk labels should only use alphanumeric characters and dashes.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./data.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./dynamic.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Dynamic branching</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">How to get help: <a href="https://books.ropensci.org/targets/help.html" class="uri">https://books.ropensci.org/targets/help.html</a><br>Copyright 2022, Eli Lilly and Company</div>
  </div>
</footer>



</body></html>